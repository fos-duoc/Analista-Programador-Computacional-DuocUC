function C(){const e=document.getElementById("subject-nav-sidebar"),t=document.getElementById("sidebar-resize-handle"),n=document.getElementById("sidebar-toggle"),s=document.getElementById("sidebar-expand-btn"),i=document.querySelectorAll(".filter-tab"),a=document.getElementById("sidebar-search-input"),d=document.getElementById("search-clear"),c=document.getElementById("week-bimestre-select");if(!e||"true"===e.dataset.initialized)return;e.dataset.initialized="true";const r={isOpen:!1,currentFilter:"bimestre",selectedBimestre:"01",selectedSubjectId:null,width:280};function o(){try{localStorage.setItem("subject_nav_state",JSON.stringify(r))}catch(e){console.warn("Could not save sidebar state:",e)}}function l(t){r.isOpen=t,e.classList.toggle("collapsed",!t),s?.classList.toggle("visible",!t),o(),window.dispatchEvent(new CustomEvent("navSidebarToggle",{detail:{isOpen:t,width:t?r.width:0}}))}function u(e,t=!0){r.currentFilter=e,i.forEach((t=>{const n=t.dataset.filter===e;t.classList.toggle("active",n),t.setAttribute("aria-selected",n.toString())})),document.querySelectorAll(".filter-view").forEach((e=>{e.classList.remove("active")})),document.getElementById(`view-${e}`)?.classList.add("active"),"week"===e&&p(r.selectedBimestre),t&&o()}function m(){const t=a.value.toLowerCase().trim();d?.classList.toggle("visible",t.length>0),e.querySelectorAll(".subject-item").forEach((e=>{const n=e.dataset.subjectName?.toLowerCase()||"",s=e.dataset.subjectCode?.toLowerCase()||"",i=n.includes(t)||s.includes(t);e.style.display=i?"":"none"})),e.querySelectorAll(".week-item").forEach((e=>{const n=e.textContent?.toLowerCase()||"";e.style.display=n.includes(t)?"":"none"}))}function v(t,n){r.selectedSubjectId=t,e.querySelectorAll(".subject-item").forEach((e=>{e.classList.toggle("active",e.dataset.subjectId===t)})),"function"==typeof window.openSubjectDrawer&&window.openSubjectDrawer(t,n),o()}function p(e){const t=document.getElementById("weeks-container");if(!t)return;const n=window.subjectNavData;if(!n?.asignaturas)return;const s=n.asignaturas.filter((t=>t.bimestre===parseInt(e))),i={};for(let e=1;e<=8;e++)i[e]=[];s.forEach((e=>{e.experiencias?.forEach((t=>{const n=t.semanas?.match(/Semana\s*(\d+)(?:\s*-\s*(\d+))?/i);if(n){const s=parseInt(n[1]),a=n[2]?parseInt(n[2]):s;for(let n=s;n<=Math.min(a,8);n++)i[n].push({subject:e,experiencia:t})}}))}));let a="";for(let e=1;e<=8;e++){const t=i[e];a+=`\n                    <div class="week-group">\n                        <button class="week-header" aria-expanded="false">\n                            <span class="week-badge">S${e}</span>\n                            <span class="week-title">Semana ${e}</span>\n                            <span class="week-count">${t.length}</span>\n                            <i class="fas fa-chevron-down group-chevron"></i>\n                        </button>\n                        <div class="week-content">\n                            ${t.length>0?t.map((e=>{const t=e.subject,n=(t.descripcion||"Asignatura del programa").substring(0,100),s=t.experiencias?.length||0,i=String(t.bimestre).padStart(2,"0"),a=parseInt(i)<=10?"APC":"IDS",d=`${t.nombreCorto}|${n}${n.length>=100?"...":""}|${s} experiencias,B${i},${t.creditos||4} cr√©ditos|subject|fa-book|${a} - BIMESTRE ${i}`;return`\n                                <div class="week-item" data-subject-id="${t.id}" data-tooltip="${d.replace(/"/g,"&quot;")}">\n                                    <span class="week-subject">${t.nombreCorto}</span>\n                                    <span class="week-exp">Exp ${e.experiencia.numero}: ${e.experiencia.titulo}</span>\n                                </div>\n                            `})).join(""):'<span class="week-empty">Sin contenido programado</span>'}\n                        </div>\n                    </div>\n                `}t.innerHTML=a,t.querySelectorAll(".week-header").forEach((e=>{e.addEventListener("click",(()=>{const t="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",(!t).toString())}))}))}(function(){try{const t=localStorage.getItem("subject_nav_state");if(t){const e=JSON.parse(t);r.currentFilter=e.currentFilter||"bimestre",r.selectedBimestre=e.selectedBimestre||"01",r.width=e.width||280}r.width&&r.width>=220&&r.width<=400&&(e.style.width=r.width+"px"),r.isOpen||(e.classList.add("collapsed"),s?.classList.add("visible")),u(r.currentFilter,!1),c&&(c.value=r.selectedBimestre)}catch(e){console.warn("Could not restore sidebar state:",e)}})(),function(){if(!t)return;let n=!1,s=0,i=0,a=null;function d(d){d.preventDefault(),n=!0,s=d.clientX||d.touches?.[0]?.clientX||0,i=e.offsetWidth,e.classList.add("resizing"),t.classList.add("active"),document.body.style.cursor="ew-resize",document.body.style.userSelect="none",a=document.createElement("div"),a.className="sidebar-width-indicator",document.body.appendChild(a),document.addEventListener("mousemove",c),document.addEventListener("mouseup",l),document.addEventListener("touchmove",c,{passive:!1}),document.addEventListener("touchend",l)}function c(t){if(!n)return;t.preventDefault();const d=(t.clientX||t.touches?.[0]?.clientX||0)-s;let c=i+d;c=Math.max(220,Math.min(400,c)),e.style.width=c+"px",a&&(a.textContent=`${Math.round(c)}px`,a.style.left=c+10+"px"),window.dispatchEvent(new CustomEvent("navSidebarResize",{detail:{width:c}}))}function l(){n&&(n=!1,e.classList.remove("resizing"),t.classList.remove("active"),document.body.style.cursor="",document.body.style.userSelect="",r.width=e.offsetWidth,o(),a?.remove(),a=null,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",l),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",l))}t.addEventListener("dblclick",(()=>{e.style.width="280px",r.width=280,o()})),t.addEventListener("mousedown",d),t.addEventListener("touchstart",d,{passive:!1})}(),n?.addEventListener("click",(()=>l(!1))),s?.addEventListener("click",(()=>l(!0))),i.forEach((e=>{e.addEventListener("click",(()=>u(e.dataset.filter)))})),a?.addEventListener("input",m),d?.addEventListener("click",(function(){a.value="",d?.classList.remove("visible"),m(),a.focus()})),c?.addEventListener("change",(e=>{r.selectedBimestre=e.target.value,p(e.target.value),o()})),e.addEventListener("click",(e=>{const t=e.target.closest(".group-header, .week-header");if(t){e.stopPropagation();const n="true"===t.getAttribute("aria-expanded");t.setAttribute("aria-expanded",(!n).toString())}})),e.addEventListener("click",(e=>{const t=e.target.closest(".subject-item"),n=e.target.closest(".week-item");if(t)v(t.dataset.subjectId,t.dataset.subjectName);else if(n){const e=n.dataset.subjectId;if(e){const t=window.subjectNavData?.asignaturas?.find((t=>t.id===e));t&&v(e,t.nombreCorto)}}})),p(r.selectedBimestre),function(){function t(){const t=window.innerWidth;e.style.maxWidth=t<768?Math.min(280,t-60)+"px":"400px"}window.addEventListener("subjectDrawerToggle",(e=>{e.detail,t()})),window.addEventListener("subjectDrawerResize",(e=>{e.detail,t()})),window.addEventListener("resize",t),window.addEventListener("requestNavSidebarCollapse",(()=>{r.isOpen&&l(!1)}))}()}document.addEventListener("DOMContentLoaded",C),document.addEventListener("astro:page-load",C);