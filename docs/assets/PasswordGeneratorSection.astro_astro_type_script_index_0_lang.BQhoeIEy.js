class H{constructor(){this.charsets={uppercase:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",lowercase:"abcdefghijklmnopqrstuvwxyz",numbers:"0123456789",symbols:"!@#$%^&*()_+-=[]{}|;:,.<>?"},this.ambiguousChars="0OlI1",this.similarChars="iLoO",this.history=[],this.maxHistory=5}generatePassword(e,t){let s="";if(t.uppercase&&(s+=this.charsets.uppercase),t.lowercase&&(s+=this.charsets.lowercase),t.numbers&&(s+=this.charsets.numbers),t.symbols&&(s+=this.charsets.symbols),t.excludeAmbiguous&&(s=s.split("").filter(n=>!this.ambiguousChars.includes(n)).join("")),t.excludeSimilar&&(s=s.split("").filter(n=>!this.similarChars.includes(n)).join("")),s.length===0)return{password:"",error:"Selecciona al menos un tipo de caracter"};const r=this.cryptoRandom(s,e),c=this.ensureCharacterTypes(r,t,s);return{password:c,entropy:this.calculateEntropy(c,s.length),charsetSize:s.length}}cryptoRandom(e,t){const s=new Uint32Array(t);crypto.getRandomValues(s);let r="";const c=Math.floor(4294967295/e.length)*e.length;for(let n=0;n<t;n++){let l=s[n];for(;l>=c;){const d=new Uint32Array(1);crypto.getRandomValues(d),l=d[0]}r+=e[l%e.length]}return r}ensureCharacterTypes(e,t,s){const r=e.split(""),c=[];return t.uppercase&&c.push(this.charsets.uppercase),t.lowercase&&c.push(this.charsets.lowercase),t.numbers&&c.push(this.charsets.numbers),t.symbols&&c.push(this.charsets.symbols),c.forEach((n,l)=>{if(!r.some(h=>n.includes(h))&&r.length>l){const h=this.getSecureRandomInt(r.length),m=n[this.getSecureRandomInt(n.length)];r[h]=m}}),this.secureShuffle(r).join("")}getSecureRandomInt(e){const t=new Uint32Array(1);return crypto.getRandomValues(t),t[0]%e}secureShuffle(e){const t=[...e];for(let s=t.length-1;s>0;s--){const r=this.getSecureRandomInt(s+1);[t[s],t[r]]=[t[r],t[s]]}return t}calculateEntropy(e,t){return Math.log2(Math.pow(t,e.length))}getStrengthInfo(e){return e<28?{level:"muy-debil",text:"Muy Débil",percent:15,color:"#ef4444"}:e<36?{level:"debil",text:"Débil",percent:30,color:"#f97316"}:e<60?{level:"moderada",text:"Moderada",percent:50,color:"#eab308"}:e<80?{level:"fuerte",text:"Fuerte",percent:75,color:"#22c55e"}:e<100?{level:"muy-fuerte",text:"Muy Fuerte",percent:90,color:"#10b981"}:{level:"excelente",text:"Excelente",percent:100,color:"#00d4ff"}}addToHistory(e){this.history.length>=this.maxHistory&&this.history.pop(),this.history.unshift({password:e,timestamp:new Date().toLocaleTimeString()})}clearHistory(){this.history=[]}}function E(){const u=new H,e=document.getElementById("password-output"),t=document.getElementById("password-length"),s=document.getElementById("length-value"),r=document.getElementById("generate-password"),c=document.getElementById("copy-password"),n=document.getElementById("toggle-visibility"),l=document.getElementById("eye-icon"),d=document.getElementById("strength-fill"),h=document.getElementById("strength-label"),m=document.getElementById("entropy-value"),p=document.getElementById("history-list"),I=document.getElementById("clear-history"),y=document.getElementById("copy-feedback"),g=document.getElementById("opt-uppercase"),f=document.getElementById("opt-lowercase"),w=document.getElementById("opt-numbers"),b=document.getElementById("opt-symbols"),C=document.getElementById("opt-exclude-ambiguous"),k=document.getElementById("opt-exclude-similar");if(!e||!r)return;function x(){const o={uppercase:g?.checked??!0,lowercase:f?.checked??!0,numbers:w?.checked??!0,symbols:b?.checked??!0,excludeAmbiguous:C?.checked??!1,excludeSimilar:k?.checked??!1},a=parseInt(t?.value??"16"),i=u.generatePassword(a,o);if(i.error){e.value=i.error,v(0);return}e.value=i.password,e.type="password",l&&(l.className="fas fa-eye"),v(i.entropy),u.addToHistory(i.password),B(),r.classList.add("generating"),setTimeout(()=>r.classList.remove("generating"),300)}function v(o){const a=u.getStrengthInfo(o);d&&(d.style.width=`${a.percent}%`,d.style.background=`linear-gradient(90deg, ${a.color}, ${a.color}dd)`),h&&(h.textContent=a.text,h.style.color=a.color),m&&(m.textContent=`${o.toFixed(1)} bits`)}function B(){if(p){if(u.history.length===0){p.innerHTML='<p class="history-empty">Las contraseñas generadas aparecerán aquí</p>';return}p.innerHTML=u.history.map((o,a)=>`
                <div class="history-item" data-index="${a}">
                    <span class="history-password">••••••••••••</span>
                    <span class="history-time">${o.timestamp}</span>
                    <button class="history-copy" data-password="${o.password}" title="Copiar">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            `).join(""),p.querySelectorAll(".history-copy").forEach(o=>{o.onclick=async a=>{a.stopPropagation();const i=o.dataset.password;await S(i)}})}}async function S(o){try{await navigator.clipboard.writeText(o),L()}catch(a){console.error("Failed to copy:",a)}}function L(){y&&(y.classList.add("show"),setTimeout(()=>y.classList.remove("show"),2e3))}r.onclick=x,c&&(c.onclick=()=>{e.value&&!e.value.includes("Haz clic")&&S(e.value)}),n&&l&&(n.onclick=()=>{e.type==="password"?(e.type="text",l.className="fas fa-eye-slash"):(e.type="password",l.className="fas fa-eye")}),t&&s&&(t.oninput=()=>{s.textContent=t.value}),I&&(I.onclick=()=>{u.clearHistory(),B()}),[g,f,w,b].forEach(o=>{o&&(o.onchange=()=>{[g,f,w,b].some(i=>i?.checked)||(o.checked=!0)})}),x()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E();document.addEventListener("astro:page-load",E);
