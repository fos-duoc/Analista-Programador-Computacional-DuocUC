function B(){const e=document.getElementById("subject-nav-sidebar"),t=document.getElementById("sidebar-resize-handle"),n=document.getElementById("sidebar-toggle"),s=document.getElementById("sidebar-expand-btn"),a=document.querySelectorAll(".filter-tab"),i=document.getElementById("sidebar-search-input"),c=document.getElementById("search-clear"),o=document.getElementById("week-bimestre-select");if(!e||"true"===e.dataset.initialized)return;e.dataset.initialized="true";const r={isOpen:!1,currentFilter:"bimestre",selectedBimestre:"01",selectedSubjectId:null,width:280};function d(){try{localStorage.setItem("subject_nav_state",JSON.stringify(r))}catch(e){console.warn("Could not save sidebar state:",e)}}function l(t){r.isOpen=t,e.classList.toggle("collapsed",!t),s?.classList.toggle("visible",!t),d(),window.dispatchEvent(new CustomEvent("navSidebarToggle",{detail:{isOpen:t,width:t?r.width:0}}))}function u(e,t=!0){r.currentFilter=e,a.forEach((t=>{const n=t.dataset.filter===e;t.classList.toggle("active",n),t.setAttribute("aria-selected",n.toString())})),document.querySelectorAll(".filter-view").forEach((e=>{e.classList.remove("active")})),document.getElementById(`view-${e}`)?.classList.add("active"),"week"===e&&p(r.selectedBimestre),t&&d()}function m(){const t=i.value.toLowerCase().trim();c?.classList.toggle("visible",t.length>0),e.querySelectorAll(".subject-item").forEach((e=>{const n=e.dataset.subjectName?.toLowerCase()||"",s=e.dataset.subjectCode?.toLowerCase()||"",a=n.includes(t)||s.includes(t);e.style.display=a?"":"none"})),e.querySelectorAll(".week-item").forEach((e=>{const n=e.textContent?.toLowerCase()||"";e.style.display=n.includes(t)?"":"none"}))}function v(t,n){r.selectedSubjectId=t,e.querySelectorAll(".subject-item").forEach((e=>{e.classList.toggle("active",e.dataset.subjectId===t)})),"function"==typeof window.openSubjectDrawer&&window.openSubjectDrawer(t,n),d()}function p(e){const t=document.getElementById("weeks-container");if(!t)return;const n=window.subjectNavData;if(!n?.asignaturas)return;const s=n.asignaturas.filter((t=>t.bimestre===parseInt(e))),a={};for(let e=1;e<=8;e++)a[e]=[];s.forEach((e=>{e.experiencias?.forEach((t=>{const n=t.semanas?.match(/Semana\s*(\d+)(?:\s*-\s*(\d+))?/i);if(n){const s=parseInt(n[1]),i=n[2]?parseInt(n[2]):s;for(let n=s;n<=Math.min(i,8);n++)a[n].push({subject:e,experiencia:t})}}))}));let i="";for(let e=1;e<=8;e++){const t=a[e];i+=`\n                    <div class="week-group">\n                        <button class="week-header" aria-expanded="false">\n                            <span class="week-badge">S${e}</span>\n                            <span class="week-title">Semana ${e}</span>\n                            <span class="week-count">${t.length}</span>\n                            <i class="fas fa-chevron-down group-chevron"></i>\n                        </button>\n                        <div class="week-content">\n                            ${t.length>0?t.map((e=>{const t=e.subject,n=(t.descripcion||"Asignatura del programa").substring(0,100),s=t.experiencias?.length||0,a=String(t.bimestre).padStart(2,"0"),i=parseInt(a)<=10?"APC":"IDS",c=`${t.nombreCorto}|${n}${n.length>=100?"...":""}|${s} experiencias,B${a},${t.creditos||4} cr√©ditos|subject|fa-book|${i} - BIMESTRE ${a}`;return`\n                                <div class="week-item" data-subject-id="${t.id}" data-tooltip="${c.replace(/"/g,"&quot;")}">\n                                    <span class="week-subject">${t.nombreCorto}</span>\n                                    <span class="week-exp">Exp ${e.experiencia.numero}: ${e.experiencia.titulo}</span>\n                                </div>\n                            `})).join(""):'<span class="week-empty">Sin contenido programado</span>'}\n                        </div>\n                    </div>\n                `}t.innerHTML=i,t.querySelectorAll(".week-header").forEach((e=>{e.addEventListener("click",(()=>{const t="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",(!t).toString())}))}))}(function(){try{const t=localStorage.getItem("subject_nav_state");if(t){const e=JSON.parse(t);r.currentFilter=e.currentFilter||"bimestre",r.selectedBimestre=e.selectedBimestre||"01",r.width=e.width||280}r.width&&r.width>=220&&r.width<=400&&(e.style.width=r.width+"px"),r.isOpen||(e.classList.add("collapsed"),s?.classList.add("visible")),u(r.currentFilter,!1),o&&(o.value=r.selectedBimestre)}catch(e){console.warn("Could not restore sidebar state:",e)}})(),function(){if(!t)return;let n=!1,s=0,a=0,i=null;function c(c){c.preventDefault(),n=!0,s=c.clientX||c.touches?.[0]?.clientX||0,a=e.offsetWidth,e.classList.add("resizing"),t.classList.add("active"),document.body.style.cursor="ew-resize",document.body.style.userSelect="none",i=document.createElement("div"),i.className="sidebar-width-indicator",document.body.appendChild(i),document.addEventListener("mousemove",o),document.addEventListener("mouseup",l),document.addEventListener("touchmove",o,{passive:!1}),document.addEventListener("touchend",l)}function o(t){if(!n)return;t.preventDefault();const c=(t.clientX||t.touches?.[0]?.clientX||0)-s;let o=a+c;o=Math.max(220,Math.min(400,o)),e.style.width=o+"px",i&&(i.textContent=`${Math.round(o)}px`,i.style.left=o+10+"px"),window.dispatchEvent(new CustomEvent("navSidebarResize",{detail:{width:o}}))}function l(){n&&(n=!1,e.classList.remove("resizing"),t.classList.remove("active"),document.body.style.cursor="",document.body.style.userSelect="",r.width=e.offsetWidth,d(),i?.remove(),i=null,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",l),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",l))}t.addEventListener("dblclick",(()=>{e.style.width="280px",r.width=280,d()})),t.addEventListener("mousedown",c),t.addEventListener("touchstart",c,{passive:!1})}(),n?.addEventListener("click",(()=>l(!1))),s?.addEventListener("click",(()=>l(!0))),a.forEach((e=>{e.addEventListener("click",(()=>u(e.dataset.filter)))})),i?.addEventListener("input",m),c?.addEventListener("click",(function(){i.value="",c?.classList.remove("visible"),m(),i.focus()})),o?.addEventListener("change",(e=>{r.selectedBimestre=e.target.value,p(e.target.value),d()})),e.addEventListener("click",(e=>{const t=e.target.closest(".group-header, .week-header");if(t){e.stopPropagation();const n="true"===t.getAttribute("aria-expanded");t.setAttribute("aria-expanded",(!n).toString())}})),e.addEventListener("click",(e=>{const t=e.target.closest(".subject-item"),n=e.target.closest(".week-item");if(t)v(t.dataset.subjectId,t.dataset.subjectName);else if(n){const e=n.dataset.subjectId;if(e){const t=window.subjectNavData?.asignaturas?.find((t=>t.id===e));t&&v(e,t.nombreCorto)}}})),p(r.selectedBimestre)}document.addEventListener("DOMContentLoaded",B),document.addEventListener("astro:page-load",B);