---
// Data Pipeline Section - Real-time and Batch processing views
---

<section id="pipeline" class="pipeline-section">
    <!-- Premium Header -->
    <div class="pipeline-hero-header" data-aos="fade-up">
        <div class="pipeline-title-wrap">
            <div class="pipeline-icon-glow">
                <i class="fas fa-project-diagram"></i>
            </div>
            <div class="pipeline-title-content">
                <h2 class="pipeline-main-title">Data Pipeline <span class="gradient-text">End-to-End</span></h2>
                <p class="pipeline-tagline">Arquitectura moderna de flujo de datos en tiempo real y batch</p>
            </div>
        </div>
        <!-- Mode Selector Buttons -->
        <div class="pipeline-mode-selector">
            <button class="mode-btn active" data-mode="realtime" id="btn-realtime">
                <i class="fas fa-bolt"></i>
                <span>Real-time Streaming</span>
                <small>Latencia &lt; 1s</small>
            </button>
            <button class="mode-btn" data-mode="batch" id="btn-batch">
                <i class="fas fa-layer-group"></i>
                <span>Batch Processing</span>
                <small>Alto volumen</small>
            </button>
        </div>
    </div>

    <!-- Pipeline Diagrams Container -->
    <div class="pipeline-container" data-aos="fade-up" data-aos-delay="100">

        <!-- ==================== REAL-TIME STREAMING PIPELINE ==================== -->
        <div id="pipeline-realtime" class="pipeline-diagram-premium pipeline-mode active">
            <!-- Pipeline Header -->
            <div class="pipeline-mode-header realtime">
                <div class="mode-indicator">
                    <i class="fas fa-bolt"></i>
                    <span>Real-time Streaming Pipeline</span>
                </div>
                <div class="mode-stats">
                    <span class="stat-pill"><i class="fas fa-clock"></i> Latencia: &lt;1s</span>
                    <span class="stat-pill"><i class="fas fa-tachometer-alt"></i> 100K+ events/s</span>
                    <span class="stat-pill"><i class="fas fa-sync"></i> 24/7 Continuous</span>
                </div>
            </div>

            <!-- Animated Connection Line -->
            <div class="pipeline-connection-line realtime-line">
                <div class="data-flow-animation fast"></div>
            </div>

            <!-- Pipeline Stages -->
            <div class="pipeline-stages-grid">
                <!-- Stage 1: Ingest -->
                <div class="pipeline-stage-card">
                    <div class="stage-number">01</div>
                    <div class="stage-icon-premium extract">
                        <i class="fas fa-satellite-dish"></i>
                    </div>
                    <div class="stage-content">
                        <h4 class="stage-title">Ingest</h4>
                        <p class="stage-desc">Event Streaming</p>
                    </div>
                    <div class="stage-tech-stack">
                        <a href="https://kafka.apache.org/" target="_blank" class="tech-mini"><i class="devicon-apachekafka-original"></i> Kafka</a>
                        <a href="https://aws.amazon.com/kinesis/" target="_blank" class="tech-mini"><i class="devicon-amazonwebservices-plain-wordmark"></i> Kinesis</a>
                        <a href="https://pulsar.apache.org/" target="_blank" class="tech-mini"><i class="fas fa-meteor"></i> Pulsar</a>
                        <a href="https://www.rabbitmq.com/" target="_blank" class="tech-mini"><i class="fas fa-rabbit"></i> RabbitMQ</a>
                    </div>
                </div>
                <div class="stage-arrow"><i class="fas fa-arrow-right"></i></div>

                <!-- Stage 2: Process -->
                <div class="pipeline-stage-card">
                    <div class="stage-number">02</div>
                    <div class="stage-icon-premium transform">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="stage-content">
                        <h4 class="stage-title">Process</h4>
                        <p class="stage-desc">Stream Processing</p>
                    </div>
                    <div class="stage-tech-stack">
                        <a href="https://flink.apache.org/" target="_blank" class="tech-mini"><i class="fas fa-water"></i> Flink</a>
                        <a href="https://spark.apache.org/streaming/" target="_blank" class="tech-mini"><i class="devicon-apachespark-original colored"></i> Spark</a>
                        <a href="https://kafka.apache.org/documentation/streams/" target="_blank" class="tech-mini"><i class="devicon-apachekafka-original"></i> Streams</a>
                        <a href="https://storm.apache.org/" target="_blank" class="tech-mini"><i class="fas fa-wind"></i> Storm</a>
                    </div>
                </div>
                <div class="stage-arrow"><i class="fas fa-arrow-right"></i></div>

                <!-- Stage 3: Store -->
                <div class="pipeline-stage-card">
                    <div class="stage-number">03</div>
                    <div class="stage-icon-premium load">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="stage-content">
                        <h4 class="stage-title">Store</h4>
                        <p class="stage-desc">Real-time Storage</p>
                    </div>
                    <div class="stage-tech-stack">
                        <a href="https://redis.io/" target="_blank" class="tech-mini"><i class="devicon-redis-plain colored"></i> Redis</a>
                        <a href="https://www.elastic.co/" target="_blank" class="tech-mini"><i class="devicon-elasticsearch-plain colored"></i> Elastic</a>
                        <a href="https://cassandra.apache.org/" target="_blank" class="tech-mini"><i class="fas fa-eye"></i> Cassandra</a>
                        <a href="https://clickhouse.com/" target="_blank" class="tech-mini"><i class="fas fa-mouse-pointer"></i> ClickHouse</a>
                    </div>
                </div>
                <div class="stage-arrow"><i class="fas fa-arrow-right"></i></div>

                <!-- Stage 4: Serve -->
                <div class="pipeline-stage-card">
                    <div class="stage-number">04</div>
                    <div class="stage-icon-premium serve">
                        <i class="fas fa-desktop"></i>
                    </div>
                    <div class="stage-content">
                        <h4 class="stage-title">Serve</h4>
                        <p class="stage-desc">Real-time Dashboards</p>
                    </div>
                    <div class="stage-tech-stack">
                        <a href="https://grafana.com/" target="_blank" class="tech-mini"><i class="devicon-grafana-original colored"></i> Grafana</a>
                        <a href="https://www.elastic.co/kibana" target="_blank" class="tech-mini"><i class="fas fa-chart-line"></i> Kibana</a>
                        <a href="https://superset.apache.org/" target="_blank" class="tech-mini"><i class="fas fa-tachometer-alt"></i> Superset</a>
                        <a href="https://socket.io/" target="_blank" class="tech-mini"><i class="fas fa-plug"></i> WebSockets</a>
                    </div>
                </div>
            </div>

            <!-- Orchestration Layer for Real-time -->
            <div class="pipeline-layers">
                <div class="layer-card orchestration">
                    <div class="layer-icon"><i class="fas fa-network-wired"></i></div>
                    <div class="layer-info">
                        <span class="layer-label">EVENT BROKER</span>
                        <span class="layer-name">Apache Kafka</span>
                    </div>
                    <div class="layer-status running">
                        <span class="status-indicator"></span>
                        <span>Streaming</span>
                    </div>
                    <div class="layer-extras">
                        <span class="extra-badge"><i class="fas fa-server"></i> 12 Brokers</span>
                        <span class="extra-badge"><i class="fas fa-layer-group"></i> 50 Topics</span>
                    </div>
                </div>
                <div class="layer-card quality">
                    <div class="layer-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="layer-info">
                        <span class="layer-label">SCHEMA REGISTRY</span>
                        <span class="layer-name">Confluent</span>
                    </div>
                    <div class="layer-status healthy">
                        <span class="status-indicator"></span>
                        <span>Validating</span>
                    </div>
                    <div class="layer-extras">
                        <span class="extra-badge"><i class="fas fa-file-code"></i> Avro/Proto</span>
                        <span class="extra-badge"><i class="fas fa-history"></i> Versioned</span>
                    </div>
                </div>
                <div class="layer-card observability">
                    <div class="layer-icon"><i class="fas fa-heartbeat"></i></div>
                    <div class="layer-info">
                        <span class="layer-label">MONITORING</span>
                        <span class="layer-name">Prometheus + Grafana</span>
                    </div>
                    <div class="layer-status monitoring">
                        <span class="status-indicator"></span>
                        <span>Live Metrics</span>
                    </div>
                    <div class="layer-extras">
                        <span class="extra-badge"><i class="fas fa-bell"></i> Alerting</span>
                        <span class="extra-badge"><i class="fas fa-chart-area"></i> Dashboards</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== BATCH PROCESSING PIPELINE ==================== -->
        <div id="pipeline-batch" class="pipeline-diagram-premium pipeline-mode">
            <!-- Pipeline Header -->
            <div class="pipeline-mode-header batch">
                <div class="mode-indicator">
                    <i class="fas fa-layer-group"></i>
                    <span>Batch Processing Pipeline</span>
                </div>
                <div class="mode-stats">
                    <span class="stat-pill"><i class="fas fa-database"></i> Petabytes</span>
                    <span class="stat-pill"><i class="fas fa-calendar-alt"></i> Daily/Hourly</span>
                    <span class="stat-pill"><i class="fas fa-check-double"></i> ACID Compliant</span>
                </div>
            </div>

            <!-- Animated Connection Line -->
            <div class="pipeline-connection-line batch-line">
                <div class="data-flow-animation"></div>
            </div>

            <!-- Pipeline Stages -->
            <div class="pipeline-stages-grid">
                <!-- Stage 1: Extract -->
                <div class="pipeline-stage-card">
                    <div class="stage-number">01</div>
                    <div class="stage-icon-premium extract">
                        <i class="fas fa-file-import"></i>
                    </div>
                    <div class="stage-content">
                        <h4 class="stage-title">Extract</h4>
                        <p class="stage-desc">Data Sources</p>
                    </div>
                    <div class="stage-tech-stack">
                        <a href="https://www.postgresql.org/" target="_blank" class="tech-mini"><i class="devicon-postgresql-plain colored"></i> PostgreSQL</a>
                        <a href="https://aws.amazon.com/s3/" target="_blank" class="tech-mini"><i class="devicon-amazonwebservices-plain-wordmark"></i> S3/GCS</a>
                        <a href="https://www.snowflake.com/" target="_blank" class="tech-mini"><i class="fas fa-snowflake"></i> APIs</a>
                        <a href="https://www.fivetran.com/" target="_blank" class="tech-mini"><i class="fas fa-plug"></i> Fivetran</a>
                    </div>
                </div>
                <div class="stage-arrow"><i class="fas fa-arrow-right"></i></div>

                <!-- Stage 2: Transform -->
                <div class="pipeline-stage-card">
                    <div class="stage-number">02</div>
                    <div class="stage-icon-premium transform">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div class="stage-content">
                        <h4 class="stage-title">Transform</h4>
                        <p class="stage-desc">ETL / ELT</p>
                    </div>
                    <div class="stage-tech-stack">
                        <a href="https://spark.apache.org/" target="_blank" class="tech-mini"><i class="devicon-apachespark-original colored"></i> Spark</a>
                        <a href="https://www.getdbt.com/" target="_blank" class="tech-mini"><i class="fas fa-code-branch"></i> dbt</a>
                        <a href="https://www.python.org/" target="_blank" class="tech-mini"><i class="devicon-python-plain colored"></i> Python</a>
                        <a href="https://pandas.pydata.org/" target="_blank" class="tech-mini"><i class="fas fa-table"></i> Pandas</a>
                    </div>
                </div>
                <div class="stage-arrow"><i class="fas fa-arrow-right"></i></div>

                <!-- Stage 3: Load -->
                <div class="pipeline-stage-card">
                    <div class="stage-number">03</div>
                    <div class="stage-icon-premium load">
                        <i class="fas fa-warehouse"></i>
                    </div>
                    <div class="stage-content">
                        <h4 class="stage-title">Load</h4>
                        <p class="stage-desc">Data Warehouse</p>
                    </div>
                    <div class="stage-tech-stack">
                        <a href="https://www.snowflake.com/" target="_blank" class="tech-mini"><i class="fas fa-snowflake"></i> Snowflake</a>
                        <a href="https://www.databricks.com/" target="_blank" class="tech-mini"><i class="fas fa-cubes"></i> Databricks</a>
                        <a href="https://cloud.google.com/bigquery" target="_blank" class="tech-mini"><i class="devicon-googlecloud-plain colored"></i> BigQuery</a>
                        <a href="https://aws.amazon.com/redshift/" target="_blank" class="tech-mini"><i class="devicon-amazonwebservices-plain-wordmark"></i> Redshift</a>
                    </div>
                </div>
                <div class="stage-arrow"><i class="fas fa-arrow-right"></i></div>

                <!-- Stage 4: Analyze -->
                <div class="pipeline-stage-card">
                    <div class="stage-number">04</div>
                    <div class="stage-icon-premium serve">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="stage-content">
                        <h4 class="stage-title">Analyze</h4>
                        <p class="stage-desc">BI & Analytics</p>
                    </div>
                    <div class="stage-tech-stack">
                        <a href="https://powerbi.microsoft.com/" target="_blank" class="tech-mini"><i class="fas fa-chart-pie"></i> Power BI</a>
                        <a href="https://www.tableau.com/" target="_blank" class="tech-mini"><i class="fas fa-chart-area"></i> Tableau</a>
                        <a href="https://looker.com/" target="_blank" class="tech-mini"><i class="fas fa-eye"></i> Looker</a>
                        <a href="https://metabase.com/" target="_blank" class="tech-mini"><i class="fas fa-chart-bar"></i> Metabase</a>
                    </div>
                </div>
            </div>

            <!-- Orchestration Layer for Batch -->
            <div class="pipeline-layers">
                <div class="layer-card orchestration">
                    <div class="layer-icon"><i class="devicon-apacheairflow-plain"></i></div>
                    <div class="layer-info">
                        <span class="layer-label">ORCHESTRATION</span>
                        <span class="layer-name">Apache Airflow</span>
                    </div>
                    <div class="layer-status running">
                        <span class="status-indicator"></span>
                        <span>DAG Active</span>
                    </div>
                    <div class="layer-extras">
                        <span class="extra-badge"><i class="fas fa-clock"></i> Cron: 0 6 * * *</span>
                        <span class="extra-badge"><i class="fas fa-redo"></i> Retries: 3</span>
                    </div>
                </div>
                <div class="layer-card quality">
                    <div class="layer-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="layer-info">
                        <span class="layer-label">DATA QUALITY</span>
                        <span class="layer-name">Great Expectations</span>
                    </div>
                    <div class="layer-status healthy">
                        <span class="status-indicator"></span>
                        <span>Tests Passing</span>
                    </div>
                    <div class="layer-extras">
                        <span class="extra-badge"><i class="fas fa-check-circle"></i> 47 Expectations</span>
                        <span class="extra-badge"><i class="fas fa-percentage"></i> 99.8% Pass</span>
                    </div>
                </div>
                <div class="layer-card observability">
                    <div class="layer-icon"><i class="fas fa-eye"></i></div>
                    <div class="layer-info">
                        <span class="layer-label">DATA CATALOG</span>
                        <span class="layer-name">DataHub / Atlan</span>
                    </div>
                    <div class="layer-status monitoring">
                        <span class="status-indicator"></span>
                        <span>Cataloging</span>
                    </div>
                    <div class="layer-extras">
                        <span class="extra-badge"><i class="fas fa-table"></i> 156 Tables</span>
                        <span class="extra-badge"><i class="fas fa-sitemap"></i> Lineage</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Airflow DAG Code -->
        <div class="dag-code-container glass-card" data-aos="fade-up" data-aos-delay="200">
            <div class="code-header">
                <div class="code-file">
                    <i class="devicon-python-plain colored"></i>
                    <span>etl_dag.py</span>
                </div>
                <div class="code-badges">
                    <span class="code-badge airflow"><i class="devicon-apacheairflow-plain"></i> Airflow 2.x</span>
                    <span class="code-badge python"><i class="devicon-python-plain"></i> Python 3.11</span>
                </div>
            </div>
            <div class="code-block">
                <pre><code class="language-python"><span class="code-comment"># etl_dag.py - Pipeline de datos completo</span>
<span class="code-keyword">from</span> airflow <span class="code-keyword">import</span> DAG
<span class="code-keyword">from</span> airflow.operators.python <span class="code-keyword">import</span> PythonOperator
<span class="code-keyword">from</span> airflow.providers.postgres.operators.postgres <span class="code-keyword">import</span> PostgresOperator
<span class="code-keyword">from</span> datetime <span class="code-keyword">import</span> datetime, timedelta

<span class="code-comment"># Configuraci√≥n del DAG</span>
default_args = &#123;
    <span class="code-string">'owner'</span>: <span class="code-string">'data-team'</span>,
    <span class="code-string">'depends_on_past'</span>: <span class="code-keyword">False</span>,
    <span class="code-string">'start_date'</span>: datetime(<span class="code-number">2025</span>, <span class="code-number">1</span>, <span class="code-number">1</span>),
    <span class="code-string">'retries'</span>: <span class="code-number">3</span>,
    <span class="code-string">'retry_delay'</span>: timedelta(minutes=<span class="code-number">5</span>),
&#125;

<span class="code-keyword">with</span> DAG(
    <span class="code-string">'etl_pipeline_prod'</span>,
    default_args=default_args,
    schedule_interval=<span class="code-string">'0 6 * * *'</span>,  <span class="code-comment"># Diario a las 6 AM</span>
    catchup=<span class="code-keyword">False</span>,
    tags=[<span class="code-string">'etl'</span>, <span class="code-string">'production'</span>]
) <span class="code-keyword">as</span> dag:

    <span class="code-comment"># Task 1: Extraer datos desde API</span>
    extract = PythonOperator(
        task_id=<span class="code-string">'extract_from_api'</span>,
        python_callable=extract_data
    )

    <span class="code-comment"># Task 2: Transformar con Spark</span>
    transform = PythonOperator(
        task_id=<span class="code-string">'transform_spark'</span>,
        python_callable=spark_transform
    )

    <span class="code-comment"># Task 3: Cargar a Data Warehouse</span>
    load = PostgresOperator(
        task_id=<span class="code-string">'load_to_warehouse'</span>,
        postgres_conn_id=<span class="code-string">'warehouse_conn'</span>,
        sql=<span class="code-string">'sql/load_facts.sql'</span>
    )

    <span class="code-comment"># Definir dependencias</span>
    extract >> transform >> load</code></pre>
            </div>
            <div class="code-footer">
                <span class="code-meta"><i class="fas fa-clock"></i> Schedule: Daily 6:00 AM</span>
                <span class="code-meta"><i class="fas fa-tags"></i> Tags: etl, production</span>
            </div>
        </div>
    </div>
</section>

<script>
    // Pipeline Mode Switcher
    function switchPipelineMode(mode: string) {
        // Update buttons
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.classList.remove('active');
            if ((btn as HTMLElement).dataset.mode === mode) {
                btn.classList.add('active');
            }
        });

        // Update pipeline views
        document.querySelectorAll('.pipeline-mode').forEach(pipeline => {
            pipeline.classList.remove('active');
        });

        const targetPipeline = document.getElementById(`pipeline-${mode}`);
        if (targetPipeline) {
            targetPipeline.classList.add('active');
        }
    }

    // Add event listeners
    document.getElementById('btn-realtime')?.addEventListener('click', () => switchPipelineMode('realtime'));
    document.getElementById('btn-batch')?.addEventListener('click', () => switchPipelineMode('batch'));
</script>
