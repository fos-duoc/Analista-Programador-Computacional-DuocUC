---
const base = import.meta.env.BASE_URL;
const currentPath = Astro.url.pathname;

// Determinar qué enlace está activo basado en la ruta actual
const isHome = currentPath === base || currentPath === base + 'index.html' || currentPath.endsWith('/');
const isStack = currentPath.includes('/stack');
const isArquitectura = currentPath.includes('/arquitectura');
const isRecursos = currentPath.includes('/recursos');
const isProyectos = currentPath.includes('/proyectos');
---

<header class="header" transition:persist>
    <div class="header-content">
        <a href={base} class="logo">
            <div class="logo-icon">
                <i class="fas fa-code"></i>
            </div>
            <div class="logo-text">
                <span class="logo-main">Duoc UC</span>
                <span class="logo-sub">Escuela de Informática</span>
            </div>
        </a>
        <nav class="nav">
            <a href={base} class={`nav-link ${isHome ? 'active' : ''}`}>Inicio</a>
            <a href={`${base}stack`} class={`nav-link ${isStack ? 'active' : ''}`}>Stack</a>
            <a href={`${base}arquitectura`} class={`nav-link ${isArquitectura ? 'active' : ''}`}>Arquitectura</a>
            <a href={`${base}recursos`} class={`nav-link ${isRecursos ? 'active' : ''}`}>Recursos</a>
            <a href={`${base}proyectos`} class={`nav-link ${isProyectos ? 'active' : ''}`}>Proyectos</a>
        </nav>
        <div class="header-actions">
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme" title="Cambiar tema">
                <i class="fas fa-moon" id="theme-icon-dark"></i>
                <i class="fas fa-sun" id="theme-icon-light"></i>
            </button>
            <a href="https://github.com/fos-duoc/Analista-Programador-Computacional-DuocUC" target="_blank" class="github-btn">
                <i class="fab fa-github"></i>
                <span>GitHub</span>
            </a>
        </div>
    </div>
</header>

<script is:inline>
    // Initialize on page load and after view transitions
    function initHeader() {
        const header = document.querySelector('.header');
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;

        // Header scroll effect
        function handleScroll() {
            if (window.scrollY > 50) {
                header?.classList.add('scrolled');
            } else {
                header?.classList.remove('scrolled');
            }
        }

        window.addEventListener('scroll', handleScroll);
        handleScroll(); // Initial check

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const href = this.getAttribute('href');
                if (href && href !== '#') {
                    const target = document.querySelector(href);
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                }
            });
        });

        // Theme Toggle - Persist across pages
        const savedTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', savedTheme);

        themeToggle?.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });
    }

    // Run on initial page load
    document.addEventListener('DOMContentLoaded', initHeader);

    // Run after Astro view transitions
    document.addEventListener('astro:page-load', initHeader);

    // Preserve theme during transitions
    document.addEventListener('astro:before-swap', (event) => {
        const theme = localStorage.getItem('theme') || 'dark';
        event.newDocument.documentElement.setAttribute('data-theme', theme);
    });
</script>
