---
/**
 * SubjectDrawer.astro
 * Panel lateral sofisticado para mostrar información detallada de asignaturas
 * Se activa al hacer clic en una asignatura desde la página Malla
 */
import { asignaturas, nombreCortoToId, type Asignatura } from '../data/asignaturas';

const base = import.meta.env.BASE_URL;
---

<!-- Overlay removed - drawer now works as a sidebar that coexists with other panels -->

<!-- Drawer Panel -->
<aside id="subject-drawer" class="subject-drawer" aria-hidden="true" role="dialog" aria-labelledby="drawer-title">
    <!-- Resize Handle - Left Edge -->
    <div class="drawer-resize-handle" id="drawer-resize-handle" title="Arrastrar para redimensionar">
        <div class="resize-grip">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>

    <!-- Header del Drawer -->
    <header class="drawer-header">
        <div class="drawer-header-content">
            <span class="drawer-badge" id="drawer-bimestre" data-premium-tooltip="Número de Bimestre|Identifica el período académico de la asignatura|B01-B10: APC,B11-B17: IDS|info|fa-calendar|BIMESTRE">B01</span>
            <span class="drawer-code" id="drawer-codigo" data-premium-tooltip="Código de Asignatura|Identificador único en el sistema académico|Formato: XXX0000|code|fa-hashtag|CÓDIGO">PRY1101</span>
        </div>
        <div class="drawer-controls">
            <!-- Panel Options Dropdown -->
            <div class="drawer-options-wrapper" id="drawer-options-wrapper">
                <button class="drawer-options-btn" id="drawer-options-btn" aria-label="Opciones del panel" aria-expanded="false" aria-haspopup="true" data-premium-tooltip="Opciones del Panel|Personaliza tamaño y secciones visibles|Compacto,Estándar,Expandido|tool|fa-sliders-h|PANEL">
                    <i class="fas fa-sliders-h"></i>
                    <i class="fas fa-chevron-down dropdown-chevron"></i>
                </button>
                <div class="drawer-options-dropdown" id="drawer-options-dropdown" role="menu">
                    <!-- Panel Size Section -->
                    <div class="dropdown-section">
                        <div class="dropdown-section-header">
                            <i class="fas fa-expand-alt"></i>
                            <span>Tamaño del Panel</span>
                        </div>
                        <div class="size-options">
                            <button class="size-option" data-width="420" role="menuitem">
                                <span class="size-icon"><i class="fas fa-compress-alt"></i></span>
                                <span class="size-label">Compacto</span>
                                <span class="size-value">420px</span>
                            </button>
                            <button class="size-option active" data-width="520" role="menuitem">
                                <span class="size-icon"><i class="fas fa-minus"></i></span>
                                <span class="size-label">Estándar</span>
                                <span class="size-value">520px</span>
                            </button>
                            <button class="size-option" data-width="680" role="menuitem">
                                <span class="size-icon"><i class="fas fa-expand"></i></span>
                                <span class="size-label">Expandido</span>
                                <span class="size-value">680px</span>
                            </button>
                            <button class="size-option" data-width="full" role="menuitem">
                                <span class="size-icon"><i class="fas fa-expand-arrows-alt"></i></span>
                                <span class="size-label">Máximo</span>
                                <span class="size-value">100%</span>
                            </button>
                        </div>
                    </div>

                    <div class="dropdown-divider"></div>

                    <!-- Quick Actions Section -->
                    <div class="dropdown-section">
                        <div class="dropdown-section-header">
                            <i class="fas fa-bolt"></i>
                            <span>Acciones Rápidas</span>
                        </div>
                        <div class="action-options">
                            <button class="action-option" data-action="copy" role="menuitem">
                                <i class="fas fa-copy"></i>
                                <span>Copiar Información</span>
                                <kbd>Ctrl+C</kbd>
                            </button>
                            <button class="action-option" data-action="share" role="menuitem">
                                <i class="fas fa-share-alt"></i>
                                <span>Compartir</span>
                            </button>
                            <button class="action-option" data-action="print" role="menuitem">
                                <i class="fas fa-print"></i>
                                <span>Imprimir Ficha</span>
                                <kbd>Ctrl+P</kbd>
                            </button>
                            <button class="action-option highlight" data-action="ask-tutor" role="menuitem">
                                <i class="fas fa-robot"></i>
                                <span>Preguntar al Tutor IA</span>
                                <span class="action-badge">AI</span>
                            </button>
                        </div>
                    </div>

                    <div class="dropdown-divider"></div>

                    <!-- Sections Toggle -->
                    <div class="dropdown-section">
                        <div class="dropdown-section-header">
                            <i class="fas fa-layer-group"></i>
                            <span>Secciones Visibles</span>
                            <button class="toggle-all-btn" id="toggle-all-sections" title="Mostrar/Ocultar todas">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="section-toggles">
                            <label class="section-toggle">
                                <input type="checkbox" data-section="indicators-section" checked />
                                <span class="toggle-switch"></span>
                                <span class="toggle-label"><i class="fas fa-signal"></i> Indicadores</span>
                            </label>
                            <label class="section-toggle">
                                <input type="checkbox" data-section="experiencias-section" checked />
                                <span class="toggle-switch"></span>
                                <span class="toggle-label"><i class="fas fa-route"></i> Experiencias</span>
                            </label>
                            <label class="section-toggle">
                                <input type="checkbox" data-section="tecnologias" checked />
                                <span class="toggle-switch"></span>
                                <span class="toggle-label"><i class="fas fa-code"></i> Tecnologías</span>
                            </label>
                            <label class="section-toggle">
                                <input type="checkbox" data-section="evaluaciones" checked />
                                <span class="toggle-switch"></span>
                                <span class="toggle-label"><i class="fas fa-clipboard-check"></i> Evaluaciones</span>
                            </label>
                            <label class="section-toggle">
                                <input type="checkbox" data-section="tips-section" checked />
                                <span class="toggle-switch"></span>
                                <span class="toggle-label"><i class="fas fa-lightbulb"></i> Tips</span>
                            </label>
                            <label class="section-toggle">
                                <input type="checkbox" data-section="projects-section" checked />
                                <span class="toggle-switch"></span>
                                <span class="toggle-label"><i class="fas fa-rocket"></i> Proyectos</span>
                            </label>
                            <label class="section-toggle">
                                <input type="checkbox" data-section="relevance-section" checked />
                                <span class="toggle-switch"></span>
                                <span class="toggle-label"><i class="fas fa-briefcase"></i> Relevancia</span>
                            </label>
                        </div>
                    </div>

                    <div class="dropdown-divider"></div>

                    <!-- More Options -->
                    <div class="dropdown-section compact">
                        <button class="action-option" data-action="new-tab" role="menuitem">
                            <i class="fas fa-external-link-alt"></i>
                            <span>Abrir en Nueva Pestaña</span>
                        </button>
                        <button class="action-option" data-action="github" role="menuitem">
                            <i class="fab fa-github"></i>
                            <span>Ver Materiales en GitHub</span>
                        </button>
                    </div>
                </div>
            </div>
            <!-- Zoom Controls -->
            <div class="drawer-zoom-controls" id="drawer-zoom-controls" data-premium-tooltip="Control de Zoom|Ajusta el tamaño del texto para mejor legibilidad|Rango: 70% - 150%,Doble-click: Resetear|view|fa-search-plus|PANEL">
                <button class="drawer-zoom-btn zoom-out" id="drawer-zoom-out-btn" data-premium-tooltip="Reducir Texto|Disminuye el tamaño de fuente del contenido|Mínimo: 70%|view|fa-minus|ZOOM">
                    <i class="fas fa-minus"></i>
                </button>
                <span class="drawer-zoom-level" id="drawer-zoom-level" data-premium-tooltip="Nivel de Zoom Actual|Porcentaje actual del tamaño de texto|100% es el tamaño por defecto|info|fa-percentage|ZOOM">100%</span>
                <button class="drawer-zoom-btn zoom-in" id="drawer-zoom-in-btn" data-premium-tooltip="Ampliar Texto|Aumenta el tamaño de fuente del contenido|Máximo: 150%|view|fa-plus|ZOOM">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="drawer-zoom-btn zoom-reset" id="drawer-zoom-reset-btn" data-premium-tooltip="Restablecer Zoom|Vuelve al tamaño de texto por defecto (100%)|Click para resetear|action|fa-undo|ZOOM">
                    <i class="fas fa-undo"></i>
                </button>
            </div>
            <button class="drawer-close" aria-label="Cerrar panel" id="drawer-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </header>

    <!-- Contenido scrolleable -->
    <div class="drawer-body">
        <!-- Título y Créditos -->
        <div class="drawer-title-section">
            <h2 class="drawer-title" id="drawer-title">Nombre de la Asignatura</h2>
            <!-- Stats Bar Premium con Tooltips -->
            <div class="stats-bar">
                <div class="stat-item" data-tooltip="Créditos académicos que aporta esta asignatura al plan de estudios">
                    <i class="fas fa-graduation-cap"></i>
                    <span class="stat-value" id="drawer-creditos-val">4</span>
                    <span class="stat-label">Créditos</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item" data-tooltip="Horas semanales de clases teóricas (cátedra, exposición)">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span class="stat-value" id="drawer-horas-teoricas">2</span>
                    <span class="stat-label">Teóricas</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item" data-tooltip="Horas semanales de laboratorio o taller práctico">
                    <i class="fas fa-laptop-code"></i>
                    <span class="stat-value" id="drawer-horas-practicas">4</span>
                    <span class="stat-label">Prácticas</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item total" data-tooltip="Total de horas presenciales por semana">
                    <i class="fas fa-clock"></i>
                    <span class="stat-value" id="drawer-horas-total">6</span>
                    <span class="stat-label">hrs/sem</span>
                </div>
            </div>
            <!-- Progress Bar del Bimestre -->
            <div class="bimestre-progress" id="drawer-bimestre-progress">
                <div class="progress-label">
                    <span>Progreso de la carrera</span>
                    <span class="progress-text" id="drawer-progress-text">Bimestre 1 de 10</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="drawer-progress-fill" style="width: 10%"></div>
                </div>
            </div>
        </div>

        <!-- Indicadores Premium (Dificultad, Horas Estudio, Keywords) -->
        <section class="drawer-section indicators-section" id="drawer-indicators-section">
            <div class="premium-indicators" id="drawer-premium-indicators">
                <div class="indicator-card difficulty-card" id="drawer-difficulty-card">
                    <div class="indicator-icon"><i class="fas fa-signal"></i></div>
                    <div class="indicator-info">
                        <span class="indicator-label">Dificultad</span>
                        <span class="indicator-value" id="drawer-dificultad">Básico</span>
                    </div>
                    <div class="difficulty-bar" id="drawer-difficulty-bar">
                        <span class="diff-dot active"></span>
                        <span class="diff-dot"></span>
                        <span class="diff-dot"></span>
                        <span class="diff-dot"></span>
                    </div>
                </div>
                <div class="indicator-card study-card">
                    <div class="indicator-icon"><i class="fas fa-book-reader"></i></div>
                    <div class="indicator-info">
                        <span class="indicator-label">Estudio Semanal</span>
                        <span class="indicator-value"><span id="drawer-horas-estudio">8</span> hrs</span>
                    </div>
                </div>
            </div>
            <div class="keywords-cloud" id="drawer-keywords-section">
                <div class="keywords-label"><i class="fas fa-tags"></i> Palabras Clave</div>
                <div class="keywords-list" id="drawer-palabras-clave">
                    <!-- Se llenan dinámicamente -->
                </div>
            </div>
        </section>

        <!-- Descripción y Propósito -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Resumen general de la asignatura y su contexto en el plan de estudios">
                <i class="fas fa-info-circle"></i> Descripción
            </h3>
            <p class="section-content" id="drawer-descripcion">
                Descripción de la asignatura...
            </p>
            <div class="proposito-box" id="drawer-proposito-box">
                <strong><i class="fas fa-bullseye"></i> Propósito:</strong>
                <span id="drawer-proposito">Propósito de la asignatura...</span>
            </div>
        </section>

        <!-- Objetivos de Aprendizaje -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Resultados de aprendizaje que lograrás al completar la asignatura">
                <i class="fas fa-target"></i> Objetivos de Aprendizaje
            </h3>
            <ul class="objectives-list" id="drawer-objetivos">
                <li>Objetivo 1</li>
                <li>Objetivo 2</li>
            </ul>
        </section>

        <!-- Competencias -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Habilidades profesionales que desarrollarás en esta asignatura">
                <i class="fas fa-award"></i> Competencias
            </h3>
            <div class="competencias-tags" id="drawer-competencias">
                <span class="competencia-tag">Competencia 1</span>
            </div>
        </section>

        <!-- Experiencias de Aprendizaje -->
        <section class="drawer-section experiencias-section">
            <h3 class="section-title" data-tooltip="Unidades temáticas con contenidos y actividades por semana">
                <i class="fas fa-route"></i> Experiencias de Aprendizaje
            </h3>
            <div class="experiencias-accordion" id="drawer-experiencias">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Tecnologías -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Herramientas, lenguajes y frameworks que usarás en esta asignatura">
                <i class="fas fa-code"></i> Tecnologías
            </h3>
            <div class="tech-grid" id="drawer-tecnologias">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Evaluaciones -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Instrumentos y ponderaciones para medir tu aprendizaje">
                <i class="fas fa-clipboard-check"></i> Sistema de Evaluación
            </h3>
            <div class="evaluaciones-list" id="drawer-evaluaciones">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Prerrequisitos y Conexiones -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Asignaturas que debes aprobar antes y las que se habilitan después">
                <i class="fas fa-project-diagram"></i> Prerrequisitos y Conexiones
            </h3>
            <div class="connections-grid" id="drawer-conexiones">
                <div class="connection-box prereq-box" data-tooltip="Asignaturas que debes haber aprobado para cursar esta">
                    <h4><i class="fas fa-arrow-left"></i> Prerrequisitos</h4>
                    <div id="drawer-prerrequisitos" class="connection-items">
                        <span class="no-prereq">Sin prerrequisitos</span>
                    </div>
                </div>
                <div class="connection-box next-box" data-tooltip="Asignaturas que podrás cursar después de aprobar esta">
                    <h4><i class="fas fa-arrow-right"></i> Habilita para</h4>
                    <div id="drawer-habilita" class="connection-items">
                        <span class="connection-item">POO II</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recursos -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Material de estudio recomendado: libros, tutoriales, documentación">
                <i class="fas fa-book-open"></i> Recursos de Aprendizaje
            </h3>
            <div class="recursos-grid" id="drawer-recursos">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Tips de Estudio -->
        <section class="drawer-section tips-section" id="drawer-tips-section">
            <h3 class="section-title" data-tooltip="Consejos prácticos para maximizar tu aprendizaje en esta asignatura">
                <i class="fas fa-lightbulb"></i> Tips de Estudio
            </h3>
            <div class="tips-list" id="drawer-tips">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Proyectos Sugeridos -->
        <section class="drawer-section projects-section" id="drawer-projects-section">
            <h3 class="section-title" data-tooltip="Ideas de proyectos para aplicar lo aprendido y fortalecer tu portafolio">
                <i class="fas fa-rocket"></i> Proyectos Sugeridos
            </h3>
            <div class="projects-grid" id="drawer-proyectos">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Relevancia Profesional -->
        <section class="drawer-section relevance-section" id="drawer-relevance-section">
            <h3 class="section-title" data-tooltip="Cómo esta asignatura aplica a diferentes roles profesionales en la industria">
                <i class="fas fa-briefcase"></i> Relevancia Profesional
            </h3>
            <div class="relevance-grid" id="drawer-relevancia">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>
    </div>

    <!-- Footer del Drawer -->
    <footer class="drawer-footer">
        <a href="#" class="drawer-cta" id="drawer-github-link" target="_blank">
            <i class="fab fa-github"></i> Ver materiales en GitHub
        </a>
    </footer>
</aside>

<style>
    /* ============================================
       DRAWER OVERLAY - REMOVED
       Now operates as a sidebar without overlay
       Drawer coexists with SubjectNavigationSidebar and AITutor
    ============================================ */

    /* ============================================
       DRAWER PANEL - Premium Enterprise Design
       - Slides in from right, below header
       - Header and navigation always accessible
       - Sophisticated typography with tight spacing
       - Responsive sizing with smooth transitions
    ============================================ */
    .subject-drawer {
        position: fixed;
        top: 70px;
        right: 320px; /* Aligned with minimized AI Tutor (320px) */
        width: 520px;
        max-width: 95vw;
        height: calc(100vh - 70px);
        background: linear-gradient(180deg, #0a0f1a 0%, #0f172a 40%, #1e293b 100%);
        border-left: 1px solid rgba(6, 182, 212, 0.3);
        z-index: 1001;
        transform: translateX(100%);
        visibility: hidden;
        /* Animation: 250ms (faster than 400ms per Material Design 3 guidelines) */
        /* Added right transition for Split Pane sync with AI Tutor */
        transition: transform 0.25s cubic-bezier(0.2, 0, 0, 1), visibility 0.25s ease, width 0.2s ease, right 0.15s ease;
        display: flex;
        flex-direction: column;
        box-shadow: -12px 0 48px rgba(0, 0, 0, 0.5), -4px 0 16px rgba(6, 182, 212, 0.05);
        font-size: 0.83rem;
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        letter-spacing: -0.015em;
    }

    .subject-drawer.open {
        transform: translateX(0);
        visibility: visible;
    }

    /* Expanded width mode */
    .subject-drawer.expanded-width {
        width: 680px;
    }

    /* Resizing state - disable transitions for smooth resize */
    .subject-drawer.resizing {
        transition: none !important;
        user-select: none;
    }

    /* ============================================
       RESIZE HANDLE - Left Edge
    ============================================ */
    .drawer-resize-handle {
        position: absolute;
        left: -3px;
        top: 0;
        width: 6px;
        height: 100%;
        cursor: ew-resize;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        transition: background 0.2s ease;
    }

    .drawer-resize-handle:hover,
    .drawer-resize-handle.active {
        background: linear-gradient(90deg,
            rgba(6, 182, 212, 0.4) 0%,
            rgba(6, 182, 212, 0.15) 50%,
            transparent 100%);
    }

    .drawer-resize-handle .resize-grip {
        display: flex;
        flex-direction: column;
        gap: 3px;
        opacity: 0;
        transition: opacity 0.2s ease;
    }

    .drawer-resize-handle:hover .resize-grip,
    .subject-drawer.resizing .drawer-resize-handle .resize-grip {
        opacity: 1;
    }

    .drawer-resize-handle .resize-grip span {
        width: 3px;
        height: 3px;
        background: rgba(6, 182, 212, 0.7);
        border-radius: 50%;
    }

    /* ============================================
       DRAWER HEADER - Premium Compact
    ============================================ */
    .drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0.85rem;
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.08), rgba(139, 92, 246, 0.08));
        border-bottom: 1px solid rgba(6, 182, 212, 0.2);
        flex-shrink: 0;
    }

    .drawer-header-content {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .drawer-badge {
        background: linear-gradient(135deg, #06b6d4, #8b5cf6);
        color: white;
        padding: 0.28rem 0.6rem;
        border-radius: 8px;
        font-size: 0.68rem;
        font-weight: 700;
        font-family: 'Space Grotesk', monospace;
        letter-spacing: 0.02em;
        box-shadow: 0 2px 8px rgba(6, 182, 212, 0.25);
    }

    .drawer-code {
        color: #a1a1aa;
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
        font-size: 0.7rem;
        padding: 0.22rem 0.45rem;
        background: rgba(148, 163, 184, 0.08);
        border-radius: 4px;
        letter-spacing: 0.04em;
        border: 1px solid rgba(148, 163, 184, 0.1);
    }

    .drawer-controls {
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    /* ============================================
       DRAWER ZOOM CONTROLS - Premium Enterprise
    ============================================ */
    .drawer-zoom-controls {
        display: flex;
        align-items: center;
        gap: 0.2rem;
        padding: 0.15rem 0.3rem;
        background: rgba(139, 92, 246, 0.08);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 8px;
        margin-right: 0.3rem;
    }

    .drawer-zoom-btn {
        width: 22px;
        height: 22px;
        border-radius: 5px;
        border: 1px solid transparent;
        background: rgba(139, 92, 246, 0.12);
        color: #c4b5fd;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-size: 0.55rem;
    }

    .drawer-zoom-btn:hover {
        background: rgba(139, 92, 246, 0.25);
        border-color: rgba(139, 92, 246, 0.4);
        color: #e9d5ff;
        transform: scale(1.08);
    }

    .drawer-zoom-btn:active {
        transform: scale(0.95);
    }

    .drawer-zoom-level {
        font-size: 0.55rem;
        color: #a78bfa;
        font-weight: 600;
        min-width: 32px;
        text-align: center;
        padding: 0 0.15rem;
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
    }

    :global([data-theme="light"]) .drawer-zoom-controls {
        background: rgba(139, 92, 246, 0.06);
        border-color: rgba(139, 92, 246, 0.18);
    }

    :global([data-theme="light"]) .drawer-zoom-btn {
        background: rgba(139, 92, 246, 0.1);
        color: #7c3aed;
    }

    :global([data-theme="light"]) .drawer-zoom-btn:hover {
        background: rgba(139, 92, 246, 0.2);
        color: #6d28d9;
    }

    :global([data-theme="light"]) .drawer-zoom-level {
        color: #7c3aed;
    }

    /* ============================================
       DRAWER OPTIONS DROPDOWN - Premium Enterprise
    ============================================ */
    .drawer-options-wrapper {
        position: relative;
    }

    .drawer-options-btn {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.3rem 0.5rem;
        border-radius: 6px;
        border: 1px solid rgba(6, 182, 212, 0.25);
        background: rgba(6, 182, 212, 0.08);
        color: #22d3ee;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.6rem;
    }

    .drawer-options-btn:hover {
        background: rgba(6, 182, 212, 0.18);
        border-color: rgba(6, 182, 212, 0.45);
    }

    .drawer-options-btn[aria-expanded="true"] {
        background: rgba(6, 182, 212, 0.25);
        border-color: rgba(6, 182, 212, 0.55);
    }

    .drawer-options-btn .dropdown-chevron {
        font-size: 0.45rem;
        transition: transform 0.2s ease;
    }

    .drawer-options-btn[aria-expanded="true"] .dropdown-chevron {
        transform: rotate(180deg);
    }

    .drawer-options-dropdown {
        position: absolute;
        top: calc(100% + 6px);
        right: 0;
        width: 280px;
        max-height: 0;
        overflow: hidden;
        background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
        border: 1px solid rgba(6, 182, 212, 0.3);
        border-radius: 12px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(6, 182, 212, 0.1);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-8px);
        transition: all 0.25s cubic-bezier(0.2, 0, 0, 1);
        z-index: 1000;
    }

    .drawer-options-dropdown.open {
        max-height: 600px;
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        overflow-y: auto;
    }

    .drawer-options-dropdown::-webkit-scrollbar {
        width: 4px;
    }

    .drawer-options-dropdown::-webkit-scrollbar-thumb {
        background: rgba(6, 182, 212, 0.3);
        border-radius: 2px;
    }

    .dropdown-section {
        padding: 0.6rem;
    }

    .dropdown-section.compact {
        padding: 0.4rem 0.6rem;
    }

    .dropdown-section-header {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.3rem 0.4rem;
        margin-bottom: 0.5rem;
        font-size: 0.6rem;
        font-weight: 600;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .dropdown-section-header i {
        font-size: 0.55rem;
        color: #22d3ee;
    }

    .toggle-all-btn {
        margin-left: auto;
        padding: 0.2rem 0.35rem;
        border: 1px solid rgba(6, 182, 212, 0.2);
        border-radius: 4px;
        background: rgba(6, 182, 212, 0.1);
        color: #22d3ee;
        cursor: pointer;
        font-size: 0.5rem;
        transition: all 0.2s ease;
    }

    .toggle-all-btn:hover {
        background: rgba(6, 182, 212, 0.2);
        border-color: rgba(6, 182, 212, 0.4);
    }

    .dropdown-divider {
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(6, 182, 212, 0.2), transparent);
        margin: 0;
    }

    /* Size Options Grid */
    .size-options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.35rem;
    }

    .size-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.2rem;
        padding: 0.5rem 0.4rem;
        border: 1px solid rgba(100, 116, 139, 0.2);
        border-radius: 8px;
        background: rgba(30, 41, 59, 0.5);
        color: #94a3b8;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .size-option:hover {
        border-color: rgba(6, 182, 212, 0.4);
        background: rgba(6, 182, 212, 0.1);
        color: #e2e8f0;
    }

    .size-option.active {
        border-color: rgba(6, 182, 212, 0.6);
        background: rgba(6, 182, 212, 0.15);
        color: #22d3ee;
    }

    .size-option .size-icon {
        font-size: 0.75rem;
    }

    .size-option .size-label {
        font-size: 0.58rem;
        font-weight: 600;
    }

    .size-option .size-value {
        font-size: 0.48rem;
        color: #64748b;
        font-family: 'JetBrains Mono', monospace;
    }

    .size-option.active .size-value {
        color: #67e8f9;
    }

    /* Action Options List */
    .action-options {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }

    .action-option {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.45rem 0.6rem;
        border: none;
        border-radius: 6px;
        background: transparent;
        color: #cbd5e1;
        cursor: pointer;
        transition: all 0.15s ease;
        text-align: left;
        font-size: 0.62rem;
        width: 100%;
    }

    .action-option:hover {
        background: rgba(6, 182, 212, 0.12);
        color: #e2e8f0;
    }

    .action-option i {
        width: 16px;
        text-align: center;
        font-size: 0.58rem;
        color: #64748b;
    }

    .action-option:hover i {
        color: #22d3ee;
    }

    .action-option span {
        flex: 1;
    }

    .action-option kbd {
        padding: 0.15rem 0.35rem;
        font-size: 0.48rem;
        font-family: 'JetBrains Mono', monospace;
        background: rgba(100, 116, 139, 0.2);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 4px;
        color: #64748b;
    }

    .action-option.highlight {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(6, 182, 212, 0.1));
        border: 1px solid rgba(139, 92, 246, 0.25);
    }

    .action-option.highlight:hover {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.25), rgba(6, 182, 212, 0.15));
        border-color: rgba(139, 92, 246, 0.4);
    }

    .action-option.highlight i {
        color: #a78bfa;
    }

    .action-badge {
        padding: 0.12rem 0.35rem;
        font-size: 0.45rem;
        font-weight: 700;
        background: linear-gradient(135deg, #8b5cf6, #06b6d4);
        color: white;
        border-radius: 4px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    /* Section Toggles */
    .section-toggles {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .section-toggle {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.35rem 0.5rem;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.15s ease;
    }

    .section-toggle:hover {
        background: rgba(100, 116, 139, 0.1);
    }

    .section-toggle input[type="checkbox"] {
        display: none;
    }

    .toggle-switch {
        position: relative;
        width: 28px;
        height: 16px;
        background: rgba(100, 116, 139, 0.3);
        border-radius: 8px;
        transition: all 0.2s ease;
        flex-shrink: 0;
    }

    .toggle-switch::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 12px;
        height: 12px;
        background: #64748b;
        border-radius: 50%;
        transition: all 0.2s ease;
    }

    .section-toggle input:checked + .toggle-switch {
        background: rgba(6, 182, 212, 0.4);
    }

    .section-toggle input:checked + .toggle-switch::after {
        left: 14px;
        background: #22d3ee;
    }

    .toggle-label {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.58rem;
        color: #94a3b8;
    }

    .section-toggle:hover .toggle-label {
        color: #e2e8f0;
    }

    .toggle-label i {
        font-size: 0.52rem;
        color: #64748b;
        width: 14px;
        text-align: center;
    }

    /* Light Theme */
    :global([data-theme="light"]) .drawer-options-dropdown {
        background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
        border-color: rgba(6, 182, 212, 0.25);
    }

    :global([data-theme="light"]) .dropdown-section-header {
        color: #475569;
    }

    :global([data-theme="light"]) .size-option {
        background: rgba(255, 255, 255, 0.8);
        color: #475569;
        border-color: rgba(148, 163, 184, 0.3);
    }

    :global([data-theme="light"]) .size-option:hover,
    :global([data-theme="light"]) .size-option.active {
        background: rgba(6, 182, 212, 0.1);
        color: #0891b2;
    }

    :global([data-theme="light"]) .action-option {
        color: #334155;
    }

    :global([data-theme="light"]) .action-option:hover {
        background: rgba(6, 182, 212, 0.1);
    }

    :global([data-theme="light"]) .toggle-label {
        color: #475569;
    }

    .drawer-close {
        width: 22px;
        height: 22px;
        border-radius: 50%;
        border: 1px solid rgba(239, 68, 68, 0.25);
        background: rgba(239, 68, 68, 0.08);
        color: #ef4444;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-size: 0.55rem;
    }

    .drawer-close:hover {
        background: rgba(239, 68, 68, 0.18);
        border-color: #ef4444;
        transform: rotate(90deg);
    }

    /* ============================================
       DRAWER BODY (Scrollable) - Structured Layout
       Includes gradient scrim for scroll indicator
    ============================================ */
    .drawer-body {
        flex: 1;
        overflow-y: auto;
        padding: 0.5rem 0.85rem;
        scrollbar-width: thin;
        scrollbar-color: rgba(6, 182, 212, 0.3) transparent;
        position: relative;
    }

    .drawer-body::-webkit-scrollbar {
        width: 5px;
    }

    .drawer-body::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.5);
    }

    .drawer-body::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, rgba(6, 182, 212, 0.4), rgba(139, 92, 246, 0.3));
        border-radius: 3px;
    }

    /* Gradient scrim at bottom - indicates more content */
    .drawer-body::after {
        content: '';
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        height: 40px;
        background: linear-gradient(to top, rgba(15, 23, 42, 0.95), transparent);
        pointer-events: none;
        z-index: 1;
        display: block;
        margin-top: -40px;
    }

    /* ============================================
       TITLE SECTION - Academic & Industry-Focused
       Premium typography for professional learning
    ============================================ */
    .drawer-title-section {
        margin-bottom: 2px;
        padding-bottom: 2px;
        border-bottom: 2px solid transparent;
        border-image: linear-gradient(90deg, rgba(6, 182, 212, 0.4), rgba(139, 92, 246, 0.3), transparent) 1;
        position: relative;
    }

    .drawer-title {
        font-family: 'Sora', 'Poppins', sans-serif;
        font-size: 1.22rem;
        font-weight: 800;
        color: #f8fafc;
        margin: 0 0 0.15rem 0;
        line-height: 1.2;
        letter-spacing: -0.025em;
        background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 50%, #c4b5fd 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        /* Academic title shadow for depth */
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
    }

    .drawer-credits {
        display: flex;
        gap: 1rem;
    }

    .credit-item {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        color: #94a3b8;
        font-size: 0.75rem;
        font-weight: 500;
        font-family: 'Space Grotesk', sans-serif;
    }

    .credit-item i {
        color: #06b6d4;
        font-size: 0.7rem;
    }

    /* ============================================
       STATS BAR - Premium Horizontal Layout (Compact)
    ============================================ */
    .stats-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(30, 41, 59, 0.4);
        border-radius: 8px;
        padding: 0.25rem 0.5rem;
        margin-bottom: 2px;
        border: 1px solid rgba(6, 182, 212, 0.1);
    }

    .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.15rem;
        flex: 1;
    }

    .stat-item i {
        color: #06b6d4;
        font-size: 0.85rem;
        margin-bottom: 0.1rem;
    }

    .stat-item.total i {
        color: #8b5cf6;
    }

    .stat-value {
        font-family: 'JetBrains Mono', 'Space Grotesk', monospace;
        font-size: 1.1rem;
        font-weight: 700;
        color: #f8fafc;
        line-height: 1;
    }

    .stat-label {
        font-size: 0.58rem;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 500;
    }

    .stat-divider {
        width: 1px;
        height: 32px;
        background: linear-gradient(180deg, transparent, rgba(6, 182, 212, 0.3), transparent);
    }

    /* ============================================
       BIMESTRE PROGRESS BAR
    ============================================ */
    .bimestre-progress {
        background: rgba(15, 23, 42, 0.4);
        border-radius: 8px;
        padding: 0.25rem 0.5rem;
        border: 1px solid rgba(148, 163, 184, 0.08);
        margin-bottom: 2px;
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.15rem;
    }

    .progress-label span {
        font-size: 0.62rem;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        font-weight: 500;
    }

    .progress-text {
        font-family: 'JetBrains Mono', monospace;
        color: #94a3b8 !important;
    }

    .progress-track {
        height: 6px;
        background: rgba(30, 41, 59, 0.6);
        border-radius: 3px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #06b6d4, #8b5cf6, #ec4899);
        border-radius: 3px;
        transition: width 0.4s ease;
    }

    /* ============================================
       SECTIONS - Hyper-Compact Typography
       Minimal spacing - secciones muy juntas
    ============================================ */
    .drawer-section {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
        position: relative;
        margin-top: 0.35rem;
    }

    .drawer-section:first-child {
        margin-top: 0;
    }

    .drawer-section:last-child {
        margin-bottom: 0;
        border-bottom: none;
    }

    /* Section titles - Course Syllabus Style (Zero Gap) */
    .section-title {
        font-family: 'Space Grotesk', 'Sora', sans-serif;
        font-size: 0.62rem;
        font-weight: 700;
        color: #cbd5e1;
        margin: 0 0 1px 0;
        padding: 1px 0.3rem 1px 0.25rem;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.1), rgba(139, 92, 246, 0.05), transparent);
        border-radius: 0 6px 6px 0;
        border-left: 3px solid;
        border-image: linear-gradient(180deg, #22d3ee, #8b5cf6) 1;
        position: relative;
    }

    /* Subtle academic accent line */
    .section-title::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 3px;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.15), transparent);
    }

    .section-title i {
        color: #22d3ee;
        font-size: 0.6rem;
        opacity: 1;
        filter: drop-shadow(0 0 3px rgba(34, 211, 238, 0.3));
    }

    /* Main content typography - Zero Gap Study Reading */
    .section-content {
        color: #e2e8f0;
        font-size: 0.74rem;
        line-height: 1.35;
        margin: 0;
        padding-bottom: 0;
        font-family: 'Inter', 'Roboto', system-ui, sans-serif;
        letter-spacing: -0.005em;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-shadow: 0 0 1px rgba(0, 0, 0, 0.1);
    }

    /* Academic Drop Cap - Book chapter style (Compact) */
    .section-content::first-letter {
        font-size: 1.4em;
        font-weight: 800;
        font-family: 'Sora', serif;
        color: transparent;
        background: linear-gradient(135deg, #22d3ee, #8b5cf6);
        -webkit-background-clip: text;
        background-clip: text;
        float: left;
        line-height: 0.9;
        margin-right: 0.12em;
        margin-top: 0.08em;
        filter: drop-shadow(0 1px 2px rgba(34, 211, 238, 0.2));
    }

    /* Propósito Box - Structured Highlight (Ultra-Compact) */
    .proposito-box {
        margin-top: 0.15rem;
        margin-bottom: 0;
        padding: 0.15rem 0.35rem;
        background: rgba(6, 182, 212, 0.05);
        border-radius: 4px;
        border-left: 2px solid rgba(6, 182, 212, 0.5);
    }

    .proposito-box strong {
        color: #22d3ee;
        display: inline;
        font-size: 0.6rem;
        font-family: 'Space Grotesk', sans-serif;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin-right: 0.3rem;
    }

    .proposito-box strong i {
        margin-right: 0.15rem;
        font-size: 0.55rem;
    }

    .proposito-box span {
        color: #cbd5e1;
        font-size: 0.72rem;
        line-height: 1.4;
        font-family: 'Inter', system-ui, sans-serif;
        display: inline;
    }

    /* Objectives List - Learning Outcomes Style (Ultra-Compact) */
    .objectives-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 0.06rem;
        counter-reset: obj;
    }

    .objectives-list li {
        position: relative;
        padding: 0.18rem 0.35rem 0.18rem 1.7rem;
        color: #e2e8f0;
        font-size: 0.74rem;
        line-height: 1.35;
        font-family: 'Inter', system-ui, sans-serif;
        transition: all 0.2s ease;
        letter-spacing: -0.008em;
        counter-increment: obj;
        background: linear-gradient(90deg, rgba(30, 41, 59, 0.25), rgba(30, 41, 59, 0.1));
        border-radius: 5px;
        border-left: 2px solid transparent;
    }

    .objectives-list li:hover {
        color: #f8fafc;
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.08), rgba(30, 41, 59, 0.15));
        border-left-color: rgba(6, 182, 212, 0.5);
        transform: translateX(2px);
    }

    .objectives-list li::before {
        content: 'OA' counter(obj);
        position: absolute;
        left: 0.25rem;
        top: 50%;
        transform: translateY(-50%);
        padding: 0.08rem 0.25rem;
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(139, 92, 246, 0.15));
        border-radius: 4px;
        font-size: 0.48rem;
        font-weight: 700;
        color: #22d3ee;
        font-family: 'JetBrains Mono', monospace;
        letter-spacing: 0.02em;
        border: 1px solid rgba(6, 182, 212, 0.15);
    }

    /* Competencias Tags - Industry Skills Badges (Compact) */
    .competencias-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.2rem;
    }

    .competencia-tag {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.12), rgba(139, 92, 246, 0.06));
        color: #c4b5fd;
        padding: 0.18rem 0.4rem;
        border-radius: 14px;
        font-size: 0.64rem;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: 0.01em;
        border: 1px solid rgba(139, 92, 246, 0.2);
        transition: all 0.25s ease;
        position: relative;
        box-shadow: 0 1px 3px rgba(139, 92, 246, 0.08);
    }

    /* Skill level indicator dot */
    .competencia-tag::before {
        content: '';
        width: 5px;
        height: 5px;
        background: linear-gradient(135deg, #a78bfa, #8b5cf6);
        border-radius: 50%;
        margin-right: 0.25rem;
        display: inline-block;
        vertical-align: middle;
        box-shadow: 0 0 4px rgba(139, 92, 246, 0.4);
    }

    .competencia-tag:hover {
        background: rgba(139, 92, 246, 0.18);
        color: #c7d2fe;
        border-color: rgba(139, 92, 246, 0.3);
    }

    /* ============================================
       EXPERIENCIAS ACCORDION - Training Modules (Ultra-Compact)
    ============================================ */
    .experiencias-accordion {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .exp-card {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(30, 41, 59, 0.2));
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid rgba(148, 163, 184, 0.1);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }

    .exp-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.4rem 0.55rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .exp-header:hover {
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.08), transparent);
    }

    .exp-header-left {
        display: flex;
        align-items: center;
        gap: 0.45rem;
    }

    .exp-number {
        width: 22px;
        height: 22px;
        background: linear-gradient(135deg, #06b6d4, #0891b2);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.65rem;
        font-weight: 800;
        color: white;
        flex-shrink: 0;
        box-shadow: 0 2px 6px rgba(6, 182, 212, 0.3);
        font-family: 'JetBrains Mono', monospace;
        position: relative;
    }

    /* Module indicator accent */
    .exp-number::after {
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 8px;
        border: 1px solid rgba(6, 182, 212, 0.3);
    }

    .exp-info h4 {
        margin: 0;
        font-size: 0.75rem;
        font-weight: 700;
        color: #f1f5f9;
        line-height: 1.25;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: -0.01em;
    }

    .exp-info span {
        font-size: 0.58rem;
        color: #64748b;
        font-family: 'JetBrains Mono', monospace;
        letter-spacing: 0.02em;
        background: rgba(100, 116, 139, 0.15);
        padding: 0.08rem 0.28rem;
        border-radius: 3px;
        margin-top: 0.1rem;
        display: inline-block;
    }

    .exp-toggle {
        color: #475569;
        transition: transform 0.2s ease;
        font-size: 0.6rem;
    }

    .exp-card.expanded .exp-toggle {
        transform: rotate(180deg);
        color: #06b6d4;
    }

    .exp-content {
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        visibility: hidden;
        padding: 0;
        transition: max-height 0.3s ease, opacity 0.2s ease, visibility 0.2s ease;
    }

    .exp-card.expanded .exp-content {
        max-height: 800px;
        overflow-y: auto;
        opacity: 1;
        visibility: visible;
    }

    .exp-content-inner {
        padding: 0.35rem 0.5rem 0.45rem 1.8rem;
        border-left: 2px solid rgba(6, 182, 212, 0.2);
        margin-left: 0.6rem;
    }

    .exp-description {
        color: #94a3b8;
        font-size: 0.68rem;
        margin-bottom: 0.15rem;
        font-style: italic;
        line-height: 1.4;
    }

    .exp-subsection {
        margin-bottom: 0.1rem;
    }

    .exp-subsection:last-child {
        margin-bottom: 0;
    }

    .exp-subsection h5 {
        color: #64748b;
        font-size: 0.55rem;
        margin: 0 0 0.15rem 0;
        display: inline-flex;
        align-items: center;
        gap: 0.18rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-weight: 600;
    }

    .exp-subsection h5 i {
        color: #06b6d4;
        font-size: 0.5rem;
        opacity: 0.8;
    }

    .exp-subsection ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .exp-subsection li {
        position: relative;
        padding-left: 0.55rem;
        font-size: 0.66rem;
        color: #cbd5e1;
        margin-bottom: 0.1rem;
        line-height: 1.3;
    }

    .exp-subsection li::before {
        content: '›';
        position: absolute;
        left: 0;
        color: #06b6d4;
        font-size: 0.68rem;
        font-weight: 600;
    }

    /* Separator line between description/contenidos/actividades */
    .exp-separator {
        height: 1px;
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.3), rgba(139, 92, 246, 0.15), transparent);
        margin: 0.5rem 0;
        border-radius: 1px;
    }

    /* ============================================
       TECNOLOGÍAS GRID - Skill Badges (Compact)
    ============================================ */
    .tech-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.2rem;
    }

    .tech-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.28rem 0.5rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.5), rgba(30, 41, 59, 0.25));
        border-radius: 6px;
        border: 1px solid rgba(6, 182, 212, 0.12);
        transition: all 0.25s ease;
        position: relative;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.03);
    }

    /* Tech proficiency level indicator */
    .tech-chip::after {
        content: '';
        position: absolute;
        top: 3px;
        right: 3px;
        width: 4px;
        height: 4px;
        background: linear-gradient(135deg, #22d3ee, #06b6d4);
        border-radius: 50%;
        opacity: 0.7;
        box-shadow: 0 0 4px rgba(34, 211, 238, 0.4);
    }

    .tech-chip:hover {
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(6, 182, 212, 0.05));
        border-color: rgba(6, 182, 212, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(6, 182, 212, 0.15);
    }

    .tech-chip:hover::after {
        opacity: 1;
        animation: techPulse 1s infinite;
    }

    @keyframes techPulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.3); opacity: 0.7; }
    }

    .tech-chip i,
    .tech-chip img {
        font-size: 0.95rem;
        width: 15px;
        height: 15px;
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
    }

    .tech-chip span {
        color: #e2e8f0;
        font-size: 0.68rem;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: 0.01em;
    }

    /* ============================================
       EVALUACIONES - Assessment Style (Compact)
    ============================================ */
    .evaluaciones-list {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .eval-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.35rem 0.5rem;
        border-left: 3px solid var(--eval-color, #06b6d4);
        background: linear-gradient(90deg, rgba(30, 41, 59, 0.3), rgba(30, 41, 59, 0.15));
        border-radius: 0 6px 6px 0;
        position: relative;
        transition: all 0.2s ease;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
    }

    .eval-item:hover {
        background: linear-gradient(90deg, rgba(30, 41, 59, 0.4), rgba(30, 41, 59, 0.2));
        transform: translateX(2px);
    }

    .eval-item.formativa { --eval-color: #22c55e; }
    .eval-item.sumativa { --eval-color: #f59e0b; }
    .eval-item.prueba { --eval-color: #ef4444; }

    /* Visual weight indicator bar */
    .eval-item::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 3px;
        width: var(--eval-weight, 30%);
        height: 2px;
        background: linear-gradient(90deg, var(--eval-color, #06b6d4), transparent);
        opacity: 0.5;
        border-radius: 1px;
    }

    .eval-info {
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }

    .eval-info h4 {
        margin: 0;
        font-size: 0.72rem;
        color: #f1f5f9;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: -0.01em;
    }

    .eval-info span {
        font-size: 0.5rem;
        color: var(--eval-color, #06b6d4);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
        padding: 0.1rem 0.3rem;
        background: rgba(var(--eval-rgb, 6, 182, 212), 0.12);
        border-radius: 3px;
        font-family: 'Space Grotesk', sans-serif;
    }

    .eval-item.formativa .eval-info span { --eval-rgb: 34, 197, 94; }
    .eval-item.sumativa .eval-info span { --eval-rgb: 245, 158, 11; }
    .eval-item.prueba .eval-info span { --eval-rgb: 239, 68, 68; }

    .eval-percent {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.78rem;
        font-weight: 800;
        color: var(--eval-color, #06b6d4);
        text-shadow: 0 0 8px rgba(var(--eval-rgb, 6, 182, 212), 0.3);
        padding: 0.15rem 0.4rem;
        background: rgba(var(--eval-rgb, 6, 182, 212), 0.08);
        border-radius: 5px;
        border: 1px solid rgba(var(--eval-rgb, 6, 182, 212), 0.2);
    }

    /* ============================================
       CONEXIONES - Learning Path Map (Compact)
    ============================================ */
    .connections-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.25rem;
    }

    .connection-box {
        padding: 0.4rem 0.5rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.3), rgba(30, 41, 59, 0.15));
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.08);
        position: relative;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
    }

    .connection-box h4 {
        margin: 0 0 0.3rem 0;
        font-size: 0.52rem;
        color: #94a3b8;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 700;
        font-family: 'Space Grotesk', sans-serif;
    }

    .prereq-box {
        border-left: 3px solid rgba(245, 158, 11, 0.4);
    }

    .prereq-box h4 i {
        color: #f59e0b;
        font-size: 0.52rem;
        filter: drop-shadow(0 0 3px rgba(245, 158, 11, 0.3));
    }

    .next-box {
        border-left: 3px solid rgba(34, 197, 94, 0.4);
    }

    .next-box h4 i {
        color: #22c55e;
        font-size: 0.52rem;
        filter: drop-shadow(0 0 3px rgba(34, 197, 94, 0.3));
    }

    .connection-items {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
    }

    .connection-item {
        padding: 0.2rem 0.4rem;
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.12), rgba(6, 182, 212, 0.06));
        border-radius: 5px;
        font-size: 0.65rem;
        color: #67e8f9;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        border: 1px solid rgba(6, 182, 212, 0.15);
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .connection-item:hover {
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(6, 182, 212, 0.1));
        border-color: rgba(6, 182, 212, 0.3);
        transform: translateY(-1px);
    }

    .no-prereq {
        color: #64748b;
        font-size: 0.65rem;
        font-style: italic;
        font-family: 'Inter', system-ui, sans-serif;
        display: inline-flex;
        align-items: center;
        gap: 0.2rem;
    }

    .no-prereq::before {
        content: '✓';
        font-size: 0.6rem;
        color: #22c55e;
        font-style: normal;
    }

    /* ============================================
       RECURSOS - Academic Learning Center Style
       Library card catalog inspired design
    ============================================ */
    .recursos-grid {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }

    .recurso-link {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.35rem 0.5rem;
        text-decoration: none;
        border-radius: 6px;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.25), rgba(30, 41, 59, 0.1));
        transition: all 0.25s ease;
        border: 1px solid rgba(148, 163, 184, 0.06);
        position: relative;
        /* Academic card shadow */
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
    }

    .recurso-link:hover {
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(6, 182, 212, 0.03));
        border-color: rgba(6, 182, 212, 0.2);
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(6, 182, 212, 0.1);
    }

    /* Reading arrow indicator */
    .recurso-link::after {
        content: '→';
        position: absolute;
        right: 0.65rem;
        color: #475569;
        font-size: 0.7rem;
        opacity: 0;
        transform: translateX(-4px);
        transition: all 0.2s ease;
    }

    .recurso-link:hover::after {
        opacity: 1;
        transform: translateX(0);
        color: #22d3ee;
    }

    .recurso-icon {
        width: 26px;
        height: 26px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(6, 182, 212, 0.08));
        border-radius: 6px;
        flex-shrink: 0;
        border: 1px solid rgba(6, 182, 212, 0.15);
        /* Book spine effect */
        box-shadow: inset -2px 0 0 rgba(6, 182, 212, 0.1);
    }

    .recurso-icon i {
        color: #22d3ee;
        font-size: 0.7rem;
        filter: drop-shadow(0 1px 2px rgba(34, 211, 238, 0.2));
    }

    .recurso-info {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
        min-width: 0;
        flex: 1;
    }

    .recurso-info h5 {
        margin: 0;
        font-size: 0.72rem;
        color: #f1f5f9;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        letter-spacing: -0.01em;
    }

    .recurso-info span {
        font-size: 0.5rem;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-family: 'Space Grotesk', sans-serif;
        font-weight: 500;
    }

    /* ============================================
       PREMIUM INDICATORS - Dificultad, Estudio, Keywords
       Enterprise learning dashboard metrics
    ============================================ */
    .indicators-section {
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        margin-top: 1px !important;
        margin-bottom: 1px !important;
    }

    .premium-indicators {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.2rem;
        margin-bottom: 0.15rem;
    }

    .indicator-card {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.4rem 0.55rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(30, 41, 59, 0.2));
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.1);
        transition: all 0.25s ease;
    }

    .indicator-card:hover {
        border-color: rgba(6, 182, 212, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .indicator-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        flex-shrink: 0;
    }

    .difficulty-card .indicator-icon {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
        color: #22c55e;
    }

    .study-card .indicator-icon {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1));
        color: #a78bfa;
    }

    .indicator-icon i {
        font-size: 0.85rem;
    }

    .indicator-info {
        display: flex;
        flex-direction: column;
        gap: 0.1rem;
        flex: 1;
    }

    .indicator-label {
        font-size: 0.55rem;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
    }

    .indicator-value {
        font-size: 0.82rem;
        color: #f1f5f9;
        font-weight: 700;
        font-family: 'Inter', system-ui, sans-serif;
    }

    .difficulty-bar {
        display: flex;
        gap: 3px;
        margin-left: auto;
    }

    .diff-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: rgba(148, 163, 184, 0.2);
        transition: all 0.2s ease;
    }

    .diff-dot.active {
        background: #22c55e;
        box-shadow: 0 0 6px rgba(34, 197, 94, 0.5);
    }

    /* Difficulty levels colors */
    .difficulty-card[data-level="basico"] .diff-dot.active { background: #22c55e; box-shadow: 0 0 6px rgba(34, 197, 94, 0.5); }
    .difficulty-card[data-level="intermedio"] .diff-dot.active { background: #eab308; box-shadow: 0 0 6px rgba(234, 179, 8, 0.5); }
    .difficulty-card[data-level="avanzado"] .diff-dot.active { background: #f97316; box-shadow: 0 0 6px rgba(249, 115, 22, 0.5); }
    .difficulty-card[data-level="experto"] .diff-dot.active { background: #ef4444; box-shadow: 0 0 6px rgba(239, 68, 68, 0.5); }

    /* Keywords Cloud - Sophisticated Glassmorphism */
    .keywords-cloud {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.6), rgba(30, 41, 59, 0.3));
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 12px;
        padding: 0.6rem 0.7rem;
        border: 1px solid rgba(99, 102, 241, 0.15);
        margin-top: 4px;
        box-shadow:
            0 4px 16px rgba(0, 0, 0, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    .keywords-label {
        font-size: 0.65rem;
        color: #a5b4fc;
        font-weight: 700;
        margin-bottom: 0.4rem;
        display: flex;
        align-items: center;
        gap: 0.35rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
    }

    .keywords-label i {
        color: #818cf8;
        font-size: 0.7rem;
        filter: drop-shadow(0 0 4px rgba(129, 140, 248, 0.4));
    }

    .keywords-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
        justify-content: center;
    }

    /* Keyword Tags - Premium Glassmorphism Style */
    :global(.keyword-tag) {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        padding: 0.35rem 0.65rem;
        background: linear-gradient(135deg,
            rgba(99, 102, 241, 0.15),
            rgba(139, 92, 246, 0.08));
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 20px;
        border: 1px solid rgba(139, 92, 246, 0.2);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        box-shadow:
            0 2px 8px rgba(99, 102, 241, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.08);
        font-size: 0.68rem;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: 0.02em;
        color: #e0e7ff;
        cursor: default;
    }

    /* Shimmer effect on keyword tags */
    :global(.keyword-tag)::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg,
            transparent,
            rgba(255, 255, 255, 0.08),
            transparent);
        transition: left 0.5s ease;
    }

    /* Keyword indicator dot - gradient glow */
    :global(.keyword-tag)::before {
        content: '';
        width: 6px;
        height: 6px;
        background: linear-gradient(135deg, #a5b4fc, #818cf8);
        border-radius: 50%;
        display: inline-block;
        box-shadow: 0 0 6px rgba(129, 140, 248, 0.5);
        transition: all 0.3s ease;
    }

    :global(.keyword-tag:hover) {
        background: linear-gradient(135deg,
            rgba(99, 102, 241, 0.25),
            rgba(139, 92, 246, 0.15));
        border-color: rgba(167, 139, 250, 0.4);
        transform: translateY(-2px) scale(1.02);
        box-shadow:
            0 6px 20px rgba(99, 102, 241, 0.2),
            0 0 0 1px rgba(139, 92, 246, 0.1);
        color: #f5f3ff;
    }

    :global(.keyword-tag:hover)::after {
        left: 100%;
    }

    :global(.keyword-tag:hover)::before {
        background: linear-gradient(135deg, #c7d2fe, #a5b4fc);
        box-shadow: 0 0 10px rgba(167, 139, 250, 0.7);
        transform: scale(1.2);
    }

    /* Stagger animation for keywords */
    :global(.keyword-tag:nth-child(odd)) {
        animation: fadeInUp 0.4s ease backwards;
    }
    :global(.keyword-tag:nth-child(even)) {
        animation: fadeInUp 0.4s ease 0.05s backwards;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(8px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ============================================
       TIPS DE ESTUDIO - Academic Advice Cards
    ============================================ */
    .tips-list {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .tip-item {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        padding: 0.5rem 0.6rem;
        background: linear-gradient(135deg, rgba(234, 179, 8, 0.08), rgba(234, 179, 8, 0.03));
        border-radius: 8px;
        border-left: 3px solid #eab308;
        transition: all 0.25s ease;
    }

    .tip-item:hover {
        background: linear-gradient(135deg, rgba(234, 179, 8, 0.12), rgba(234, 179, 8, 0.05));
        transform: translateX(3px);
    }

    .tip-icon {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(234, 179, 8, 0.15);
        border-radius: 50%;
        flex-shrink: 0;
        margin-top: 0.1rem;
    }

    .tip-icon i {
        font-size: 0.55rem;
        color: #fbbf24;
    }

    .tip-text {
        font-size: 0.7rem;
        color: #e2e8f0;
        line-height: 1.45;
        font-family: 'Inter', system-ui, sans-serif;
    }

    /* ============================================
       PROYECTOS SUGERIDOS - Portfolio Builder
    ============================================ */
    .projects-grid {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }

    .project-card {
        padding: 0.65rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.35), rgba(30, 41, 59, 0.15));
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.08);
        transition: all 0.25s ease;
    }

    .project-card:hover {
        border-color: rgba(139, 92, 246, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(139, 92, 246, 0.1);
    }

    .project-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.35rem;
    }

    .project-name {
        font-size: 0.75rem;
        color: #f1f5f9;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }

    .project-name i {
        color: #a78bfa;
        font-size: 0.7rem;
    }

    .project-level {
        padding: 0.15rem 0.45rem;
        border-radius: 10px;
        font-size: 0.5rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.04em;
    }

    .project-level.principiante {
        background: rgba(34, 197, 94, 0.15);
        color: #4ade80;
        border: 1px solid rgba(34, 197, 94, 0.25);
    }

    .project-level.intermedio {
        background: rgba(234, 179, 8, 0.15);
        color: #fbbf24;
        border: 1px solid rgba(234, 179, 8, 0.25);
    }

    .project-level.avanzado {
        background: rgba(239, 68, 68, 0.15);
        color: #f87171;
        border: 1px solid rgba(239, 68, 68, 0.25);
    }

    .project-desc {
        font-size: 0.65rem;
        color: #94a3b8;
        line-height: 1.4;
        margin-bottom: 0.3rem;
    }

    .project-duration {
        font-size: 0.55rem;
        color: #64748b;
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    .project-duration i {
        color: #22d3ee;
        font-size: 0.5rem;
    }

    /* ============================================
       RELEVANCIA PROFESIONAL - Career Pathways
    ============================================ */
    .relevance-grid {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .relevance-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.6rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.3), rgba(30, 41, 59, 0.1));
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.06);
        transition: all 0.25s ease;
    }

    .relevance-item:hover {
        border-color: rgba(6, 182, 212, 0.25);
        transform: translateX(3px);
    }

    .relevance-icon {
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        flex-shrink: 0;
    }

    .relevance-item[data-importance="alta"] .relevance-icon {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
        color: #22c55e;
    }

    .relevance-item[data-importance="media"] .relevance-icon {
        background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1));
        color: #eab308;
    }

    .relevance-item[data-importance="baja"] .relevance-icon {
        background: linear-gradient(135deg, rgba(148, 163, 184, 0.2), rgba(148, 163, 184, 0.1));
        color: #94a3b8;
    }

    .relevance-icon i {
        font-size: 0.7rem;
    }

    .relevance-info {
        flex: 1;
        min-width: 0;
    }

    .relevance-role {
        font-size: 0.72rem;
        color: #f1f5f9;
        font-weight: 600;
        margin-bottom: 0.1rem;
    }

    .relevance-desc {
        font-size: 0.58rem;
        color: #94a3b8;
        line-height: 1.35;
    }

    .relevance-badge {
        padding: 0.15rem 0.4rem;
        border-radius: 8px;
        font-size: 0.48rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        flex-shrink: 0;
    }

    .relevance-badge.alta {
        background: rgba(34, 197, 94, 0.15);
        color: #4ade80;
    }

    .relevance-badge.media {
        background: rgba(234, 179, 8, 0.15);
        color: #fbbf24;
    }

    .relevance-badge.baja {
        background: rgba(148, 163, 184, 0.15);
        color: #94a3b8;
    }

    /* ============================================
       DRAWER FOOTER - Premium Study Action
       Professional learning platform style CTA
    ============================================ */
    .drawer-footer {
        padding: 0.5rem 0.7rem;
        border-top: 1px solid rgba(6, 182, 212, 0.15);
        flex-shrink: 0;
        background: linear-gradient(180deg, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.6));
    }

    .drawer-cta {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.45rem;
        width: 100%;
        padding: 0.55rem 0.8rem;
        background: linear-gradient(135deg, #06b6d4 0%, #0891b2 50%, #8b5cf6 100%);
        border-radius: 8px;
        color: white;
        text-decoration: none;
        font-weight: 700;
        font-size: 0.78rem;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: 0.02em;
        transition: all 0.25s ease;
        box-shadow:
            0 4px 16px rgba(6, 182, 212, 0.25),
            0 2px 6px rgba(139, 92, 246, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        position: relative;
        overflow: hidden;
    }

    /* Shimmer effect on hover */
    .drawer-cta::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
        transition: left 0.5s ease;
    }

    .drawer-cta:hover::before {
        left: 100%;
    }

    .drawer-cta:hover {
        transform: translateY(-3px);
        box-shadow:
            0 8px 24px rgba(6, 182, 212, 0.35),
            0 4px 12px rgba(139, 92, 246, 0.2);
    }

    .drawer-cta i {
        font-size: 1rem;
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
    }

    /* ============================================
       LIGHT MODE - Structured Styles
    ============================================ */

    :global([data-theme="light"]) .subject-drawer {
        background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
        border-left-color: rgba(6, 182, 212, 0.3);
        box-shadow: -8px 0 32px rgba(0, 0, 0, 0.08);
    }

    :global([data-theme="light"]) .drawer-header {
        background: rgba(241, 245, 249, 0.8);
        border-bottom-color: rgba(148, 163, 184, 0.15);
    }

    :global([data-theme="light"]) .drawer-code {
        color: #475569;
        background: rgba(71, 85, 105, 0.08);
    }

    :global([data-theme="light"]) .drawer-title {
        background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    :global([data-theme="light"]) .drawer-title-section {
        border-bottom-color: rgba(148, 163, 184, 0.15);
    }

    :global([data-theme="light"]) .stats-bar {
        background: rgba(241, 245, 249, 0.8);
        border-color: rgba(6, 182, 212, 0.15);
    }

    :global([data-theme="light"]) .stat-value {
        color: #0f172a;
    }

    :global([data-theme="light"]) .stat-label {
        color: #64748b;
    }

    :global([data-theme="light"]) .stat-divider {
        background: linear-gradient(180deg, transparent, rgba(6, 182, 212, 0.2), transparent);
    }

    :global([data-theme="light"]) .bimestre-progress {
        background: rgba(241, 245, 249, 0.6);
        border-color: rgba(148, 163, 184, 0.12);
    }

    :global([data-theme="light"]) .progress-label span {
        color: #475569;
    }

    :global([data-theme="light"]) .progress-track {
        background: rgba(226, 232, 240, 0.8);
    }

    :global([data-theme="light"]) .drawer-section {
        border-bottom-color: rgba(148, 163, 184, 0.08);
    }

    :global([data-theme="light"]) .section-title {
        color: #475569;
    }

    :global([data-theme="light"]) .credit-item {
        color: #64748b;
    }

    :global([data-theme="light"]) .section-content {
        color: #334155;
    }

    :global([data-theme="light"]) .proposito-box {
        background: rgba(6, 182, 212, 0.06);
        border-left-color: rgba(6, 182, 212, 0.4);
    }

    :global([data-theme="light"]) .proposito-box strong {
        color: #0891b2;
    }

    :global([data-theme="light"]) .proposito-box span {
        color: #334155;
    }

    :global([data-theme="light"]) .objectives-list li {
        color: #334155;
        background: rgba(241, 245, 249, 0.6);
    }

    :global([data-theme="light"]) .objectives-list li:hover {
        background: rgba(241, 245, 249, 0.9);
    }

    :global([data-theme="light"]) .objectives-list li::before {
        background: rgba(6, 182, 212, 0.12);
        color: #0891b2;
    }

    :global([data-theme="light"]) .competencia-tag {
        background: rgba(139, 92, 246, 0.08);
        color: #7c3aed;
        border-color: rgba(139, 92, 246, 0.12);
    }

    :global([data-theme="light"]) .exp-card {
        background: rgba(241, 245, 249, 0.6);
        border-color: rgba(148, 163, 184, 0.12);
    }

    :global([data-theme="light"]) .exp-number {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    :global([data-theme="light"]) .exp-info h4 {
        color: #1e293b;
    }

    :global([data-theme="light"]) .exp-info span {
        color: #64748b;
    }

    :global([data-theme="light"]) .exp-content-inner {
        border-left-color: rgba(6, 182, 212, 0.25);
    }

    :global([data-theme="light"]) .exp-description {
        color: #64748b;
    }

    :global([data-theme="light"]) .exp-subsection h5 {
        color: #475569;
    }

    :global([data-theme="light"]) .exp-subsection li {
        color: #334155;
    }

    :global([data-theme="light"]) .exp-subsection li::before {
        color: #0891b2;
    }

    :global([data-theme="light"]) .tech-chip {
        background: rgba(241, 245, 249, 0.8);
        border-color: rgba(148, 163, 184, 0.15);
    }

    :global([data-theme="light"]) .tech-chip span {
        color: #334155;
    }

    :global([data-theme="light"]) .eval-item {
        background: rgba(241, 245, 249, 0.5);
    }

    :global([data-theme="light"]) .eval-info h4 {
        color: #1e293b;
    }

    :global([data-theme="light"]) .eval-info span {
        color: #64748b;
    }

    :global([data-theme="light"]) .connection-box {
        background: rgba(241, 245, 249, 0.6);
    }

    :global([data-theme="light"]) .connection-box h4 {
        color: #475569;
    }

    :global([data-theme="light"]) .connection-item {
        background: rgba(6, 182, 212, 0.1);
        color: #0891b2;
    }

    :global([data-theme="light"]) .recurso-link {
        background: rgba(241, 245, 249, 0.6);
    }

    :global([data-theme="light"]) .recurso-link:hover {
        background: rgba(6, 182, 212, 0.08);
    }

    :global([data-theme="light"]) .recurso-icon {
        background: rgba(6, 182, 212, 0.08);
    }

    :global([data-theme="light"]) .recurso-info h5 {
        color: #1e293b;
    }

    /* Light mode gradient scrim */
    :global([data-theme="light"]) .drawer-body::after {
        background: linear-gradient(to top, rgba(248, 250, 252, 0.95), transparent);
    }

    :global([data-theme="light"]) .drawer-footer {
        background: rgba(248, 250, 252, 0.9);
        border-top-color: rgba(148, 163, 184, 0.12);
    }

    /* ============================================
       RESPONSIVE - Premium Breakpoints
    ============================================ */
    @media (max-width: 1400px) {
        .subject-drawer {
            width: 480px;
            right: 360px; /* Match AI Tutor 360px width at 1400px */
        }
        .subject-drawer.expanded-width {
            width: 620px;
        }
    }

    @media (max-width: 1200px) {
        .subject-drawer {
            right: 340px; /* Match AI Tutor 340px width at 1200px */
            width: 460px;
        }
        .subject-drawer.expanded-width {
            width: 580px;
        }
    }

    @media (max-width: 900px) {
        .subject-drawer {
            right: 0 !important;
            width: 100%;
            max-width: 520px;
        }
        .subject-drawer.expanded-width {
            width: 100%;
            max-width: 520px;
        }
    }

    @media (max-width: 600px) {
        .subject-drawer {
            width: 100%;
            max-width: 100%;
        }

        .drawer-title {
            font-size: 1rem;
        }

        .connections-grid {
            grid-template-columns: 1fr;
        }

        .drawer-credits {
            flex-direction: column;
            gap: 0.35rem;
        }

        .drawer-body {
            padding: 0.6rem 0.75rem;
        }

        .drawer-header {
            padding: 0.45rem 0.65rem;
        }

        .drawer-footer {
            padding: 0.5rem 0.75rem;
        }

        .tech-grid {
            gap: 0.25rem;
        }

        .tech-chip {
            padding: 0.28rem 0.45rem;
        }

        .competencias-tags {
            gap: 0.25rem;
        }
    }

    /* ============================================
       PREMIUM TOOLTIPS - Material Design 3 Style
       Sophisticated tooltips with soft animations
    ============================================ */
    [data-tooltip] {
        position: relative;
        cursor: help;
    }

    [data-tooltip]::before {
        content: attr(data-tooltip);
        position: absolute;
        bottom: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%) translateY(4px);
        padding: 0.55rem 0.75rem;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.97), rgba(30, 41, 59, 0.97));
        color: #e2e8f0;
        font-size: 0.68rem;
        font-family: 'Inter', system-ui, sans-serif;
        font-weight: 500;
        line-height: 1.45;
        letter-spacing: -0.01em;
        white-space: normal;
        max-width: 260px;
        min-width: 140px;
        border-radius: 8px;
        border: 1px solid rgba(6, 182, 212, 0.25);
        box-shadow:
            0 4px 16px rgba(0, 0, 0, 0.35),
            0 2px 8px rgba(6, 182, 212, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition:
            opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1),
            transform 0.2s cubic-bezier(0.4, 0, 0.2, 1),
            visibility 0.2s;
    }

    /* Tooltip arrow */
    [data-tooltip]::after {
        content: '';
        position: absolute;
        bottom: calc(100% + 4px);
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: rgba(15, 23, 42, 0.97);
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition:
            opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1),
            visibility 0.2s;
    }

    /* Show tooltip on hover */
    [data-tooltip]:hover::before {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(0);
    }

    [data-tooltip]:hover::after {
        opacity: 1;
        visibility: visible;
    }

    /* Tooltips for items at the top - show below */
    .stats-bar [data-tooltip]::before {
        bottom: auto;
        top: calc(100% + 8px);
        transform: translateX(-50%) translateY(-4px);
    }

    .stats-bar [data-tooltip]::after {
        bottom: auto;
        top: calc(100% + 4px);
        border-top-color: transparent;
        border-bottom-color: rgba(15, 23, 42, 0.97);
    }

    .stats-bar [data-tooltip]:hover::before {
        transform: translateX(-50%) translateY(0);
    }

    /* Light mode tooltips */
    :global([data-theme="light"]) [data-tooltip]::before {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.98));
        color: #1e293b;
        border-color: rgba(6, 182, 212, 0.2);
        box-shadow:
            0 4px 20px rgba(0, 0, 0, 0.12),
            0 2px 8px rgba(6, 182, 212, 0.08),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }

    :global([data-theme="light"]) [data-tooltip]::after {
        border-top-color: rgba(255, 255, 255, 0.98);
    }

    :global([data-theme="light"]) .stats-bar [data-tooltip]::after {
        border-top-color: transparent;
        border-bottom-color: rgba(255, 255, 255, 0.98);
    }

    /* ============================================
       DYNAMIC TYPOGRAPHY - Enhanced Content Styling
       Highlights, emphasis, visual hierarchy
    ============================================ */

    /* Highlighted/Important text */
    .highlight {
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.15), rgba(139, 92, 246, 0.1));
        padding: 0.1rem 0.35rem;
        border-radius: 4px;
        color: #22d3ee;
        font-weight: 600;
    }

    /* Underlined emphasis */
    .underline-accent {
        text-decoration: underline;
        text-decoration-color: rgba(6, 182, 212, 0.5);
        text-decoration-thickness: 2px;
        text-underline-offset: 3px;
    }

    /* Key term styling */
    .key-term {
        color: #a78bfa;
        font-weight: 600;
        font-family: 'Space Grotesk', sans-serif;
    }

    /* Enhanced bullets for objectives */
    .objectives-list li::marker {
        color: #06b6d4;
    }

    /* Animated hover for interactive elements */
    .proposito-box:hover {
        border-left-color: rgba(6, 182, 212, 0.8);
        background: rgba(6, 182, 212, 0.08);
        transition: all 0.25s ease;
    }

    /* Enhanced section titles with subtle animation */
    .section-title {
        transition: color 0.2s ease;
    }

    .section-title:hover {
        color: #94a3b8;
    }

    .section-title:hover i {
        color: #22d3ee;
        transform: scale(1.1);
        transition: all 0.2s ease;
    }

    /* Competencia tags with pulse on hover */
    .competencia-tag:hover {
        animation: tagPulse 0.3s ease;
    }

    @keyframes tagPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.03); }
    }

    /* Tech chip glow effect */
    .tech-chip:hover {
        box-shadow: 0 0 12px rgba(6, 182, 212, 0.2);
    }

    /* Connection item hover */
    .connection-item:hover {
        background: rgba(6, 182, 212, 0.18);
        transform: translateX(2px);
        transition: all 0.2s ease;
    }

    /* Recurso link enhanced hover */
    .recurso-link:hover .recurso-icon {
        background: rgba(6, 182, 212, 0.2);
        transform: scale(1.05);
        transition: all 0.2s ease;
    }

    .recurso-link:hover .recurso-info h5 {
        color: #22d3ee;
    }

    /* Progress bar shimmer effect */
    .progress-fill {
        position: relative;
        overflow: hidden;
    }

    .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        animation: shimmer 2.5s infinite;
    }

    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    /* Light mode dynamic typography */
    :global([data-theme="light"]) .highlight {
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.12), rgba(139, 92, 246, 0.08));
        color: #0891b2;
    }

    :global([data-theme="light"]) .underline-accent {
        text-decoration-color: rgba(6, 182, 212, 0.4);
    }

    :global([data-theme="light"]) .key-term {
        color: #7c3aed;
    }

    :global([data-theme="light"]) .section-title:hover {
        color: #475569;
    }

    :global([data-theme="light"]) .connection-item:hover {
        background: rgba(6, 182, 212, 0.12);
    }

    :global([data-theme="light"]) .recurso-link:hover .recurso-info h5 {
        color: #0891b2;
    }

    /* Disable tooltips on touch devices */
    @media (hover: none) {
        [data-tooltip]::before,
        [data-tooltip]::after {
            display: none;
        }
    }

    /* ============================================
       ANIMACIONES DE ENTRADA - Study-Focused
       Usando @keyframes con animation-fill-mode: forwards
       para mantener el estado visible después de la animación
    ============================================ */

    /* Keyframes para fade-in slide-up */
    @keyframes fadeSlideIn {
        from {
            opacity: 0;
            transform: translateY(12px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeScaleIn {
        from {
            opacity: 0;
            transform: scale(0.96);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    @keyframes fadeSlideX {
        from {
            opacity: 0;
            transform: translateX(-8px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Animaciones cuando el drawer está abierto */
    /* Usamos 'both' para aplicar opacity:0 durante el delay Y mantener el estado final */
    .subject-drawer.open .drawer-title-section {
        animation: fadeSlideIn 0.35s ease both;
        animation-delay: 0.08s;
    }

    .subject-drawer.open .drawer-section {
        animation: fadeSlideIn 0.35s ease both;
    }

    /* Staggered delays para cada sección */
    .subject-drawer.open .drawer-section:nth-child(1) { animation-delay: 0.12s; }
    .subject-drawer.open .drawer-section:nth-child(2) { animation-delay: 0.16s; }
    .subject-drawer.open .drawer-section:nth-child(3) { animation-delay: 0.20s; }
    .subject-drawer.open .drawer-section:nth-child(4) { animation-delay: 0.24s; }
    .subject-drawer.open .drawer-section:nth-child(5) { animation-delay: 0.28s; }
    .subject-drawer.open .drawer-section:nth-child(6) { animation-delay: 0.32s; }
    .subject-drawer.open .drawer-section:nth-child(7) { animation-delay: 0.36s; }
    .subject-drawer.open .drawer-section:nth-child(8) { animation-delay: 0.40s; }

    /* Stats bar entrada suave */
    .subject-drawer.open .stats-bar {
        animation: fadeScaleIn 0.3s ease both;
        animation-delay: 0.1s;
    }

    /* Progress bar entrada */
    .subject-drawer.open .bimestre-progress {
        animation: fadeSlideIn 0.3s ease both;
        animation-delay: 0.15s;
    }

    /* Experiencias accordion cards entrada */
    .subject-drawer.open .exp-card {
        animation: fadeSlideX 0.25s ease both;
    }

    .subject-drawer.open .exp-card:nth-child(1) { animation-delay: 0.26s; }
    .subject-drawer.open .exp-card:nth-child(2) { animation-delay: 0.30s; }
    .subject-drawer.open .exp-card:nth-child(3) { animation-delay: 0.34s; }
    .subject-drawer.open .exp-card:nth-child(4) { animation-delay: 0.38s; }

    /* Tech chips entrada */
    .subject-drawer.open .tech-chip {
        animation: fadeScaleIn 0.2s ease both;
    }

    /* Staggered tech chips */
    .subject-drawer.open .tech-chip:nth-child(1) { animation-delay: 0.30s; }
    .subject-drawer.open .tech-chip:nth-child(2) { animation-delay: 0.33s; }
    .subject-drawer.open .tech-chip:nth-child(3) { animation-delay: 0.36s; }
    .subject-drawer.open .tech-chip:nth-child(4) { animation-delay: 0.39s; }
    .subject-drawer.open .tech-chip:nth-child(5) { animation-delay: 0.42s; }
    .subject-drawer.open .tech-chip:nth-child(6) { animation-delay: 0.45s; }
    .subject-drawer.open .tech-chip:nth-child(7) { animation-delay: 0.48s; }
    .subject-drawer.open .tech-chip:nth-child(8) { animation-delay: 0.51s; }

    /* Evaluaciones entrada */
    .subject-drawer.open .eval-item {
        animation: fadeSlideX 0.2s ease both;
    }

    .subject-drawer.open .eval-item:nth-child(1) { animation-delay: 0.34s; }
    .subject-drawer.open .eval-item:nth-child(2) { animation-delay: 0.38s; }
    .subject-drawer.open .eval-item:nth-child(3) { animation-delay: 0.42s; }
    .subject-drawer.open .eval-item:nth-child(4) { animation-delay: 0.46s; }

    /* Connection boxes entrada */
    .subject-drawer.open .connection-box {
        animation: fadeSlideIn 0.25s ease both;
    }

    .subject-drawer.open .prereq-box { animation-delay: 0.38s; }
    .subject-drawer.open .next-box { animation-delay: 0.42s; }

    /* Recursos entrada */
    .subject-drawer.open .recurso-link {
        animation: fadeSlideX 0.2s ease both;
    }

    .subject-drawer.open .recurso-link:nth-child(1) { animation-delay: 0.42s; }
    .subject-drawer.open .recurso-link:nth-child(2) { animation-delay: 0.46s; }
    .subject-drawer.open .recurso-link:nth-child(3) { animation-delay: 0.50s; }

    /* Footer CTA entrada */
    .subject-drawer.open .drawer-footer .drawer-cta {
        animation: fadeSlideIn 0.3s ease both;
        animation-delay: 0.45s;
    }

    /* Reduce motion para usuarios que lo prefieren */
    @media (prefers-reduced-motion: reduce) {
        .subject-drawer.open .drawer-title-section,
        .subject-drawer.open .drawer-section,
        .subject-drawer.open .stats-bar,
        .subject-drawer.open .bimestre-progress,
        .subject-drawer.open .exp-card,
        .subject-drawer.open .tech-chip,
        .subject-drawer.open .eval-item,
        .subject-drawer.open .connection-box,
        .subject-drawer.open .recurso-link,
        .subject-drawer.open .drawer-footer .drawer-cta {
            animation: none;
            opacity: 1;
            transform: none;
        }
    }
</style>

<script define:vars={{ asignaturasData: asignaturas, nombreCortoToIdMap: nombreCortoToId }}>
    // Mapa de tooltips para palabras clave
    const keywordTooltips = {
        // Lenguajes de Programación
        'Python': 'Python|Lenguaje versátil para desarrollo, scripting y data science|Sintaxis limpia,Tipado dinámico|code|fa-python|LENGUAJE',
        'Java': 'Java|Lenguaje OOP robusto para aplicaciones enterprise|JVM,Multiplataforma|code|fa-java|LENGUAJE',
        'Java 17+': 'Java 17+|Versión LTS moderna con records, sealed classes y pattern matching|Records,Sealed Classes|code|fa-java|LENGUAJE',
        'JavaScript': 'JavaScript|Lenguaje del navegador y Node.js para desarrollo full-stack|ES6+,Async/Await|code|fa-js|LENGUAJE',
        'TypeScript': 'TypeScript|JavaScript con tipado estático para código más robusto|Interfaces,Generics|code|fa-code|LENGUAJE',
        'SQL': 'SQL|Lenguaje para consultas y manipulación de bases de datos|SELECT,JOIN,GROUP BY|code|fa-database|LENGUAJE',
        'C#': 'C#|Lenguaje moderno de Microsoft para .NET|LINQ,Async,Nullable|code|fa-microsoft|LENGUAJE',
        'PHP': 'PHP|Lenguaje backend popular para desarrollo web|Laravel,WordPress|code|fa-php|LENGUAJE',
        'Kotlin': 'Kotlin|Lenguaje moderno para Android y JVM|Null Safety,Coroutines|code|fa-android|LENGUAJE',
        'Swift': 'Swift|Lenguaje de Apple para iOS y macOS|Optionals,Protocol Oriented|code|fa-apple|LENGUAJE',
        'Go': 'Go|Lenguaje de Google para sistemas y microservicios|Goroutines,Channels|code|fa-google|LENGUAJE',
        'Rust': 'Rust|Lenguaje de sistemas con seguridad de memoria|Zero-cost abstractions|code|fa-cog|LENGUAJE',
        // Conceptos OOP
        'Clases': 'Clases|Plantillas para crear objetos con atributos y métodos|Encapsulación,Instancias|info|fa-cube|POO',
        'Objetos': 'Objetos|Instancias de clases que representan entidades del mundo real|Estado,Comportamiento|info|fa-cubes|POO',
        'Herencia': 'Herencia|Mecanismo para reutilizar código entre clases relacionadas|extends,super|info|fa-sitemap|POO',
        'Polimorfismo': 'Polimorfismo|Capacidad de objetos de responder de forma diferente al mismo mensaje|Override,Overload|info|fa-shapes|POO',
        'Encapsulamiento': 'Encapsulamiento|Ocultar detalles internos y exponer solo lo necesario|private,public,getters|info|fa-lock|POO',
        'Abstracción': 'Abstracción|Simplificar complejidad mostrando solo lo esencial|abstract,interface|info|fa-layer-group|POO',
        'Interfaces': 'Interfaces|Contratos que definen comportamiento sin implementación|implements,default methods|info|fa-plug|POO',
        'UML': 'UML|Lenguaje de modelado para diseño de software|Diagramas de clases,Secuencia|tool|fa-project-diagram|DISEÑO',
        // Estructuras de Datos
        'ArrayList': 'ArrayList|Lista dinámica basada en arrays con acceso indexado|add(),get(),size()|code|fa-list|ESTRUCTURA',
        'HashMap': 'HashMap|Estructura clave-valor con acceso O(1) promedio|put(),get(),containsKey()|code|fa-table|ESTRUCTURA',
        'LinkedList': 'LinkedList|Lista enlazada para inserciones/eliminaciones eficientes|addFirst(),removeLast()|code|fa-link|ESTRUCTURA',
        'Stack': 'Stack|Estructura LIFO para operaciones push/pop|push(),pop(),peek()|code|fa-layer-group|ESTRUCTURA',
        'Queue': 'Queue|Estructura FIFO para procesamiento en orden|offer(),poll(),peek()|code|fa-stream|ESTRUCTURA',
        'Tree': 'Tree|Estructura jerárquica para datos organizados|BST,AVL,Red-Black|code|fa-sitemap|ESTRUCTURA',
        'Graph': 'Graph|Estructura para relaciones entre nodos|BFS,DFS,Dijkstra|code|fa-project-diagram|ESTRUCTURA',
        // Excepciones y Error Handling
        'Excepciones': 'Excepciones|Manejo de errores en tiempo de ejecución|try-catch,throw,finally|code|fa-exclamation-triangle|JAVA',
        'Try-Catch': 'Try-Catch|Bloque para capturar y manejar excepciones|catch,finally,multi-catch|code|fa-shield-alt|ERROR',
        // IDEs y Herramientas
        'IntelliJ IDEA': 'IntelliJ IDEA|IDE profesional de JetBrains para Java y Kotlin|Refactoring,Debugging|tool|fa-laptop-code|IDE',
        'VS Code': 'VS Code|Editor ligero y extensible de Microsoft|Extensions,Terminal integrado|tool|fa-code|IDE',
        'Eclipse': 'Eclipse|IDE open source para desarrollo Java|Plugins,Workspace|tool|fa-moon|IDE',
        'NetBeans': 'NetBeans|IDE gratuito de Apache para Java|GUI Builder,Profiler|tool|fa-laptop-code|IDE',
        'Git': 'Git|Sistema de control de versiones distribuido|Branches,Commits,Merge|tool|fa-code-branch|CONTROL',
        'GitHub': 'GitHub|Plataforma de colaboración y hosting de código|Pull Requests,Actions|tool|fa-github|PLATAFORMA',
        'Docker': 'Docker|Contenedores para aplicaciones portátiles|Images,Containers,Compose|tool|fa-docker|DEVOPS',
        // Frameworks y Librerías
        'React': 'React|Librería de Facebook para interfaces de usuario|Components,Hooks,JSX|framework|fa-react|FRONTEND',
        'Angular': 'Angular|Framework de Google para aplicaciones web|TypeScript,RxJS,CLI|framework|fa-angular|FRONTEND',
        'Vue': 'Vue.js|Framework progresivo para interfaces web|Reactivity,Composition API|framework|fa-vuejs|FRONTEND',
        'Spring': 'Spring|Framework Java para aplicaciones enterprise|DI,AOP,Boot|framework|fa-leaf|BACKEND',
        'Spring Boot': 'Spring Boot|Framework para microservicios Java con auto-configuración|Starters,Actuator|framework|fa-rocket|BACKEND',
        'Node.js': 'Node.js|Runtime JavaScript para servidor|NPM,Express,Event Loop|framework|fa-node-js|BACKEND',
        'Django': 'Django|Framework Python para desarrollo web rápido|ORM,Admin,MTV|framework|fa-python|BACKEND',
        'Laravel': 'Laravel|Framework PHP elegante con sintaxis expresiva|Eloquent,Blade,Artisan|framework|fa-laravel|BACKEND',
        // Bases de Datos
        'MySQL': 'MySQL|Base de datos relacional open source popular|InnoDB,Replication|database|fa-database|BD',
        'PostgreSQL': 'PostgreSQL|BD relacional avanzada con extensiones|JSONB,Full-text search|database|fa-database|BD',
        'MongoDB': 'MongoDB|Base de datos NoSQL orientada a documentos|JSON,Aggregation,Sharding|database|fa-database|NOSQL',
        'Redis': 'Redis|Almacén de datos en memoria ultra-rápido|Cache,Pub/Sub,Streams|database|fa-bolt|CACHE',
        'Oracle': 'Oracle|BD empresarial con alta disponibilidad|PL/SQL,RAC,Partitioning|database|fa-database|BD',
        // Patrones y Arquitectura
        'MVC': 'MVC|Patrón Model-View-Controller para separar responsabilidades|Modelo,Vista,Controlador|pattern|fa-th-large|PATRÓN',
        'REST': 'REST|Estilo arquitectónico para APIs web|HTTP Methods,Stateless|pattern|fa-exchange-alt|API',
        'API': 'API|Interfaz para comunicación entre sistemas|Endpoints,JSON,HTTP|pattern|fa-plug|INTEGRACIÓN',
        'Microservicios': 'Microservicios|Arquitectura de servicios pequeños e independientes|Desacoplado,Escalable|pattern|fa-cubes|ARQUITECTURA',
        'Clean Architecture': 'Clean Architecture|Arquitectura con capas independientes del framework|Entities,Use Cases|pattern|fa-layer-group|ARQUITECTURA',
        'SOLID': 'SOLID|5 principios de diseño orientado a objetos|SRP,OCP,LSP,ISP,DIP|pattern|fa-gem|PRINCIPIOS',
        // Testing
        'JUnit': 'JUnit|Framework de testing para Java|@Test,Assertions,Mocks|testing|fa-vial|TESTING',
        'Testing': 'Testing|Verificación de calidad del software|Unit,Integration,E2E|testing|fa-check-double|CALIDAD',
        'TDD': 'TDD|Desarrollo guiado por pruebas|Red-Green-Refactor|testing|fa-sync|METODOLOGÍA',
        // Cloud y DevOps
        'AWS': 'AWS|Servicios cloud de Amazon|EC2,S3,Lambda,RDS|cloud|fa-aws|CLOUD',
        'Azure': 'Azure|Plataforma cloud de Microsoft|App Service,Functions|cloud|fa-microsoft|CLOUD',
        'GCP': 'GCP|Google Cloud Platform|Compute,BigQuery,Kubernetes|cloud|fa-google|CLOUD',
        'CI/CD': 'CI/CD|Integración y despliegue continuo|Jenkins,GitHub Actions|devops|fa-infinity|DEVOPS',
        'Kubernetes': 'Kubernetes|Orquestación de contenedores|Pods,Services,Deployments|devops|fa-dharmachakra|DEVOPS',
        // Otros conceptos
        'Algoritmos': 'Algoritmos|Secuencias de pasos para resolver problemas|Ordenamiento,Búsqueda|info|fa-cogs|FUNDAMENTOS',
        'Recursión': 'Recursión|Técnica donde una función se llama a sí misma|Caso base,Caso recursivo|info|fa-redo|TÉCNICA',
        'Concurrencia': 'Concurrencia|Ejecución simultánea de múltiples tareas|Threads,Async,Parallel|info|fa-random|AVANZADO',
        'Seguridad': 'Seguridad|Protección de datos y sistemas|Autenticación,Encriptación|info|fa-shield-alt|SEGURIDAD',
        'Scrum': 'Scrum|Framework ágil para gestión de proyectos|Sprints,Daily,Retrospectiva|methodology|fa-users|AGILE',
        'Kanban': 'Kanban|Método visual para gestión del flujo de trabajo|Board,WIP Limits|methodology|fa-columns|AGILE',
        // Agile at Scale
        'SAFe Framework': 'SAFe Framework|Scaled Agile Framework para organizaciones enterprise|ARTs,PI Planning,Value Streams|methodology|fa-sitemap|AGILE SCALE',
        'LeSS': 'LeSS|Large-Scale Scrum para múltiples equipos|Sprint,Product Backlog único,Coordinación|methodology|fa-object-group|AGILE SCALE',
        'Nexus': 'Nexus|Framework de Scrum.org para 3-9 equipos Scrum|Integration Team,Nexus Sprint|methodology|fa-layer-group|AGILE SCALE',
        'Agile at Scale': 'Agile at Scale|Prácticas ágiles para organizaciones grandes|SAFe,LeSS,Nexus,Spotify Model|methodology|fa-expand-arrows-alt|AGILE SCALE',
        'PI Planning': 'PI Planning|Program Increment Planning, evento SAFe de 2 días|Objetivos,Dependencias,Riesgos|methodology|fa-calendar-check|SAFE',
        'Scrum of Scrums': 'Scrum of Scrums|Coordinación entre múltiples equipos Scrum|Representantes,Dependencias,Blockers|methodology|fa-users-cog|AGILE SCALE',
        // Liderazgo y Gestión
        'Technical Leadership': 'Technical Leadership|Liderazgo técnico de equipos de desarrollo|Mentoring,Decisiones técnicas,Code Reviews|leadership|fa-chess-king|LIDERAZGO',
        '1:1 Meetings': '1:1 Meetings|Reuniones individuales manager-reportes|Feedback,Career Growth,Blockers|leadership|fa-user-friends|GESTIÓN',
        'Stakeholder Management': 'Stakeholder Management|Gestión de interesados del proyecto|Expectativas,Comunicación,Poder/Interés|leadership|fa-handshake|GESTIÓN',
        'Executive Communication': 'Executive Communication|Comunicación efectiva con liderazgo ejecutivo|BLUF,Executive Summary,Datos|leadership|fa-comments-dollar|COMUNICACIÓN',
        // OKRs y Métricas
        'OKRs': 'OKRs|Objectives and Key Results, framework de Google|Objetivos,Resultados Clave,Alignment|methodology|fa-bullseye|MÉTRICAS',
        // Documentación Técnica
        'ADRs': 'ADRs|Architecture Decision Records para documentar decisiones|Contexto,Decisión,Consecuencias|documentation|fa-file-alt|DOCUMENTACIÓN',
        'RFCs': 'RFCs|Request for Comments, propuestas técnicas colaborativas|Diseño,Feedback,Consenso|documentation|fa-file-signature|DOCUMENTACIÓN',
        'Technical Writing': 'Technical Writing|Redacción técnica profesional|Documentación,Claridad,Audiencia|documentation|fa-pen-fancy|DOCUMENTACIÓN',
        'C4 Model': 'C4 Model|Modelo de diagramación arquitectónica|Context,Container,Component,Code|documentation|fa-project-diagram|ARQUITECTURA',
        // Testing avanzado
        'Selenium WebDriver': 'Selenium WebDriver|Automatización de pruebas web|Browser Automation,WebElements|testing|fa-robot|TESTING',
        'Cypress': 'Cypress|Framework moderno de testing E2E para web|Fast,Reliable,Time Travel|testing|fa-vial|TESTING',
        'Playwright': 'Playwright|Automatización cross-browser de Microsoft|Multi-browser,Auto-wait|testing|fa-theater-masks|TESTING',
        'JMeter': 'JMeter|Herramienta Apache para pruebas de carga|Performance,Load Testing|testing|fa-tachometer-alt|TESTING',
        'Cucumber': 'Cucumber|Framework BDD con sintaxis Gherkin|Given-When-Then,Scenarios|testing|fa-cucumber|TESTING',
        'Code Coverage': 'Code Coverage|Métrica de cobertura de pruebas|Lines,Branches,Functions|testing|fa-percentage|TESTING',
        // Frameworks y tecnologías adicionales
        'NestJS': 'NestJS|Framework Node.js enterprise con TypeScript|Modular,Decorators,DI|framework|fa-feather-alt|BACKEND',
        'Next.js': 'Next.js|Framework React para producción con SSR/SSG|Vercel,App Router,RSC|framework|fa-forward|FULLSTACK',
        'Prisma ORM': 'Prisma ORM|ORM moderno de TypeScript para Node.js|Schema,Migrations,Type-safe|tool|fa-database|ORM',
        'Turborepo': 'Turborepo|Monorepo build system de Vercel|Caching,Parallel,Pipelines|tool|fa-rocket|DEVOPS',
        'Vite': 'Vite|Build tool ultrarrápido para frontend|HMR,ES Modules,Rollup|tool|fa-bolt|FRONTEND',
        'Tailwind CSS': 'Tailwind CSS|Framework CSS utility-first|Responsive,Dark Mode,JIT|framework|fa-paint-brush|FRONTEND',
        'React Hooks': 'React Hooks|APIs funcionales de React|useState,useEffect,Custom Hooks|code|fa-fishing|REACT',
        'TanStack Query': 'TanStack Query|Gestión de estado servidor para React|Caching,Mutations,Queries|framework|fa-sync-alt|REACT',
        // Cloud avanzado
        'AWS Lambda': 'AWS Lambda|Compute serverless de Amazon|Functions,Event-driven,Pay-per-use|cloud|fa-lambda|AWS',
        'Amazon EC2': 'Amazon EC2|Máquinas virtuales escalables de AWS|Instances,Auto Scaling|cloud|fa-server|AWS',
        'Amazon S3': 'Amazon S3|Almacenamiento de objetos de AWS|Buckets,Versioning,Lifecycle|cloud|fa-archive|AWS',
        'Amazon VPC': 'Amazon VPC|Red virtual privada en AWS|Subnets,Security Groups|cloud|fa-network-wired|AWS',
        'Terraform': 'Terraform|Infrastructure as Code de HashiCorp|HCL,State,Modules,Providers|devops|fa-cubes|IAC',
        'Serverless': 'Serverless|Arquitectura sin gestión de servidores|FaaS,Pay-per-execution|cloud|fa-cloud|ARQUITECTURA',
        // Mensajería y eventos
        'RabbitMQ': 'RabbitMQ|Message broker open source|Queues,Exchanges,AMQP|messaging|fa-envelope|MENSAJERÍA',
        'Apache Kafka': 'Apache Kafka|Plataforma de streaming distribuido|Topics,Partitions,Consumers|messaging|fa-stream|MENSAJERÍA',
        'WebSockets': 'WebSockets|Protocolo de comunicación bidireccional|Real-time,Full-duplex,Events|protocol|fa-plug|COMUNICACIÓN',
        // Observabilidad
        'Prometheus': 'Prometheus|Sistema de monitoreo y alertas|Metrics,PromQL,Alertmanager|monitoring|fa-chart-line|OBSERVABILIDAD',
        'Grafana': 'Grafana|Plataforma de visualización de métricas|Dashboards,Alerting,DataSources|monitoring|fa-chart-area|OBSERVABILIDAD',
        'Jaeger': 'Jaeger|Distributed tracing de Uber|Spans,Traces,Service Maps|monitoring|fa-search|OBSERVABILIDAD',
        // Seguridad avanzada
        'OAuth 2.0': 'OAuth 2.0|Protocolo de autorización estándar|Access Tokens,Scopes,Grants|security|fa-key|SEGURIDAD',
        'JWT': 'JWT|JSON Web Tokens para autenticación|Claims,Signature,Payload|security|fa-id-badge|SEGURIDAD',
        'OWASP Top 10': 'OWASP Top 10|Top 10 riesgos de seguridad web|Injection,XSS,CSRF|security|fa-shield-alt|SEGURIDAD',
        // Arquitectura
        'CQRS': 'CQRS|Command Query Responsibility Segregation|Read/Write separation,Event Sourcing|pattern|fa-code-branch|ARQUITECTURA',
        'Event-Driven Architecture': 'Event-Driven|Arquitectura basada en eventos|Publishers,Subscribers,Event Bus|pattern|fa-broadcast-tower|ARQUITECTURA',
        'Domain-Driven Design': 'DDD|Domain-Driven Design de Eric Evans|Bounded Contexts,Aggregates,Entities|pattern|fa-puzzle-piece|ARQUITECTURA',
        'Hexagonal Architecture': 'Hexagonal Architecture|Ports & Adapters de Alistair Cockburn|Ports,Adapters,Domain Core|pattern|fa-hexagon|ARQUITECTURA',
        'gRPC': 'gRPC|Framework RPC de alto rendimiento de Google|Protocol Buffers,HTTP/2,Streaming|protocol|fa-exchange-alt|COMUNICACIÓN',
        // Mobile
        'React Native': 'React Native|Framework de Meta para apps móviles nativas|iOS,Android,Cross-platform|framework|fa-mobile-alt|MOBILE',
        'Expo SDK': 'Expo SDK|Plataforma para desarrollo React Native|Managed Workflow,OTA Updates|framework|fa-box|MOBILE',
        // Calidad y buenas prácticas
        'SonarQube': 'SonarQube|Plataforma de calidad de código continua|Static Analysis,Quality Gates|tool|fa-bug|CALIDAD',
        'Clean Code': 'Clean Code|Principios de código limpio de Uncle Bob|Legibilidad,Mantenibilidad|methodology|fa-broom|CALIDAD',
        'Design Patterns GoF': 'Design Patterns GoF|23 patrones clásicos de Gang of Four|Creational,Structural,Behavioral|pattern|fa-th|PATRONES',
        // Metodologías adicionales
        'Scrum Framework': 'Scrum Framework|Framework ágil más popular del mundo|Sprints,Roles,Artifacts,Events|methodology|fa-users|AGILE',
        'Sprint Planning': 'Sprint Planning|Ceremonia de planificación de Sprint|Sprint Goal,Backlog Selection|methodology|fa-tasks|SCRUM',
        'Sprint Retrospective': 'Sprint Retrospective|Ceremonia de mejora continua|What went well,Improvements|methodology|fa-redo|SCRUM',
        'Product Backlog': 'Product Backlog|Lista priorizada de requisitos del producto|User Stories,Refinement,Ordering|methodology|fa-list-ol|SCRUM',
        'Daily Standup': 'Daily Standup|Reunión diaria de 15 minutos|Yesterday,Today,Blockers|methodology|fa-comments|SCRUM',
        'Velocity': 'Velocity|Métrica de capacidad del equipo por Sprint|Story Points,Historical Data|methodology|fa-tachometer-alt|SCRUM',
        'Burndown Chart': 'Burndown Chart|Gráfico de trabajo restante vs tiempo|Ideal Line,Actual Progress|methodology|fa-chart-line|SCRUM'
    };

    // Función para obtener tooltip de keyword
    function getKeywordTooltip(keyword) {
        // Buscar coincidencia exacta o parcial
        if (keywordTooltips[keyword]) {
            return keywordTooltips[keyword];
        }
        // Buscar coincidencia parcial (case-insensitive)
        const lowerKw = keyword.toLowerCase();
        for (const [key, value] of Object.entries(keywordTooltips)) {
            if (key.toLowerCase() === lowerKw || lowerKw.includes(key.toLowerCase())) {
                return value;
            }
        }
        // Tooltip genérico si no se encuentra
        return `${keyword}|Concepto clave de la asignatura|Importante para el aprendizaje|info|fa-tag|KEYWORD`;
    }

    // Estado global del drawer
    window.subjectDrawerData = {
        asignaturas: asignaturasData,
        nombreCortoToId: nombreCortoToIdMap,
        currentSubject: null
    };

    // Función para abrir el drawer con una asignatura
    window.openSubjectDrawer = function(subjectId, subjectName = '') {
        const data = window.subjectDrawerData;
        // asignaturas es un objeto Record, no un array - acceder por clave directamente
        const asignatura = data.asignaturas[subjectId];

        if (!asignatura) {
            // Mostrar placeholder para asignaturas sin datos completos
            console.info('Asignatura sin datos completos:', subjectId, '- Mostrando placeholder');
            showPlaceholderContent(subjectId, subjectName);
        } else {
            data.currentSubject = asignatura;
            // Actualizar contenido del drawer
            updateDrawerContent(asignatura);
        }

        // Abrir el drawer
        const drawer = document.getElementById('subject-drawer');

        drawer?.classList.add('open');
        drawer?.setAttribute('aria-hidden', 'false');

        // Dispatch event for layout sync (no body scroll lock - sidebar mode)
        window.dispatchEvent(new CustomEvent('subjectDrawerToggle', { detail: { isOpen: true } }));
    };

    // Mostrar contenido placeholder para asignaturas sin datos completos
    function showPlaceholderContent(subjectId, subjectName) {
        // Extraer bimestre del ID si es posible
        const bimestreMatch = subjectId.match(/^(\d+)/);
        const bimestre = bimestreMatch ? bimestreMatch[1].padStart(2, '0') : '??';

        // Header
        document.getElementById('drawer-bimestre').textContent = `B${bimestre}`;
        document.getElementById('drawer-codigo').textContent = 'TBD';

        // Título y stats bar placeholders
        document.getElementById('drawer-title').textContent = subjectName || subjectId.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        document.getElementById('drawer-creditos-val').textContent = '--';
        document.getElementById('drawer-horas-teoricas').textContent = '--';
        document.getElementById('drawer-horas-practicas').textContent = '--';
        document.getElementById('drawer-horas-total').textContent = '--';

        // Progress bar placeholder
        const bimestreNum = parseInt(bimestre) || 1;
        const maxBim = bimestreNum <= 10 ? 10 : 17;
        document.getElementById('drawer-progress-fill').style.width = `${(bimestreNum / maxBim) * 100}%`;
        document.getElementById('drawer-progress-text').textContent = `Bimestre ${bimestreNum} de ${maxBim}`;

        // Descripción placeholder
        document.getElementById('drawer-descripcion').textContent = 'Información detallada próximamente. Esta asignatura está siendo documentada.';
        document.getElementById('drawer-proposito').textContent = 'El contenido completo de esta asignatura estará disponible pronto.';

        // Objetivos placeholder
        document.getElementById('drawer-objetivos').innerHTML = '<li>Contenido en desarrollo</li>';

        // Competencias placeholder
        document.getElementById('drawer-competencias').innerHTML = '<span class="competencia-tag">Próximamente</span>';

        // Experiencias placeholder
        document.getElementById('drawer-experiencias').innerHTML = `
            <div class="exp-card">
                <div class="exp-header">
                    <div class="exp-header-left">
                        <span class="exp-number">?</span>
                        <div class="exp-info">
                            <h4>Contenido en desarrollo</h4>
                            <span>Próximamente</span>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Tecnologías placeholder
        document.getElementById('drawer-tecnologias').innerHTML = '<div class="tech-chip"><i class="fas fa-code"></i><span>Por definir</span></div>';

        // Evaluaciones placeholder
        document.getElementById('drawer-evaluaciones').innerHTML = `
            <div class="eval-item">
                <div class="eval-info">
                    <h4>Sistema de evaluación</h4>
                    <span>Por definir</span>
                </div>
                <span class="eval-percent">--%</span>
            </div>
        `;

        // Prerrequisitos y conexiones
        document.getElementById('drawer-prerrequisitos').innerHTML = '<span class="no-prereq">Por definir</span>';
        document.getElementById('drawer-habilita').innerHTML = '<span class="no-prereq">Por definir</span>';

        // Recursos placeholder
        document.getElementById('drawer-recursos').innerHTML = `
            <a href="#" class="recurso-link" style="pointer-events: none;">
                <div class="recurso-icon"><i class="fas fa-hourglass-half"></i></div>
                <div class="recurso-info">
                    <h5>Recursos en desarrollo</h5>
                    <span>Próximamente disponibles</span>
                </div>
            </a>
        `;

        // GitHub link placeholder
        document.getElementById('drawer-github-link').href = '#';
        document.getElementById('drawer-github-link').innerHTML = '<i class="fas fa-hourglass-half"></i> Materiales próximamente';
    }

    // Función para cerrar el drawer
    window.closeSubjectDrawer = function() {
        const drawer = document.getElementById('subject-drawer');

        drawer?.classList.remove('open');
        drawer?.setAttribute('aria-hidden', 'true');

        // Dispatch event for layout sync
        window.dispatchEvent(new CustomEvent('subjectDrawerToggle', { detail: { isOpen: false } }));
    };

    // Función para actualizar el contenido del drawer
    function updateDrawerContent(asignatura) {
        // Header
        document.getElementById('drawer-bimestre').textContent = `B${asignatura.bimestre.toString().padStart(2, '0')}`;
        document.getElementById('drawer-codigo').textContent = asignatura.codigo;

        // Título y stats bar
        document.getElementById('drawer-title').textContent = asignatura.nombre;
        document.getElementById('drawer-creditos-val').textContent = asignatura.creditos;
        document.getElementById('drawer-horas-teoricas').textContent = asignatura.horasTeoricas;
        document.getElementById('drawer-horas-practicas').textContent = asignatura.horasPracticas;
        const horasTotales = asignatura.horasTeoricas + asignatura.horasPracticas;
        document.getElementById('drawer-horas-total').textContent = horasTotales;

        // Progress bar del bimestre
        const bimestre = asignatura.bimestre;
        const maxBimestre = bimestre <= 10 ? 10 : 17;
        const progressPercent = (bimestre / maxBimestre) * 100;
        document.getElementById('drawer-progress-fill').style.width = `${progressPercent}%`;
        document.getElementById('drawer-progress-text').textContent = `Bimestre ${bimestre} de ${maxBimestre}`;

        // Descripción y propósito
        document.getElementById('drawer-descripcion').textContent = asignatura.descripcion;
        document.getElementById('drawer-proposito').textContent = asignatura.proposito;

        // Objetivos
        const objetivosHtml = asignatura.objetivos.map(obj => `<li>${obj}</li>`).join('');
        document.getElementById('drawer-objetivos').innerHTML = objetivosHtml;

        // Competencias
        const competenciasHtml = asignatura.competencias.map(comp =>
            `<span class="competencia-tag">${comp}</span>`
        ).join('');
        document.getElementById('drawer-competencias').innerHTML = competenciasHtml;

        // Experiencias - usando onclick inline para máxima compatibilidad
        const experienciasHtml = asignatura.experiencias.map((exp, index) => `
            <div class="exp-card" id="exp-card-${index}">
                <div class="exp-header" onclick="this.parentElement.classList.toggle('expanded')" style="cursor:pointer">
                    <div class="exp-header-left">
                        <span class="exp-number">${exp.numero}</span>
                        <div class="exp-info">
                            <h4>${exp.titulo}</h4>
                            <span>Experiencia ${exp.numero} · ${exp.semanas}</span>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down exp-toggle"></i>
                </div>
                <div class="exp-content">
                    <div class="exp-content-inner">
                        <p class="exp-description">${exp.descripcion}</p>
                        <div class="exp-separator"></div>
                        <div class="exp-subsection">
                            <h5><i class="fas fa-book"></i> Contenidos</h5>
                            <ul>
                                ${exp.contenidos.map(c => `<li>${c}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="exp-separator"></div>
                        <div class="exp-subsection">
                            <h5><i class="fas fa-tasks"></i> Actividades</h5>
                            <ul>
                                ${exp.actividades.map(a => `<li>${a}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
        document.getElementById('drawer-experiencias').innerHTML = experienciasHtml;

        // Tecnologías
        const techHtml = asignatura.tecnologias.map(tech => {
            let iconHtml = '';
            if (tech.iconType === 'devicon') {
                iconHtml = `<i class="devicon-${tech.icon}"></i>`;
            } else if (tech.iconType === 'fontawesome') {
                iconHtml = `<i class="${tech.icon}"></i>`;
            } else if (tech.iconType === 'simple') {
                iconHtml = `<img src="https://cdn.simpleicons.org/${tech.icon}" alt="${tech.nombre}">`;
            }
            return `<div class="tech-chip">${iconHtml}<span>${tech.nombre}</span></div>`;
        }).join('');
        document.getElementById('drawer-tecnologias').innerHTML = techHtml;

        // Evaluaciones
        const evalHtml = asignatura.evaluaciones.map(ev => {
            const tipoClass = ev.tipo.toLowerCase().includes('formativa') ? 'formativa' :
                             ev.tipo.toLowerCase().includes('sumativa') ? 'sumativa' : 'prueba';
            return `
                <div class="eval-item ${tipoClass}">
                    <div class="eval-info">
                        <h4>${ev.nombre}</h4>
                        <span>${ev.tipo}</span>
                    </div>
                    <span class="eval-percent">${ev.ponderacion}%</span>
                </div>
            `;
        }).join('');
        document.getElementById('drawer-evaluaciones').innerHTML = evalHtml;

        // Prerrequisitos
        const prereqHtml = asignatura.prerrequisitos.length > 0
            ? asignatura.prerrequisitos.map(p => `<span class="connection-item">${p}</span>`).join('')
            : '<span class="no-prereq">Sin prerrequisitos</span>';
        document.getElementById('drawer-prerrequisitos').innerHTML = prereqHtml;

        // Conexiones (habilita para)
        const conexHtml = asignatura.conexiones.length > 0
            ? asignatura.conexiones.map(c => `<span class="connection-item">${c}</span>`).join('')
            : '<span class="no-prereq">-</span>';
        document.getElementById('drawer-habilita').innerHTML = conexHtml;

        // Recursos
        const recursosHtml = asignatura.recursos.map(rec => {
            const iconClass = rec.tipo === 'GitHub' ? 'fab fa-github' :
                             rec.tipo === 'Documentación' ? 'fas fa-book' :
                             rec.tipo === 'Tutorial' ? 'fas fa-play-circle' : 'fas fa-link';
            return `
                <a href="${rec.url}" target="_blank" rel="noopener" class="recurso-link">
                    <div class="recurso-icon"><i class="${iconClass}"></i></div>
                    <div class="recurso-info">
                        <h5>${rec.nombre}</h5>
                        <span>${rec.tipo}</span>
                    </div>
                </a>
            `;
        }).join('');
        document.getElementById('drawer-recursos').innerHTML = recursosHtml;

        // ============================================
        // NUEVAS SECCIONES PREMIUM - Contenido Enriquecido
        // ============================================

        // Indicadores Premium (Dificultad y Horas de Estudio)
        const indicatorsSection = document.getElementById('drawer-indicators-section');
        const keywordsSection = document.getElementById('drawer-keywords-section');

        if (asignatura.dificultad || asignatura.horasEstudioSemanal || (asignatura.palabrasClave && asignatura.palabrasClave.length > 0)) {
            indicatorsSection.style.display = 'block';

            // Mostrar/ocultar premium-indicators según si hay datos
            const premiumIndicators = document.getElementById('drawer-premium-indicators');
            if (asignatura.dificultad || asignatura.horasEstudioSemanal) {
                premiumIndicators.style.display = 'flex';
            } else {
                premiumIndicators.style.display = 'none';
            }

            // Dificultad
            if (asignatura.dificultad) {
                const diffCard = document.getElementById('drawer-difficulty-card');
                const diffLabel = {
                    'basico': 'Básico',
                    'intermedio': 'Intermedio',
                    'avanzado': 'Avanzado',
                    'experto': 'Experto'
                };
                const diffDots = {
                    'basico': 1,
                    'intermedio': 2,
                    'avanzado': 3,
                    'experto': 4
                };

                document.getElementById('drawer-dificultad').textContent = diffLabel[asignatura.dificultad] || 'N/A';
                diffCard.setAttribute('data-level', asignatura.dificultad);

                // Actualizar dots de dificultad
                const dotsHtml = Array.from({length: 4}, (_, i) =>
                    `<span class="diff-dot ${i < diffDots[asignatura.dificultad] ? 'active' : ''}"></span>`
                ).join('');
                document.getElementById('drawer-difficulty-bar').innerHTML = dotsHtml;
            }

            // Horas de estudio semanal
            if (asignatura.horasEstudioSemanal) {
                document.getElementById('drawer-horas-estudio').textContent = asignatura.horasEstudioSemanal;
            }
        } else {
            indicatorsSection.style.display = 'none';
        }

        // Palabras Clave con tooltips premium
        if (asignatura.palabrasClave && asignatura.palabrasClave.length > 0) {
            keywordsSection.style.display = 'block';
            const keywordsHtml = asignatura.palabrasClave.map(kw => {
                const tooltip = getKeywordTooltip(kw);
                return `<span class="keyword-tag" data-premium-tooltip="${tooltip}">${kw}</span>`;
            }).join('');
            document.getElementById('drawer-palabras-clave').innerHTML = keywordsHtml;
        } else {
            keywordsSection.style.display = 'none';
        }

        // Tips de Estudio
        const tipsSection = document.getElementById('drawer-tips-section');
        if (asignatura.tips && asignatura.tips.length > 0) {
            tipsSection.style.display = 'block';
            const tipsHtml = asignatura.tips.map(tip => `
                <div class="tip-item">
                    <div class="tip-icon"><i class="fas fa-lightbulb"></i></div>
                    <span class="tip-text">${tip}</span>
                </div>
            `).join('');
            document.getElementById('drawer-tips').innerHTML = tipsHtml;
        } else {
            tipsSection.style.display = 'none';
        }

        // Proyectos Sugeridos
        const projectsSection = document.getElementById('drawer-projects-section');
        if (asignatura.proyectosSugeridos && asignatura.proyectosSugeridos.length > 0) {
            projectsSection.style.display = 'block';
            const projectsHtml = asignatura.proyectosSugeridos.map(proj => `
                <div class="project-card">
                    <div class="project-header">
                        <span class="project-name"><i class="fas fa-code-branch"></i> ${proj.nombre}</span>
                        <span class="project-level ${proj.nivel}">${proj.nivel}</span>
                    </div>
                    <p class="project-desc">${proj.descripcion}</p>
                    ${proj.duracionEstimada ? `<span class="project-duration"><i class="fas fa-clock"></i> ${proj.duracionEstimada}</span>` : ''}
                </div>
            `).join('');
            document.getElementById('drawer-proyectos').innerHTML = projectsHtml;
        } else {
            projectsSection.style.display = 'none';
        }

        // Relevancia Profesional
        const relevanceSection = document.getElementById('drawer-relevance-section');
        if (asignatura.relevanciaProfesional && asignatura.relevanciaProfesional.length > 0) {
            relevanceSection.style.display = 'block';
            const relevanceHtml = asignatura.relevanciaProfesional.map(rel => `
                <div class="relevance-item" data-importance="${rel.importancia}">
                    <div class="relevance-icon"><i class="fas fa-user-tie"></i></div>
                    <div class="relevance-info">
                        <span class="relevance-role">${rel.rol}</span>
                        ${rel.descripcion ? `<span class="relevance-desc">${rel.descripcion}</span>` : ''}
                    </div>
                    <span class="relevance-badge ${rel.importancia}">${rel.importancia}</span>
                </div>
            `).join('');
            document.getElementById('drawer-relevancia').innerHTML = relevanceHtml;
        } else {
            relevanceSection.style.display = 'none';
        }

        // Link de GitHub en footer
        const bimestreNum = asignatura.bimestre.toString().padStart(2, '0');
        document.getElementById('drawer-github-link').href =
            `https://github.com/fos-duoc/Analista-Programador-Computacional-DuocUC/tree/main/Bimestre-${bimestreNum}%20-%20`;
    }

</script>

<!-- Script inline separado para event listeners - se ejecuta en cada View Transition -->
<script is:inline>
    (function initSubjectDrawerEvents() {
        // Toggle de experiencias - Usar múltiples estrategias para máxima compatibilidad

        // Estrategia 1: Event delegation en document con capture
        if (!window._expToggleHandler) {
            window._expToggleHandler = function(e) {
                const header = e.target.closest('[data-exp-toggle]');
                if (header) {
                    e.preventDefault();
                    e.stopPropagation();
                    const card = header.closest('.exp-card');
                    if (card) {
                        card.classList.toggle('expanded');
                        console.log('[SubjectDrawer] Toggled exp-card:', card.id, 'expanded:', card.classList.contains('expanded'));
                    }
                }
            };
            document.addEventListener('click', window._expToggleHandler, true);
        }

        // Estrategia 2: Función global para toggle manual
        window.toggleExperiencia = function(index) {
            const card = document.getElementById('exp-card-' + index);
            if (card) {
                card.classList.toggle('expanded');
                console.log('[SubjectDrawer] Manual toggle exp-card-' + index, 'expanded:', card.classList.contains('expanded'));
            }
        };

        // Estrategia 3: Attach directo a los headers existentes
        function attachExpToggleHandlers() {
            const headers = document.querySelectorAll('[data-exp-toggle]');
            headers.forEach(header => {
                // Evitar duplicados usando data attribute
                if (!header.hasAttribute('data-toggle-attached')) {
                    header.setAttribute('data-toggle-attached', 'true');
                    header.style.cursor = 'pointer';
                    header.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const card = this.closest('.exp-card');
                        if (card) {
                            card.classList.toggle('expanded');
                            console.log('[SubjectDrawer] Direct handler toggled:', card.id);
                        }
                    });
                }
            });
            if (headers.length > 0) {
                console.log('[SubjectDrawer] Attached direct handlers to', headers.length, 'exp-headers');
            }
        }

        // Ejecutar attach después de un pequeño delay para asegurar que el DOM está listo
        setTimeout(attachExpToggleHandlers, 100);

        // También ejecutar cuando se actualiza el contenido del drawer
        const originalUpdateDrawerContent = window.updateDrawerContent;
        if (typeof originalUpdateDrawerContent === 'function') {
            window.updateDrawerContent = function(...args) {
                originalUpdateDrawerContent.apply(this, args);
                setTimeout(attachExpToggleHandlers, 50);
            };
        }

        function attachDrawerEvents() {
            const closeBtn = document.getElementById('drawer-close-btn');
            const drawer = document.getElementById('subject-drawer');

            // Usar onclick directo para evitar duplicados
            if (closeBtn) {
                closeBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (window.closeSubjectDrawer) {
                        window.closeSubjectDrawer();
                    }
                };
            }

            // Initialize the new dropdown functionality
            initDrawerOptionsDropdown();

            // Initialize zoom controls
            initDrawerZoom();
        }

        // ============================================
        // DRAWER ZOOM CONTROLS - Premium Features
        // ============================================
        function initDrawerZoom() {
            const zoomInBtn = document.getElementById('drawer-zoom-in-btn');
            const zoomOutBtn = document.getElementById('drawer-zoom-out-btn');
            const zoomResetBtn = document.getElementById('drawer-zoom-reset-btn');
            const zoomLevelEl = document.getElementById('drawer-zoom-level');
            const drawerBody = document.querySelector('.drawer-body');

            if (!zoomInBtn || !zoomOutBtn || !drawerBody) return;

            // Prevent duplicate initialization
            if (zoomInBtn.dataset.initialized === 'true') return;
            zoomInBtn.dataset.initialized = 'true';

            // Load saved zoom or default to 100
            let currentZoom = parseInt(localStorage.getItem('drawer_zoom') || '100');
            applyZoom(currentZoom);

            function applyZoom(level) {
                currentZoom = Math.max(70, Math.min(150, level));
                const scale = currentZoom / 100;
                drawerBody.style.fontSize = scale + 'rem';
                if (zoomLevelEl) zoomLevelEl.textContent = currentZoom + '%';
                localStorage.setItem('drawer_zoom', currentZoom.toString());
            }

            zoomInBtn.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                applyZoom(currentZoom + 10);
            };

            zoomOutBtn.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                applyZoom(currentZoom - 10);
            };

            if (zoomResetBtn) {
                zoomResetBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    applyZoom(100);
                };
            }

            // Double-click on zoom level to reset
            if (zoomLevelEl) {
                zoomLevelEl.ondblclick = function(e) {
                    e.preventDefault();
                    applyZoom(100);
                };
            }
        }

        // ============================================
        // DRAWER OPTIONS DROPDOWN - Premium Features
        // ============================================
        function initDrawerOptionsDropdown() {
            const optionsBtn = document.getElementById('drawer-options-btn');
            const dropdown = document.getElementById('drawer-options-dropdown');
            const drawer = document.getElementById('subject-drawer');

            if (!optionsBtn || !dropdown || !drawer) return;

            // Prevent duplicate initialization
            if (optionsBtn.dataset.initialized === 'true') return;
            optionsBtn.dataset.initialized = 'true';

            // Toggle dropdown
            optionsBtn.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                const isOpen = dropdown.classList.contains('open');
                dropdown.classList.toggle('open');
                optionsBtn.setAttribute('aria-expanded', (!isOpen).toString());
            };

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!dropdown.contains(e.target) && !optionsBtn.contains(e.target)) {
                    dropdown.classList.remove('open');
                    optionsBtn.setAttribute('aria-expanded', 'false');
                }
            });

            // Size options
            const sizeOptions = dropdown.querySelectorAll('.size-option');
            sizeOptions.forEach(opt => {
                opt.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const width = opt.dataset.width;

                    // Update active state
                    sizeOptions.forEach(o => o.classList.remove('active'));
                    opt.classList.add('active');

                    // Apply width
                    if (width === 'full') {
                        drawer.style.width = 'calc(100vw - 340px)';
                        drawer.classList.add('fullscreen-width');
                    } else {
                        drawer.style.width = width + 'px';
                        drawer.classList.remove('fullscreen-width');
                        localStorage.setItem('subject_drawer_width', width);
                    }

                    // Dispatch resize event
                    window.dispatchEvent(new CustomEvent('subjectDrawerResize', {
                        detail: { width: drawer.offsetWidth }
                    }));
                };
            });

            // Action options
            const actionOptions = dropdown.querySelectorAll('.action-option');
            actionOptions.forEach(opt => {
                opt.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const action = opt.dataset.action;
                    handleDrawerAction(action);

                    // Close dropdown after action (except for some actions)
                    if (!['share'].includes(action)) {
                        dropdown.classList.remove('open');
                        optionsBtn.setAttribute('aria-expanded', 'false');
                    }
                };
            });

            // Section toggles
            const sectionToggles = dropdown.querySelectorAll('.section-toggle input');
            sectionToggles.forEach(toggle => {
                // Restore saved state
                const sectionId = toggle.dataset.section;
                const savedState = localStorage.getItem(`drawer_section_${sectionId}`);
                if (savedState === 'hidden') {
                    toggle.checked = false;
                    hideSectionById(sectionId);
                }

                toggle.onchange = function() {
                    const sectionId = toggle.dataset.section;
                    if (toggle.checked) {
                        showSectionById(sectionId);
                        localStorage.setItem(`drawer_section_${sectionId}`, 'visible');
                    } else {
                        hideSectionById(sectionId);
                        localStorage.setItem(`drawer_section_${sectionId}`, 'hidden');
                    }
                };
            });

            // Toggle all sections button
            const toggleAllBtn = document.getElementById('toggle-all-sections');
            if (toggleAllBtn) {
                toggleAllBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const allChecked = Array.from(sectionToggles).every(t => t.checked);

                    sectionToggles.forEach(toggle => {
                        toggle.checked = !allChecked;
                        const sectionId = toggle.dataset.section;
                        if (!allChecked) {
                            showSectionById(sectionId);
                            localStorage.setItem(`drawer_section_${sectionId}`, 'visible');
                        } else {
                            hideSectionById(sectionId);
                            localStorage.setItem(`drawer_section_${sectionId}`, 'hidden');
                        }
                    });

                    // Update button icon
                    toggleAllBtn.innerHTML = allChecked
                        ? '<i class="fas fa-eye-slash"></i>'
                        : '<i class="fas fa-eye"></i>';
                };
            }

            // Restore size from localStorage
            const savedWidth = localStorage.getItem('subject_drawer_width');
            if (savedWidth) {
                const widthNum = parseInt(savedWidth, 10);
                sizeOptions.forEach(opt => {
                    opt.classList.remove('active');
                    if (opt.dataset.width === savedWidth || parseInt(opt.dataset.width, 10) === widthNum) {
                        opt.classList.add('active');
                    }
                });
            }
        }

        function hideSectionById(sectionId) {
            // Find section by id attribute or class
            let section = document.getElementById(`drawer-${sectionId}`);
            if (!section) {
                section = document.querySelector(`.drawer-section.${sectionId}`);
            }
            if (!section) {
                // Try finding parent section that contains this id
                const element = document.getElementById(`drawer-${sectionId}`);
                section = element?.closest('.drawer-section');
            }
            if (section) {
                section.style.display = 'none';
            }
        }

        function showSectionById(sectionId) {
            let section = document.getElementById(`drawer-${sectionId}`);
            if (!section) {
                section = document.querySelector(`.drawer-section.${sectionId}`);
            }
            if (!section) {
                const element = document.getElementById(`drawer-${sectionId}`);
                section = element?.closest('.drawer-section');
            }
            if (section) {
                section.style.display = '';
            }
        }

        function handleDrawerAction(action) {
            const drawer = document.getElementById('subject-drawer');
            const title = document.getElementById('drawer-title')?.textContent || 'Asignatura';
            const code = document.getElementById('drawer-codigo')?.textContent || '';

            switch (action) {
                case 'copy':
                    copyDrawerContent();
                    break;
                case 'share':
                    shareDrawerContent(title, code);
                    break;
                case 'print':
                    printDrawerContent();
                    break;
                case 'ask-tutor':
                    askTutorAboutSubject(title, code);
                    break;
                case 'new-tab':
                    // TODO: Open subject detail in new tab
                    showNotification('Próximamente: Vista completa de asignatura', 'info');
                    break;
                case 'github':
                    const githubLink = document.getElementById('drawer-github-link');
                    if (githubLink?.href && githubLink.href !== '#') {
                        window.open(githubLink.href, '_blank');
                    } else {
                        showNotification('Materiales próximamente disponibles', 'info');
                    }
                    break;
            }
        }

        function copyDrawerContent() {
            const title = document.getElementById('drawer-title')?.textContent || '';
            const code = document.getElementById('drawer-codigo')?.textContent || '';
            const descripcion = document.getElementById('drawer-descripcion')?.textContent || '';
            const creditos = document.getElementById('drawer-creditos-val')?.textContent || '';

            const content = `📚 ${title} (${code})

📝 Descripción:
${descripcion}

📊 Créditos: ${creditos}

🔗 Más información en: ${window.location.href}`;

            navigator.clipboard.writeText(content).then(() => {
                showNotification('Información copiada al portapapeles', 'success');
            }).catch(() => {
                showNotification('Error al copiar', 'error');
            });
        }

        function shareDrawerContent(title, code) {
            const url = window.location.href;
            const text = `Mira esta asignatura: ${title} (${code})`;

            if (navigator.share) {
                navigator.share({ title, text, url }).catch(() => {});
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(`${text}\n${url}`).then(() => {
                    showNotification('Enlace copiado para compartir', 'success');
                });
            }
        }

        function printDrawerContent() {
            const drawer = document.getElementById('subject-drawer');
            const title = document.getElementById('drawer-title')?.textContent || 'Asignatura';

            // Create print-friendly version
            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${title} - Ficha de Asignatura</title>
                        <style>
                            body { font-family: system-ui, sans-serif; padding: 2rem; max-width: 800px; margin: 0 auto; }
                            h1 { color: #0891b2; border-bottom: 2px solid #06b6d4; padding-bottom: 0.5rem; }
                            h2 { color: #475569; margin-top: 1.5rem; }
                            .stats { display: flex; gap: 2rem; margin: 1rem 0; padding: 1rem; background: #f1f5f9; border-radius: 8px; }
                            .stat { text-align: center; }
                            .stat-value { font-size: 1.5rem; font-weight: bold; color: #0891b2; }
                            .stat-label { font-size: 0.75rem; color: #64748b; }
                            ul { padding-left: 1.5rem; }
                            li { margin: 0.5rem 0; }
                            .tag { display: inline-block; padding: 0.25rem 0.5rem; background: #e0f2fe; color: #0369a1; border-radius: 4px; margin: 0.2rem; font-size: 0.85rem; }
                            @media print { body { padding: 1rem; } }
                        </style>
                    </head>
                    <body>
                        <h1>${title}</h1>
                        <p><strong>Código:</strong> ${document.getElementById('drawer-codigo')?.textContent || ''}</p>
                        <div class="stats">
                            <div class="stat">
                                <div class="stat-value">${document.getElementById('drawer-creditos-val')?.textContent || ''}</div>
                                <div class="stat-label">Créditos</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${document.getElementById('drawer-horas-teoricas')?.textContent || ''}</div>
                                <div class="stat-label">Hrs. Teóricas</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${document.getElementById('drawer-horas-practicas')?.textContent || ''}</div>
                                <div class="stat-label">Hrs. Prácticas</div>
                            </div>
                        </div>
                        <h2>Descripción</h2>
                        <p>${document.getElementById('drawer-descripcion')?.textContent || ''}</p>
                        <h2>Propósito</h2>
                        <p>${document.getElementById('drawer-proposito')?.textContent || ''}</p>
                        <h2>Objetivos de Aprendizaje</h2>
                        ${document.getElementById('drawer-objetivos')?.innerHTML || ''}
                        <h2>Competencias</h2>
                        <div>${Array.from(document.querySelectorAll('#drawer-competencias .competencia-tag')).map(t => `<span class="tag">${t.textContent}</span>`).join(' ')}</div>
                        <footer style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e2e8f0; color: #64748b; font-size: 0.85rem;">
                            Generado desde: ${window.location.href}<br>
                            Fecha: ${new Date().toLocaleDateString('es-CL')}
                        </footer>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }
        }

        function askTutorAboutSubject(title, code) {
            // Open AI Tutor with this subject context
            if (typeof window.showAITutor === 'function') {
                window.showAITutor(title, code);
                showNotification('Tutor IA listo para ayudarte', 'success');
            } else {
                showNotification('Tutor IA no disponible', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `drawer-notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                padding: 0.75rem 1rem;
                background: ${type === 'success' ? 'rgba(34, 197, 94, 0.95)' : type === 'error' ? 'rgba(239, 68, 68, 0.95)' : 'rgba(6, 182, 212, 0.95)'};
                color: white;
                border-radius: 8px;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.85rem;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;

            // Add animation keyframes if not exist
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(notification);

            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ============================================
        // DRAWER RESIZE - Drag to resize from left edge
        // ============================================
        function initDrawerResize() {
            const drawer = document.getElementById('subject-drawer');
            const resizeHandle = document.getElementById('drawer-resize-handle');

            if (!drawer || !resizeHandle) return;

            const MIN_WIDTH = 400;
            const MAX_WIDTH = 900;
            const DEFAULT_WIDTH = 520;

            let isResizing = false;
            let startX = 0;
            let startWidth = 0;

            // Restore saved width
            const savedWidth = localStorage.getItem('subject_drawer_width');
            if (savedWidth) {
                const width = parseInt(savedWidth, 10);
                if (width >= MIN_WIDTH && width <= MAX_WIDTH) {
                    drawer.style.width = width + 'px';
                }
            }

            function startResize(e) {
                e.preventDefault();
                isResizing = true;
                startX = e.clientX || e.touches?.[0]?.clientX || 0;
                startWidth = drawer.offsetWidth;

                drawer.classList.add('resizing');
                resizeHandle.classList.add('active');
                document.body.style.cursor = 'ew-resize';
                document.body.style.userSelect = 'none';

                document.addEventListener('mousemove', doResize);
                document.addEventListener('mouseup', stopResize);
                document.addEventListener('touchmove', doResize, { passive: false });
                document.addEventListener('touchend', stopResize);
            }

            function doResize(e) {
                if (!isResizing) return;
                e.preventDefault();

                const clientX = e.clientX || e.touches?.[0]?.clientX || 0;
                // Dragging left increases width, dragging right decreases
                const deltaX = startX - clientX;
                let newWidth = startWidth + deltaX;

                // Clamp to min/max
                newWidth = Math.max(MIN_WIDTH, Math.min(MAX_WIDTH, newWidth));

                drawer.style.width = newWidth + 'px';

                // Remove expanded-width and fullscreen classes if manually resizing
                drawer.classList.remove('expanded-width', 'fullscreen-width');

                // Update size options active state in dropdown
                updateSizeOptionsActiveState(newWidth);

                // Dispatch resize event in real-time for sidebar sync
                window.dispatchEvent(new CustomEvent('subjectDrawerResize', {
                    detail: { width: newWidth }
                }));
            }

            function stopResize() {
                if (!isResizing) return;
                isResizing = false;

                drawer.classList.remove('resizing');
                resizeHandle.classList.remove('active');
                document.body.style.cursor = '';
                document.body.style.userSelect = '';

                // Save width
                const currentWidth = drawer.offsetWidth;
                localStorage.setItem('subject_drawer_width', currentWidth.toString());

                // Update size options active state
                updateSizeOptionsActiveState(currentWidth);

                // Dispatch resize event
                window.dispatchEvent(new CustomEvent('subjectDrawerResize', {
                    detail: { width: currentWidth }
                }));

                document.removeEventListener('mousemove', doResize);
                document.removeEventListener('mouseup', stopResize);
                document.removeEventListener('touchmove', doResize);
                document.removeEventListener('touchend', stopResize);
            }

            // Helper to update size options active state based on current width
            function updateSizeOptionsActiveState(width) {
                const sizeOptions = document.querySelectorAll('.size-option');
                sizeOptions.forEach(opt => {
                    opt.classList.remove('active');
                    const optWidth = parseInt(opt.dataset.width, 10);
                    // Mark active if within 20px tolerance of a preset
                    if (Math.abs(optWidth - width) <= 20) {
                        opt.classList.add('active');
                    }
                });
            }

            // Double-click to reset
            resizeHandle.addEventListener('dblclick', () => {
                drawer.style.width = DEFAULT_WIDTH + 'px';
                drawer.classList.remove('expanded-width', 'fullscreen-width');
                localStorage.setItem('subject_drawer_width', DEFAULT_WIDTH.toString());
                updateSizeOptionsActiveState(DEFAULT_WIDTH);

                window.dispatchEvent(new CustomEvent('subjectDrawerResize', {
                    detail: { width: DEFAULT_WIDTH }
                }));
            });

            resizeHandle.addEventListener('mousedown', startResize);
            resizeHandle.addEventListener('touchstart', startResize, { passive: false });
        }

        // Escape key - solo una vez
        if (!window._subjectDrawerEventsInitialized) {
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && window.closeSubjectDrawer) {
                    window.closeSubjectDrawer();
                }
            });
            window._subjectDrawerEventsInitialized = true;
        }

        // ============================================
        // SPLIT PANE - Sync with AI Tutor Panel width
        // ============================================
        function initSplitPaneSync() {
            const drawer = document.getElementById('subject-drawer');
            if (!drawer) return;

            const DEFAULT_TUTOR_WIDTH = 320; // Minimized AI Tutor width
            const MIN_DRAWER_RIGHT = 320;  // Min tutor width (minimized)
            const MAX_DRAWER_RIGHT = 700;  // Max tutor width

            // Get saved tutor width or use default
            function getTutorWidth() {
                const saved = localStorage.getItem('tutor_panel_width');
                if (saved) {
                    const width = parseInt(saved, 10);
                    if (width >= MIN_DRAWER_RIGHT && width <= MAX_DRAWER_RIGHT) {
                        return width;
                    }
                }
                return DEFAULT_TUTOR_WIDTH;
            }

            // Update drawer position based on tutor width
            function updateDrawerPosition(tutorWidth) {
                // Only on desktop (> 900px)
                if (window.innerWidth <= 900) {
                    drawer.style.right = '';
                    return;
                }

                drawer.style.right = tutorWidth + 'px';
            }

            // Listen for tutor panel resize events
            window.addEventListener('tutorPanelResize', function(e) {
                const width = e.detail?.width;
                if (typeof width === 'number') {
                    updateDrawerPosition(width);
                }
            });

            // Apply initial position
            const initialWidth = getTutorWidth();
            updateDrawerPosition(initialWidth);

            // Also update on window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth <= 900) {
                    drawer.style.right = '';
                } else {
                    updateDrawerPosition(getTutorWidth());
                }
            });
        }

        // Initialize split pane sync
        if (!window._splitPaneSyncInitialized) {
            initSplitPaneSync();
            window._splitPaneSyncInitialized = true;
        }

        // Initialize drawer resize
        if (!window._drawerResizeInitialized) {
            initDrawerResize();
            window._drawerResizeInitialized = true;
        }

        // Ejecutar inmediatamente
        attachDrawerEvents();

        // Re-attach después de View Transitions
        document.addEventListener('astro:page-load', () => {
            attachDrawerEvents();
            // Re-initialize resize if needed (for View Transitions)
            if (!window._drawerResizeInitialized) {
                initDrawerResize();
                window._drawerResizeInitialized = true;
            }
        });
    })();
</script>
