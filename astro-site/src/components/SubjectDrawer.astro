---
/**
 * SubjectDrawer.astro
 * Panel lateral sofisticado para mostrar información detallada de asignaturas
 * Se activa al hacer clic en una asignatura desde la página Malla
 */
import { asignaturas, nombreCortoToId, type Asignatura } from '../data/asignaturas';

const base = import.meta.env.BASE_URL;
---

<!-- Overlay para cerrar el drawer al hacer clic fuera -->
<div id="subject-drawer-overlay" class="drawer-overlay"></div>

<!-- Drawer Panel -->
<aside id="subject-drawer" class="subject-drawer" aria-hidden="true" role="dialog" aria-labelledby="drawer-title">
    <!-- Header del Drawer -->
    <header class="drawer-header">
        <div class="drawer-header-content">
            <span class="drawer-badge" id="drawer-bimestre">B01</span>
            <span class="drawer-code" id="drawer-codigo">PRY1101</span>
        </div>
        <div class="drawer-controls">
            <button class="drawer-width-btn" id="drawer-width-toggle" aria-label="Expandir ancho" title="Expandir/Contraer ancho">
                <i class="fas fa-arrows-alt-h"></i>
            </button>
            <button class="drawer-close" aria-label="Cerrar panel" id="drawer-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </header>

    <!-- Contenido scrolleable -->
    <div class="drawer-body">
        <!-- Título y Créditos -->
        <div class="drawer-title-section">
            <h2 class="drawer-title" id="drawer-title">Nombre de la Asignatura</h2>
            <!-- Stats Bar Premium con Tooltips -->
            <div class="stats-bar">
                <div class="stat-item" data-tooltip="Créditos académicos que aporta esta asignatura al plan de estudios">
                    <i class="fas fa-graduation-cap"></i>
                    <span class="stat-value" id="drawer-creditos-val">4</span>
                    <span class="stat-label">Créditos</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item" data-tooltip="Horas semanales de clases teóricas (cátedra, exposición)">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span class="stat-value" id="drawer-horas-teoricas">2</span>
                    <span class="stat-label">Teóricas</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item" data-tooltip="Horas semanales de laboratorio o taller práctico">
                    <i class="fas fa-laptop-code"></i>
                    <span class="stat-value" id="drawer-horas-practicas">4</span>
                    <span class="stat-label">Prácticas</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item total" data-tooltip="Total de horas presenciales por semana">
                    <i class="fas fa-clock"></i>
                    <span class="stat-value" id="drawer-horas-total">6</span>
                    <span class="stat-label">hrs/sem</span>
                </div>
            </div>
            <!-- Progress Bar del Bimestre -->
            <div class="bimestre-progress" id="drawer-bimestre-progress">
                <div class="progress-label">
                    <span>Progreso de la carrera</span>
                    <span class="progress-text" id="drawer-progress-text">Bimestre 1 de 10</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="drawer-progress-fill" style="width: 10%"></div>
                </div>
            </div>
        </div>

        <!-- Indicadores Premium (Dificultad, Horas Estudio, Keywords) -->
        <section class="drawer-section indicators-section" id="drawer-indicators-section">
            <div class="premium-indicators" id="drawer-premium-indicators">
                <div class="indicator-card difficulty-card" id="drawer-difficulty-card">
                    <div class="indicator-icon"><i class="fas fa-signal"></i></div>
                    <div class="indicator-info">
                        <span class="indicator-label">Dificultad</span>
                        <span class="indicator-value" id="drawer-dificultad">Básico</span>
                    </div>
                    <div class="difficulty-bar" id="drawer-difficulty-bar">
                        <span class="diff-dot active"></span>
                        <span class="diff-dot"></span>
                        <span class="diff-dot"></span>
                        <span class="diff-dot"></span>
                    </div>
                </div>
                <div class="indicator-card study-card">
                    <div class="indicator-icon"><i class="fas fa-book-reader"></i></div>
                    <div class="indicator-info">
                        <span class="indicator-label">Estudio Semanal</span>
                        <span class="indicator-value"><span id="drawer-horas-estudio">8</span> hrs</span>
                    </div>
                </div>
            </div>
            <div class="keywords-cloud" id="drawer-keywords-section">
                <div class="keywords-label"><i class="fas fa-tags"></i> Palabras Clave</div>
                <div class="keywords-list" id="drawer-palabras-clave">
                    <!-- Se llenan dinámicamente -->
                </div>
            </div>
        </section>

        <!-- Descripción y Propósito -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Resumen general de la asignatura y su contexto en el plan de estudios">
                <i class="fas fa-info-circle"></i> Descripción
            </h3>
            <p class="section-content" id="drawer-descripcion">
                Descripción de la asignatura...
            </p>
            <div class="proposito-box" id="drawer-proposito-box">
                <strong><i class="fas fa-bullseye"></i> Propósito:</strong>
                <span id="drawer-proposito">Propósito de la asignatura...</span>
            </div>
        </section>

        <!-- Objetivos de Aprendizaje -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Resultados de aprendizaje que lograrás al completar la asignatura">
                <i class="fas fa-target"></i> Objetivos de Aprendizaje
            </h3>
            <ul class="objectives-list" id="drawer-objetivos">
                <li>Objetivo 1</li>
                <li>Objetivo 2</li>
            </ul>
        </section>

        <!-- Competencias -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Habilidades profesionales que desarrollarás en esta asignatura">
                <i class="fas fa-award"></i> Competencias
            </h3>
            <div class="competencias-tags" id="drawer-competencias">
                <span class="competencia-tag">Competencia 1</span>
            </div>
        </section>

        <!-- Experiencias de Aprendizaje -->
        <section class="drawer-section experiencias-section">
            <h3 class="section-title" data-tooltip="Unidades temáticas con contenidos y actividades por semana">
                <i class="fas fa-route"></i> Experiencias de Aprendizaje
            </h3>
            <div class="experiencias-accordion" id="drawer-experiencias">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Tecnologías -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Herramientas, lenguajes y frameworks que usarás en esta asignatura">
                <i class="fas fa-code"></i> Tecnologías
            </h3>
            <div class="tech-grid" id="drawer-tecnologias">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Evaluaciones -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Instrumentos y ponderaciones para medir tu aprendizaje">
                <i class="fas fa-clipboard-check"></i> Sistema de Evaluación
            </h3>
            <div class="evaluaciones-list" id="drawer-evaluaciones">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Prerrequisitos y Conexiones -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Asignaturas que debes aprobar antes y las que se habilitan después">
                <i class="fas fa-project-diagram"></i> Prerrequisitos y Conexiones
            </h3>
            <div class="connections-grid" id="drawer-conexiones">
                <div class="connection-box prereq-box" data-tooltip="Asignaturas que debes haber aprobado para cursar esta">
                    <h4><i class="fas fa-arrow-left"></i> Prerrequisitos</h4>
                    <div id="drawer-prerrequisitos" class="connection-items">
                        <span class="no-prereq">Sin prerrequisitos</span>
                    </div>
                </div>
                <div class="connection-box next-box" data-tooltip="Asignaturas que podrás cursar después de aprobar esta">
                    <h4><i class="fas fa-arrow-right"></i> Habilita para</h4>
                    <div id="drawer-habilita" class="connection-items">
                        <span class="connection-item">POO II</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recursos -->
        <section class="drawer-section">
            <h3 class="section-title" data-tooltip="Material de estudio recomendado: libros, tutoriales, documentación">
                <i class="fas fa-book-open"></i> Recursos de Aprendizaje
            </h3>
            <div class="recursos-grid" id="drawer-recursos">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Tips de Estudio -->
        <section class="drawer-section tips-section" id="drawer-tips-section">
            <h3 class="section-title" data-tooltip="Consejos prácticos para maximizar tu aprendizaje en esta asignatura">
                <i class="fas fa-lightbulb"></i> Tips de Estudio
            </h3>
            <div class="tips-list" id="drawer-tips">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Proyectos Sugeridos -->
        <section class="drawer-section projects-section" id="drawer-projects-section">
            <h3 class="section-title" data-tooltip="Ideas de proyectos para aplicar lo aprendido y fortalecer tu portafolio">
                <i class="fas fa-rocket"></i> Proyectos Sugeridos
            </h3>
            <div class="projects-grid" id="drawer-proyectos">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>

        <!-- Relevancia Profesional -->
        <section class="drawer-section relevance-section" id="drawer-relevance-section">
            <h3 class="section-title" data-tooltip="Cómo esta asignatura aplica a diferentes roles profesionales en la industria">
                <i class="fas fa-briefcase"></i> Relevancia Profesional
            </h3>
            <div class="relevance-grid" id="drawer-relevancia">
                <!-- Se llenan dinámicamente -->
            </div>
        </section>
    </div>

    <!-- Footer del Drawer -->
    <footer class="drawer-footer">
        <a href="#" class="drawer-cta" id="drawer-github-link" target="_blank">
            <i class="fab fa-github"></i> Ver materiales en GitHub
        </a>
    </footer>
</aside>

<style>
    /* ============================================
       DRAWER OVERLAY
       - Starts below header (70px) to keep navigation visible
       - Enterprise-grade UX pattern
    ============================================ */
    .drawer-overlay {
        position: fixed;
        top: 70px; /* Below header */
        left: 0;
        width: 100%;
        height: calc(100vh - 70px);
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
        z-index: 999; /* Below header (1000) */
        opacity: 0;
        visibility: hidden;
        /* Faster overlay transition (200ms per Material Design 3) */
        transition: opacity 0.2s ease, visibility 0.2s ease;
    }

    .drawer-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    /* ============================================
       DRAWER PANEL - Premium Enterprise Design
       - Slides in from right, below header
       - Header and navigation always accessible
       - Sophisticated typography with tight spacing
       - Responsive sizing with smooth transitions
    ============================================ */
    .subject-drawer {
        position: fixed;
        top: 70px;
        right: 382px;
        width: 520px;
        max-width: 95vw;
        height: calc(100vh - 70px);
        background: linear-gradient(180deg, #0a0f1a 0%, #0f172a 40%, #1e293b 100%);
        border-left: 1px solid rgba(6, 182, 212, 0.3);
        z-index: 1001;
        transform: translateX(100%);
        visibility: hidden;
        /* Animation: 250ms (faster than 400ms per Material Design 3 guidelines) */
        transition: transform 0.25s cubic-bezier(0.2, 0, 0, 1), visibility 0.25s ease, width 0.2s ease;
        display: flex;
        flex-direction: column;
        box-shadow: -12px 0 48px rgba(0, 0, 0, 0.5), -4px 0 16px rgba(6, 182, 212, 0.05);
        font-size: 0.83rem;
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        letter-spacing: -0.015em;
    }

    .subject-drawer.open {
        transform: translateX(0);
        visibility: visible;
    }

    /* Expanded width mode */
    .subject-drawer.expanded-width {
        width: 680px;
    }

    /* ============================================
       DRAWER HEADER - Premium Compact
    ============================================ */
    .drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0.85rem;
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.08), rgba(139, 92, 246, 0.08));
        border-bottom: 1px solid rgba(6, 182, 212, 0.2);
        flex-shrink: 0;
    }

    .drawer-header-content {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .drawer-badge {
        background: linear-gradient(135deg, #06b6d4, #8b5cf6);
        color: white;
        padding: 0.28rem 0.6rem;
        border-radius: 8px;
        font-size: 0.68rem;
        font-weight: 700;
        font-family: 'Space Grotesk', monospace;
        letter-spacing: 0.02em;
        box-shadow: 0 2px 8px rgba(6, 182, 212, 0.25);
    }

    .drawer-code {
        color: #a1a1aa;
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
        font-size: 0.7rem;
        padding: 0.22rem 0.45rem;
        background: rgba(148, 163, 184, 0.08);
        border-radius: 4px;
        letter-spacing: 0.04em;
        border: 1px solid rgba(148, 163, 184, 0.1);
    }

    .drawer-controls {
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    .drawer-width-btn {
        width: 22px;
        height: 22px;
        border-radius: 5px;
        border: 1px solid rgba(6, 182, 212, 0.25);
        background: rgba(6, 182, 212, 0.08);
        color: #22d3ee;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-size: 0.52rem;
    }

    .drawer-width-btn:hover {
        background: rgba(6, 182, 212, 0.18);
        border-color: rgba(6, 182, 212, 0.45);
    }

    .drawer-width-btn.active {
        background: rgba(6, 182, 212, 0.25);
        border-color: rgba(6, 182, 212, 0.55);
        color: #67e8f9;
    }

    .drawer-close {
        width: 22px;
        height: 22px;
        border-radius: 50%;
        border: 1px solid rgba(239, 68, 68, 0.25);
        background: rgba(239, 68, 68, 0.08);
        color: #ef4444;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-size: 0.55rem;
    }

    .drawer-close:hover {
        background: rgba(239, 68, 68, 0.18);
        border-color: #ef4444;
        transform: rotate(90deg);
    }

    /* ============================================
       DRAWER BODY (Scrollable) - Structured Layout
       Includes gradient scrim for scroll indicator
    ============================================ */
    .drawer-body {
        flex: 1;
        overflow-y: auto;
        padding: 0.5rem 0.85rem;
        scrollbar-width: thin;
        scrollbar-color: rgba(6, 182, 212, 0.3) transparent;
        position: relative;
    }

    .drawer-body::-webkit-scrollbar {
        width: 5px;
    }

    .drawer-body::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.5);
    }

    .drawer-body::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, rgba(6, 182, 212, 0.4), rgba(139, 92, 246, 0.3));
        border-radius: 3px;
    }

    /* Gradient scrim at bottom - indicates more content */
    .drawer-body::after {
        content: '';
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        height: 40px;
        background: linear-gradient(to top, rgba(15, 23, 42, 0.95), transparent);
        pointer-events: none;
        z-index: 1;
        display: block;
        margin-top: -40px;
    }

    /* ============================================
       TITLE SECTION - Academic & Industry-Focused
       Premium typography for professional learning
    ============================================ */
    .drawer-title-section {
        margin-bottom: 2px;
        padding-bottom: 2px;
        border-bottom: 2px solid transparent;
        border-image: linear-gradient(90deg, rgba(6, 182, 212, 0.4), rgba(139, 92, 246, 0.3), transparent) 1;
        position: relative;
    }

    .drawer-title {
        font-family: 'Sora', 'Poppins', sans-serif;
        font-size: 1.22rem;
        font-weight: 800;
        color: #f8fafc;
        margin: 0 0 0.15rem 0;
        line-height: 1.2;
        letter-spacing: -0.025em;
        background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 50%, #c4b5fd 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        /* Academic title shadow for depth */
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
    }

    .drawer-credits {
        display: flex;
        gap: 1rem;
    }

    .credit-item {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        color: #94a3b8;
        font-size: 0.75rem;
        font-weight: 500;
        font-family: 'Space Grotesk', sans-serif;
    }

    .credit-item i {
        color: #06b6d4;
        font-size: 0.7rem;
    }

    /* ============================================
       STATS BAR - Premium Horizontal Layout (Compact)
    ============================================ */
    .stats-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(30, 41, 59, 0.4);
        border-radius: 8px;
        padding: 0.25rem 0.5rem;
        margin-bottom: 2px;
        border: 1px solid rgba(6, 182, 212, 0.1);
    }

    .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.15rem;
        flex: 1;
    }

    .stat-item i {
        color: #06b6d4;
        font-size: 0.85rem;
        margin-bottom: 0.1rem;
    }

    .stat-item.total i {
        color: #8b5cf6;
    }

    .stat-value {
        font-family: 'JetBrains Mono', 'Space Grotesk', monospace;
        font-size: 1.1rem;
        font-weight: 700;
        color: #f8fafc;
        line-height: 1;
    }

    .stat-label {
        font-size: 0.58rem;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 500;
    }

    .stat-divider {
        width: 1px;
        height: 32px;
        background: linear-gradient(180deg, transparent, rgba(6, 182, 212, 0.3), transparent);
    }

    /* ============================================
       BIMESTRE PROGRESS BAR
    ============================================ */
    .bimestre-progress {
        background: rgba(15, 23, 42, 0.4);
        border-radius: 8px;
        padding: 0.25rem 0.5rem;
        border: 1px solid rgba(148, 163, 184, 0.08);
        margin-bottom: 2px;
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.15rem;
    }

    .progress-label span {
        font-size: 0.62rem;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        font-weight: 500;
    }

    .progress-text {
        font-family: 'JetBrains Mono', monospace;
        color: #94a3b8 !important;
    }

    .progress-track {
        height: 6px;
        background: rgba(30, 41, 59, 0.6);
        border-radius: 3px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #06b6d4, #8b5cf6, #ec4899);
        border-radius: 3px;
        transition: width 0.4s ease;
    }

    /* ============================================
       SECTIONS - Ultra-Compact Typography
       Minimal spacing for dense information display
    ============================================ */
    .drawer-section {
        margin-bottom: 1px;
        padding-bottom: 0;
        border-bottom: none;
        position: relative;
        margin-top: 2px;
    }

    .drawer-section:first-child {
        margin-top: 0;
    }

    .drawer-section:last-child {
        margin-bottom: 0;
        border-bottom: none;
    }

    /* Section titles - Course Syllabus Style (Zero Gap) */
    .section-title {
        font-family: 'Space Grotesk', 'Sora', sans-serif;
        font-size: 0.62rem;
        font-weight: 700;
        color: #cbd5e1;
        margin: 0 0 1px 0;
        padding: 1px 0.3rem 1px 0.25rem;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.1), rgba(139, 92, 246, 0.05), transparent);
        border-radius: 0 6px 6px 0;
        border-left: 3px solid;
        border-image: linear-gradient(180deg, #22d3ee, #8b5cf6) 1;
        position: relative;
    }

    /* Subtle academic accent line */
    .section-title::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 3px;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.15), transparent);
    }

    .section-title i {
        color: #22d3ee;
        font-size: 0.6rem;
        opacity: 1;
        filter: drop-shadow(0 0 3px rgba(34, 211, 238, 0.3));
    }

    /* Main content typography - Zero Gap Study Reading */
    .section-content {
        color: #e2e8f0;
        font-size: 0.74rem;
        line-height: 1.35;
        margin: 0;
        padding-bottom: 0;
        font-family: 'Inter', 'Roboto', system-ui, sans-serif;
        letter-spacing: -0.005em;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-shadow: 0 0 1px rgba(0, 0, 0, 0.1);
    }

    /* Academic Drop Cap - Book chapter style (Compact) */
    .section-content::first-letter {
        font-size: 1.4em;
        font-weight: 800;
        font-family: 'Sora', serif;
        color: transparent;
        background: linear-gradient(135deg, #22d3ee, #8b5cf6);
        -webkit-background-clip: text;
        background-clip: text;
        float: left;
        line-height: 0.9;
        margin-right: 0.12em;
        margin-top: 0.08em;
        filter: drop-shadow(0 1px 2px rgba(34, 211, 238, 0.2));
    }

    /* Propósito Box - Structured Highlight (Ultra-Compact) */
    .proposito-box {
        margin-top: 0.1rem;
        padding: 0.15rem 0.35rem;
        background: rgba(6, 182, 212, 0.05);
        border-radius: 4px;
        border-left: 2px solid rgba(6, 182, 212, 0.5);
    }

    .proposito-box strong {
        color: #22d3ee;
        display: inline;
        font-size: 0.6rem;
        font-family: 'Space Grotesk', sans-serif;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin-right: 0.3rem;
    }

    .proposito-box strong i {
        margin-right: 0.15rem;
        font-size: 0.55rem;
    }

    .proposito-box span {
        color: #cbd5e1;
        font-size: 0.72rem;
        line-height: 1.4;
        font-family: 'Inter', system-ui, sans-serif;
        display: inline;
    }

    /* Objectives List - Learning Outcomes Style (Ultra-Compact) */
    .objectives-list {
        list-style: none;
        padding: 0;
        margin: 0 0 0.1rem 0;
        display: flex;
        flex-direction: column;
        gap: 0.08rem;
        counter-reset: obj;
    }

    .objectives-list li {
        position: relative;
        padding: 0.18rem 0.35rem 0.18rem 1.7rem;
        color: #e2e8f0;
        font-size: 0.74rem;
        line-height: 1.35;
        font-family: 'Inter', system-ui, sans-serif;
        transition: all 0.2s ease;
        letter-spacing: -0.008em;
        counter-increment: obj;
        background: linear-gradient(90deg, rgba(30, 41, 59, 0.25), rgba(30, 41, 59, 0.1));
        border-radius: 5px;
        border-left: 2px solid transparent;
    }

    .objectives-list li:hover {
        color: #f8fafc;
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.08), rgba(30, 41, 59, 0.15));
        border-left-color: rgba(6, 182, 212, 0.5);
        transform: translateX(2px);
    }

    .objectives-list li::before {
        content: 'OA' counter(obj);
        position: absolute;
        left: 0.25rem;
        top: 50%;
        transform: translateY(-50%);
        padding: 0.08rem 0.25rem;
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(139, 92, 246, 0.15));
        border-radius: 4px;
        font-size: 0.48rem;
        font-weight: 700;
        color: #22d3ee;
        font-family: 'JetBrains Mono', monospace;
        letter-spacing: 0.02em;
        border: 1px solid rgba(6, 182, 212, 0.15);
    }

    /* Competencias Tags - Industry Skills Badges (Compact) */
    .competencias-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.2rem;
    }

    .competencia-tag {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.12), rgba(139, 92, 246, 0.06));
        color: #c4b5fd;
        padding: 0.18rem 0.4rem;
        border-radius: 14px;
        font-size: 0.64rem;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: 0.01em;
        border: 1px solid rgba(139, 92, 246, 0.2);
        transition: all 0.25s ease;
        position: relative;
        box-shadow: 0 1px 3px rgba(139, 92, 246, 0.08);
    }

    /* Skill level indicator dot */
    .competencia-tag::before {
        content: '';
        width: 5px;
        height: 5px;
        background: linear-gradient(135deg, #a78bfa, #8b5cf6);
        border-radius: 50%;
        margin-right: 0.25rem;
        display: inline-block;
        vertical-align: middle;
        box-shadow: 0 0 4px rgba(139, 92, 246, 0.4);
    }

    .competencia-tag:hover {
        background: rgba(139, 92, 246, 0.18);
        color: #c7d2fe;
        border-color: rgba(139, 92, 246, 0.3);
    }

    /* ============================================
       EXPERIENCIAS ACCORDION - Training Modules (Ultra-Compact)
    ============================================ */
    .experiencias-accordion {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .exp-card {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(30, 41, 59, 0.2));
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid rgba(148, 163, 184, 0.1);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }

    .exp-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.4rem 0.55rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .exp-header:hover {
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.08), transparent);
    }

    .exp-header-left {
        display: flex;
        align-items: center;
        gap: 0.45rem;
    }

    .exp-number {
        width: 22px;
        height: 22px;
        background: linear-gradient(135deg, #06b6d4, #0891b2);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.65rem;
        font-weight: 800;
        color: white;
        flex-shrink: 0;
        box-shadow: 0 2px 6px rgba(6, 182, 212, 0.3);
        font-family: 'JetBrains Mono', monospace;
        position: relative;
    }

    /* Module indicator accent */
    .exp-number::after {
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 8px;
        border: 1px solid rgba(6, 182, 212, 0.3);
    }

    .exp-info h4 {
        margin: 0;
        font-size: 0.75rem;
        font-weight: 700;
        color: #f1f5f9;
        line-height: 1.25;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: -0.01em;
    }

    .exp-info span {
        font-size: 0.58rem;
        color: #64748b;
        font-family: 'JetBrains Mono', monospace;
        letter-spacing: 0.02em;
        background: rgba(100, 116, 139, 0.15);
        padding: 0.08rem 0.28rem;
        border-radius: 3px;
        margin-top: 0.1rem;
        display: inline-block;
    }

    .exp-toggle {
        color: #475569;
        transition: transform 0.2s ease;
        font-size: 0.6rem;
    }

    .exp-card.expanded .exp-toggle {
        transform: rotate(180deg);
        color: #06b6d4;
    }

    .exp-content {
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        visibility: hidden;
        padding: 0;
        transition: max-height 0.3s ease, opacity 0.2s ease, visibility 0.2s ease;
    }

    .exp-card.expanded .exp-content {
        max-height: 800px;
        overflow-y: auto;
        opacity: 1;
        visibility: visible;
    }

    .exp-content-inner {
        padding: 0.35rem 0.5rem 0.45rem 1.8rem;
        border-left: 2px solid rgba(6, 182, 212, 0.2);
        margin-left: 0.6rem;
    }

    .exp-description {
        color: #94a3b8;
        font-size: 0.68rem;
        margin-bottom: 0.15rem;
        font-style: italic;
        line-height: 1.4;
    }

    .exp-subsection {
        margin-bottom: 0.1rem;
    }

    .exp-subsection:last-child {
        margin-bottom: 0;
    }

    .exp-subsection h5 {
        color: #64748b;
        font-size: 0.55rem;
        margin: 0 0 0.15rem 0;
        display: inline-flex;
        align-items: center;
        gap: 0.18rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-weight: 600;
    }

    .exp-subsection h5 i {
        color: #06b6d4;
        font-size: 0.5rem;
        opacity: 0.8;
    }

    .exp-subsection ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .exp-subsection li {
        position: relative;
        padding-left: 0.55rem;
        font-size: 0.66rem;
        color: #cbd5e1;
        margin-bottom: 0.1rem;
        line-height: 1.3;
    }

    .exp-subsection li::before {
        content: '›';
        position: absolute;
        left: 0;
        color: #06b6d4;
        font-size: 0.68rem;
        font-weight: 600;
    }

    /* Separator line between description/contenidos/actividades */
    .exp-separator {
        height: 1px;
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.3), rgba(139, 92, 246, 0.15), transparent);
        margin: 0.5rem 0;
        border-radius: 1px;
    }

    /* ============================================
       TECNOLOGÍAS GRID - Skill Badges (Compact)
    ============================================ */
    .tech-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.2rem;
    }

    .tech-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.28rem 0.5rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.5), rgba(30, 41, 59, 0.25));
        border-radius: 6px;
        border: 1px solid rgba(6, 182, 212, 0.12);
        transition: all 0.25s ease;
        position: relative;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.03);
    }

    /* Tech proficiency level indicator */
    .tech-chip::after {
        content: '';
        position: absolute;
        top: 3px;
        right: 3px;
        width: 4px;
        height: 4px;
        background: linear-gradient(135deg, #22d3ee, #06b6d4);
        border-radius: 50%;
        opacity: 0.7;
        box-shadow: 0 0 4px rgba(34, 211, 238, 0.4);
    }

    .tech-chip:hover {
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(6, 182, 212, 0.05));
        border-color: rgba(6, 182, 212, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(6, 182, 212, 0.15);
    }

    .tech-chip:hover::after {
        opacity: 1;
        animation: techPulse 1s infinite;
    }

    @keyframes techPulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.3); opacity: 0.7; }
    }

    .tech-chip i,
    .tech-chip img {
        font-size: 0.95rem;
        width: 15px;
        height: 15px;
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
    }

    .tech-chip span {
        color: #e2e8f0;
        font-size: 0.68rem;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: 0.01em;
    }

    /* ============================================
       EVALUACIONES - Assessment Style (Compact)
    ============================================ */
    .evaluaciones-list {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .eval-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.35rem 0.5rem;
        border-left: 3px solid var(--eval-color, #06b6d4);
        background: linear-gradient(90deg, rgba(30, 41, 59, 0.3), rgba(30, 41, 59, 0.15));
        border-radius: 0 6px 6px 0;
        position: relative;
        transition: all 0.2s ease;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
    }

    .eval-item:hover {
        background: linear-gradient(90deg, rgba(30, 41, 59, 0.4), rgba(30, 41, 59, 0.2));
        transform: translateX(2px);
    }

    .eval-item.formativa { --eval-color: #22c55e; }
    .eval-item.sumativa { --eval-color: #f59e0b; }
    .eval-item.prueba { --eval-color: #ef4444; }

    /* Visual weight indicator bar */
    .eval-item::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 3px;
        width: var(--eval-weight, 30%);
        height: 2px;
        background: linear-gradient(90deg, var(--eval-color, #06b6d4), transparent);
        opacity: 0.5;
        border-radius: 1px;
    }

    .eval-info {
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }

    .eval-info h4 {
        margin: 0;
        font-size: 0.72rem;
        color: #f1f5f9;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: -0.01em;
    }

    .eval-info span {
        font-size: 0.5rem;
        color: var(--eval-color, #06b6d4);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
        padding: 0.1rem 0.3rem;
        background: rgba(var(--eval-rgb, 6, 182, 212), 0.12);
        border-radius: 3px;
        font-family: 'Space Grotesk', sans-serif;
    }

    .eval-item.formativa .eval-info span { --eval-rgb: 34, 197, 94; }
    .eval-item.sumativa .eval-info span { --eval-rgb: 245, 158, 11; }
    .eval-item.prueba .eval-info span { --eval-rgb: 239, 68, 68; }

    .eval-percent {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.78rem;
        font-weight: 800;
        color: var(--eval-color, #06b6d4);
        text-shadow: 0 0 8px rgba(var(--eval-rgb, 6, 182, 212), 0.3);
        padding: 0.15rem 0.4rem;
        background: rgba(var(--eval-rgb, 6, 182, 212), 0.08);
        border-radius: 5px;
        border: 1px solid rgba(var(--eval-rgb, 6, 182, 212), 0.2);
    }

    /* ============================================
       CONEXIONES - Learning Path Map (Compact)
    ============================================ */
    .connections-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.25rem;
    }

    .connection-box {
        padding: 0.4rem 0.5rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.3), rgba(30, 41, 59, 0.15));
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.08);
        position: relative;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
    }

    .connection-box h4 {
        margin: 0 0 0.3rem 0;
        font-size: 0.52rem;
        color: #94a3b8;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 700;
        font-family: 'Space Grotesk', sans-serif;
    }

    .prereq-box {
        border-left: 3px solid rgba(245, 158, 11, 0.4);
    }

    .prereq-box h4 i {
        color: #f59e0b;
        font-size: 0.52rem;
        filter: drop-shadow(0 0 3px rgba(245, 158, 11, 0.3));
    }

    .next-box {
        border-left: 3px solid rgba(34, 197, 94, 0.4);
    }

    .next-box h4 i {
        color: #22c55e;
        font-size: 0.52rem;
        filter: drop-shadow(0 0 3px rgba(34, 197, 94, 0.3));
    }

    .connection-items {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
    }

    .connection-item {
        padding: 0.2rem 0.4rem;
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.12), rgba(6, 182, 212, 0.06));
        border-radius: 5px;
        font-size: 0.65rem;
        color: #67e8f9;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        border: 1px solid rgba(6, 182, 212, 0.15);
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .connection-item:hover {
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(6, 182, 212, 0.1));
        border-color: rgba(6, 182, 212, 0.3);
        transform: translateY(-1px);
    }

    .no-prereq {
        color: #64748b;
        font-size: 0.65rem;
        font-style: italic;
        font-family: 'Inter', system-ui, sans-serif;
        display: inline-flex;
        align-items: center;
        gap: 0.2rem;
    }

    .no-prereq::before {
        content: '✓';
        font-size: 0.6rem;
        color: #22c55e;
        font-style: normal;
    }

    /* ============================================
       RECURSOS - Academic Learning Center Style
       Library card catalog inspired design
    ============================================ */
    .recursos-grid {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }

    .recurso-link {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.35rem 0.5rem;
        text-decoration: none;
        border-radius: 6px;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.25), rgba(30, 41, 59, 0.1));
        transition: all 0.25s ease;
        border: 1px solid rgba(148, 163, 184, 0.06);
        position: relative;
        /* Academic card shadow */
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
    }

    .recurso-link:hover {
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(6, 182, 212, 0.03));
        border-color: rgba(6, 182, 212, 0.2);
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(6, 182, 212, 0.1);
    }

    /* Reading arrow indicator */
    .recurso-link::after {
        content: '→';
        position: absolute;
        right: 0.65rem;
        color: #475569;
        font-size: 0.7rem;
        opacity: 0;
        transform: translateX(-4px);
        transition: all 0.2s ease;
    }

    .recurso-link:hover::after {
        opacity: 1;
        transform: translateX(0);
        color: #22d3ee;
    }

    .recurso-icon {
        width: 26px;
        height: 26px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(6, 182, 212, 0.08));
        border-radius: 6px;
        flex-shrink: 0;
        border: 1px solid rgba(6, 182, 212, 0.15);
        /* Book spine effect */
        box-shadow: inset -2px 0 0 rgba(6, 182, 212, 0.1);
    }

    .recurso-icon i {
        color: #22d3ee;
        font-size: 0.7rem;
        filter: drop-shadow(0 1px 2px rgba(34, 211, 238, 0.2));
    }

    .recurso-info {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
        min-width: 0;
        flex: 1;
    }

    .recurso-info h5 {
        margin: 0;
        font-size: 0.72rem;
        color: #f1f5f9;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        letter-spacing: -0.01em;
    }

    .recurso-info span {
        font-size: 0.5rem;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-family: 'Space Grotesk', sans-serif;
        font-weight: 500;
    }

    /* ============================================
       PREMIUM INDICATORS - Dificultad, Estudio, Keywords
       Enterprise learning dashboard metrics
    ============================================ */
    .indicators-section {
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        margin-top: 1px !important;
        margin-bottom: 1px !important;
    }

    .premium-indicators {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.2rem;
        margin-bottom: 0.15rem;
    }

    .indicator-card {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.4rem 0.55rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.4), rgba(30, 41, 59, 0.2));
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.1);
        transition: all 0.25s ease;
    }

    .indicator-card:hover {
        border-color: rgba(6, 182, 212, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .indicator-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        flex-shrink: 0;
    }

    .difficulty-card .indicator-icon {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
        color: #22c55e;
    }

    .study-card .indicator-icon {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1));
        color: #a78bfa;
    }

    .indicator-icon i {
        font-size: 0.85rem;
    }

    .indicator-info {
        display: flex;
        flex-direction: column;
        gap: 0.1rem;
        flex: 1;
    }

    .indicator-label {
        font-size: 0.55rem;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
    }

    .indicator-value {
        font-size: 0.82rem;
        color: #f1f5f9;
        font-weight: 700;
        font-family: 'Inter', system-ui, sans-serif;
    }

    .difficulty-bar {
        display: flex;
        gap: 3px;
        margin-left: auto;
    }

    .diff-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: rgba(148, 163, 184, 0.2);
        transition: all 0.2s ease;
    }

    .diff-dot.active {
        background: #22c55e;
        box-shadow: 0 0 6px rgba(34, 197, 94, 0.5);
    }

    /* Difficulty levels colors */
    .difficulty-card[data-level="basico"] .diff-dot.active { background: #22c55e; box-shadow: 0 0 6px rgba(34, 197, 94, 0.5); }
    .difficulty-card[data-level="intermedio"] .diff-dot.active { background: #eab308; box-shadow: 0 0 6px rgba(234, 179, 8, 0.5); }
    .difficulty-card[data-level="avanzado"] .diff-dot.active { background: #f97316; box-shadow: 0 0 6px rgba(249, 115, 22, 0.5); }
    .difficulty-card[data-level="experto"] .diff-dot.active { background: #ef4444; box-shadow: 0 0 6px rgba(239, 68, 68, 0.5); }

    /* Keywords Cloud */
    .keywords-cloud {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.2));
        border-radius: 8px;
        padding: 0.25rem 0.4rem;
        border: 1px solid rgba(148, 163, 184, 0.08);
        margin-top: 2px;
    }

    .keywords-label {
        font-size: 0.58rem;
        color: #94a3b8;
        font-weight: 600;
        margin-bottom: 0.15rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .keywords-label i {
        color: #22d3ee;
        font-size: 0.65rem;
    }

    .keywords-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.2rem;
    }

    /* Keyword Tags - Blanco mate sobrio (global para elementos dinámicos) */
    :global(.keyword-tag) {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.3rem 0.55rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.6), rgba(30, 41, 59, 0.3));
        border-radius: 6px;
        border: 1px solid rgba(148, 163, 184, 0.15);
        transition: all 0.25s ease;
        position: relative;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.04);
        font-size: 0.7rem;
        font-weight: 600;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: 0.01em;
        color: #e2e8f0;
        cursor: default;
    }

    /* Keyword indicator dot - blanco mate */
    :global(.keyword-tag)::before {
        content: '';
        width: 5px;
        height: 5px;
        background: linear-gradient(135deg, #cbd5e1, #94a3b8);
        border-radius: 50%;
        display: inline-block;
        box-shadow: 0 0 3px rgba(148, 163, 184, 0.3);
    }

    :global(.keyword-tag:hover) {
        background: linear-gradient(135deg, rgba(51, 65, 85, 0.7), rgba(51, 65, 85, 0.4));
        border-color: rgba(148, 163, 184, 0.3);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        color: #f1f5f9;
    }

    :global(.keyword-tag:hover)::before {
        background: linear-gradient(135deg, #f1f5f9, #cbd5e1);
        box-shadow: 0 0 4px rgba(241, 245, 249, 0.4);
    }

    /* ============================================
       TIPS DE ESTUDIO - Academic Advice Cards
    ============================================ */
    .tips-list {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .tip-item {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        padding: 0.5rem 0.6rem;
        background: linear-gradient(135deg, rgba(234, 179, 8, 0.08), rgba(234, 179, 8, 0.03));
        border-radius: 8px;
        border-left: 3px solid #eab308;
        transition: all 0.25s ease;
    }

    .tip-item:hover {
        background: linear-gradient(135deg, rgba(234, 179, 8, 0.12), rgba(234, 179, 8, 0.05));
        transform: translateX(3px);
    }

    .tip-icon {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(234, 179, 8, 0.15);
        border-radius: 50%;
        flex-shrink: 0;
        margin-top: 0.1rem;
    }

    .tip-icon i {
        font-size: 0.55rem;
        color: #fbbf24;
    }

    .tip-text {
        font-size: 0.7rem;
        color: #e2e8f0;
        line-height: 1.45;
        font-family: 'Inter', system-ui, sans-serif;
    }

    /* ============================================
       PROYECTOS SUGERIDOS - Portfolio Builder
    ============================================ */
    .projects-grid {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }

    .project-card {
        padding: 0.65rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.35), rgba(30, 41, 59, 0.15));
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.08);
        transition: all 0.25s ease;
    }

    .project-card:hover {
        border-color: rgba(139, 92, 246, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(139, 92, 246, 0.1);
    }

    .project-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.35rem;
    }

    .project-name {
        font-size: 0.75rem;
        color: #f1f5f9;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }

    .project-name i {
        color: #a78bfa;
        font-size: 0.7rem;
    }

    .project-level {
        padding: 0.15rem 0.45rem;
        border-radius: 10px;
        font-size: 0.5rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.04em;
    }

    .project-level.principiante {
        background: rgba(34, 197, 94, 0.15);
        color: #4ade80;
        border: 1px solid rgba(34, 197, 94, 0.25);
    }

    .project-level.intermedio {
        background: rgba(234, 179, 8, 0.15);
        color: #fbbf24;
        border: 1px solid rgba(234, 179, 8, 0.25);
    }

    .project-level.avanzado {
        background: rgba(239, 68, 68, 0.15);
        color: #f87171;
        border: 1px solid rgba(239, 68, 68, 0.25);
    }

    .project-desc {
        font-size: 0.65rem;
        color: #94a3b8;
        line-height: 1.4;
        margin-bottom: 0.3rem;
    }

    .project-duration {
        font-size: 0.55rem;
        color: #64748b;
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    .project-duration i {
        color: #22d3ee;
        font-size: 0.5rem;
    }

    /* ============================================
       RELEVANCIA PROFESIONAL - Career Pathways
    ============================================ */
    .relevance-grid {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .relevance-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.6rem;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.3), rgba(30, 41, 59, 0.1));
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.06);
        transition: all 0.25s ease;
    }

    .relevance-item:hover {
        border-color: rgba(6, 182, 212, 0.25);
        transform: translateX(3px);
    }

    .relevance-icon {
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        flex-shrink: 0;
    }

    .relevance-item[data-importance="alta"] .relevance-icon {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
        color: #22c55e;
    }

    .relevance-item[data-importance="media"] .relevance-icon {
        background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1));
        color: #eab308;
    }

    .relevance-item[data-importance="baja"] .relevance-icon {
        background: linear-gradient(135deg, rgba(148, 163, 184, 0.2), rgba(148, 163, 184, 0.1));
        color: #94a3b8;
    }

    .relevance-icon i {
        font-size: 0.7rem;
    }

    .relevance-info {
        flex: 1;
        min-width: 0;
    }

    .relevance-role {
        font-size: 0.72rem;
        color: #f1f5f9;
        font-weight: 600;
        margin-bottom: 0.1rem;
    }

    .relevance-desc {
        font-size: 0.58rem;
        color: #94a3b8;
        line-height: 1.35;
    }

    .relevance-badge {
        padding: 0.15rem 0.4rem;
        border-radius: 8px;
        font-size: 0.48rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        flex-shrink: 0;
    }

    .relevance-badge.alta {
        background: rgba(34, 197, 94, 0.15);
        color: #4ade80;
    }

    .relevance-badge.media {
        background: rgba(234, 179, 8, 0.15);
        color: #fbbf24;
    }

    .relevance-badge.baja {
        background: rgba(148, 163, 184, 0.15);
        color: #94a3b8;
    }

    /* ============================================
       DRAWER FOOTER - Premium Study Action
       Professional learning platform style CTA
    ============================================ */
    .drawer-footer {
        padding: 0.5rem 0.7rem;
        border-top: 1px solid rgba(6, 182, 212, 0.15);
        flex-shrink: 0;
        background: linear-gradient(180deg, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.6));
    }

    .drawer-cta {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.45rem;
        width: 100%;
        padding: 0.55rem 0.8rem;
        background: linear-gradient(135deg, #06b6d4 0%, #0891b2 50%, #8b5cf6 100%);
        border-radius: 8px;
        color: white;
        text-decoration: none;
        font-weight: 700;
        font-size: 0.78rem;
        font-family: 'Inter', system-ui, sans-serif;
        letter-spacing: 0.02em;
        transition: all 0.25s ease;
        box-shadow:
            0 4px 16px rgba(6, 182, 212, 0.25),
            0 2px 6px rgba(139, 92, 246, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        position: relative;
        overflow: hidden;
    }

    /* Shimmer effect on hover */
    .drawer-cta::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
        transition: left 0.5s ease;
    }

    .drawer-cta:hover::before {
        left: 100%;
    }

    .drawer-cta:hover {
        transform: translateY(-3px);
        box-shadow:
            0 8px 24px rgba(6, 182, 212, 0.35),
            0 4px 12px rgba(139, 92, 246, 0.2);
    }

    .drawer-cta i {
        font-size: 1rem;
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
    }

    /* ============================================
       LIGHT MODE - Structured Styles
    ============================================ */
    :global([data-theme="light"]) .drawer-overlay {
        background: rgba(0, 0, 0, 0.35);
    }

    :global([data-theme="light"]) .subject-drawer {
        background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
        border-left-color: rgba(6, 182, 212, 0.3);
        box-shadow: -8px 0 32px rgba(0, 0, 0, 0.08);
    }

    :global([data-theme="light"]) .drawer-header {
        background: rgba(241, 245, 249, 0.8);
        border-bottom-color: rgba(148, 163, 184, 0.15);
    }

    :global([data-theme="light"]) .drawer-code {
        color: #475569;
        background: rgba(71, 85, 105, 0.08);
    }

    :global([data-theme="light"]) .drawer-title {
        background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    :global([data-theme="light"]) .drawer-title-section {
        border-bottom-color: rgba(148, 163, 184, 0.15);
    }

    :global([data-theme="light"]) .stats-bar {
        background: rgba(241, 245, 249, 0.8);
        border-color: rgba(6, 182, 212, 0.15);
    }

    :global([data-theme="light"]) .stat-value {
        color: #0f172a;
    }

    :global([data-theme="light"]) .stat-label {
        color: #64748b;
    }

    :global([data-theme="light"]) .stat-divider {
        background: linear-gradient(180deg, transparent, rgba(6, 182, 212, 0.2), transparent);
    }

    :global([data-theme="light"]) .bimestre-progress {
        background: rgba(241, 245, 249, 0.6);
        border-color: rgba(148, 163, 184, 0.12);
    }

    :global([data-theme="light"]) .progress-label span {
        color: #475569;
    }

    :global([data-theme="light"]) .progress-track {
        background: rgba(226, 232, 240, 0.8);
    }

    :global([data-theme="light"]) .drawer-section {
        border-bottom-color: rgba(148, 163, 184, 0.08);
    }

    :global([data-theme="light"]) .section-title {
        color: #475569;
    }

    :global([data-theme="light"]) .credit-item {
        color: #64748b;
    }

    :global([data-theme="light"]) .section-content {
        color: #334155;
    }

    :global([data-theme="light"]) .proposito-box {
        background: rgba(6, 182, 212, 0.06);
        border-left-color: rgba(6, 182, 212, 0.4);
    }

    :global([data-theme="light"]) .proposito-box strong {
        color: #0891b2;
    }

    :global([data-theme="light"]) .proposito-box span {
        color: #334155;
    }

    :global([data-theme="light"]) .objectives-list li {
        color: #334155;
        background: rgba(241, 245, 249, 0.6);
    }

    :global([data-theme="light"]) .objectives-list li:hover {
        background: rgba(241, 245, 249, 0.9);
    }

    :global([data-theme="light"]) .objectives-list li::before {
        background: rgba(6, 182, 212, 0.12);
        color: #0891b2;
    }

    :global([data-theme="light"]) .competencia-tag {
        background: rgba(139, 92, 246, 0.08);
        color: #7c3aed;
        border-color: rgba(139, 92, 246, 0.12);
    }

    :global([data-theme="light"]) .exp-card {
        background: rgba(241, 245, 249, 0.6);
        border-color: rgba(148, 163, 184, 0.12);
    }

    :global([data-theme="light"]) .exp-number {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    :global([data-theme="light"]) .exp-info h4 {
        color: #1e293b;
    }

    :global([data-theme="light"]) .exp-info span {
        color: #64748b;
    }

    :global([data-theme="light"]) .exp-content-inner {
        border-left-color: rgba(6, 182, 212, 0.25);
    }

    :global([data-theme="light"]) .exp-description {
        color: #64748b;
    }

    :global([data-theme="light"]) .exp-subsection h5 {
        color: #475569;
    }

    :global([data-theme="light"]) .exp-subsection li {
        color: #334155;
    }

    :global([data-theme="light"]) .exp-subsection li::before {
        color: #0891b2;
    }

    :global([data-theme="light"]) .tech-chip {
        background: rgba(241, 245, 249, 0.8);
        border-color: rgba(148, 163, 184, 0.15);
    }

    :global([data-theme="light"]) .tech-chip span {
        color: #334155;
    }

    :global([data-theme="light"]) .eval-item {
        background: rgba(241, 245, 249, 0.5);
    }

    :global([data-theme="light"]) .eval-info h4 {
        color: #1e293b;
    }

    :global([data-theme="light"]) .eval-info span {
        color: #64748b;
    }

    :global([data-theme="light"]) .connection-box {
        background: rgba(241, 245, 249, 0.6);
    }

    :global([data-theme="light"]) .connection-box h4 {
        color: #475569;
    }

    :global([data-theme="light"]) .connection-item {
        background: rgba(6, 182, 212, 0.1);
        color: #0891b2;
    }

    :global([data-theme="light"]) .recurso-link {
        background: rgba(241, 245, 249, 0.6);
    }

    :global([data-theme="light"]) .recurso-link:hover {
        background: rgba(6, 182, 212, 0.08);
    }

    :global([data-theme="light"]) .recurso-icon {
        background: rgba(6, 182, 212, 0.08);
    }

    :global([data-theme="light"]) .recurso-info h5 {
        color: #1e293b;
    }

    /* Light mode gradient scrim */
    :global([data-theme="light"]) .drawer-body::after {
        background: linear-gradient(to top, rgba(248, 250, 252, 0.95), transparent);
    }

    :global([data-theme="light"]) .drawer-footer {
        background: rgba(248, 250, 252, 0.9);
        border-top-color: rgba(148, 163, 184, 0.12);
    }

    /* ============================================
       RESPONSIVE - Premium Breakpoints
    ============================================ */
    @media (max-width: 1400px) {
        .subject-drawer {
            width: 480px;
            right: 360px; /* Match AI Tutor 360px width at 1400px */
        }
        .subject-drawer.expanded-width {
            width: 620px;
        }
    }

    @media (max-width: 1200px) {
        .subject-drawer {
            right: 340px; /* Match AI Tutor 340px width at 1200px */
            width: 460px;
        }
        .subject-drawer.expanded-width {
            width: 580px;
        }
    }

    @media (max-width: 900px) {
        .subject-drawer {
            right: 0 !important;
            width: 100%;
            max-width: 520px;
        }
        .subject-drawer.expanded-width {
            width: 100%;
            max-width: 520px;
        }
    }

    @media (max-width: 600px) {
        .subject-drawer {
            width: 100%;
            max-width: 100%;
        }

        .drawer-title {
            font-size: 1rem;
        }

        .connections-grid {
            grid-template-columns: 1fr;
        }

        .drawer-credits {
            flex-direction: column;
            gap: 0.35rem;
        }

        .drawer-body {
            padding: 0.6rem 0.75rem;
        }

        .drawer-header {
            padding: 0.45rem 0.65rem;
        }

        .drawer-footer {
            padding: 0.5rem 0.75rem;
        }

        .tech-grid {
            gap: 0.25rem;
        }

        .tech-chip {
            padding: 0.28rem 0.45rem;
        }

        .competencias-tags {
            gap: 0.25rem;
        }
    }

    /* ============================================
       PREMIUM TOOLTIPS - Material Design 3 Style
       Sophisticated tooltips with soft animations
    ============================================ */
    [data-tooltip] {
        position: relative;
        cursor: help;
    }

    [data-tooltip]::before {
        content: attr(data-tooltip);
        position: absolute;
        bottom: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%) translateY(4px);
        padding: 0.55rem 0.75rem;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.97), rgba(30, 41, 59, 0.97));
        color: #e2e8f0;
        font-size: 0.68rem;
        font-family: 'Inter', system-ui, sans-serif;
        font-weight: 500;
        line-height: 1.45;
        letter-spacing: -0.01em;
        white-space: normal;
        max-width: 260px;
        min-width: 140px;
        border-radius: 8px;
        border: 1px solid rgba(6, 182, 212, 0.25);
        box-shadow:
            0 4px 16px rgba(0, 0, 0, 0.35),
            0 2px 8px rgba(6, 182, 212, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition:
            opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1),
            transform 0.2s cubic-bezier(0.4, 0, 0.2, 1),
            visibility 0.2s;
    }

    /* Tooltip arrow */
    [data-tooltip]::after {
        content: '';
        position: absolute;
        bottom: calc(100% + 4px);
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: rgba(15, 23, 42, 0.97);
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition:
            opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1),
            visibility 0.2s;
    }

    /* Show tooltip on hover */
    [data-tooltip]:hover::before {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(0);
    }

    [data-tooltip]:hover::after {
        opacity: 1;
        visibility: visible;
    }

    /* Tooltips for items at the top - show below */
    .stats-bar [data-tooltip]::before {
        bottom: auto;
        top: calc(100% + 8px);
        transform: translateX(-50%) translateY(-4px);
    }

    .stats-bar [data-tooltip]::after {
        bottom: auto;
        top: calc(100% + 4px);
        border-top-color: transparent;
        border-bottom-color: rgba(15, 23, 42, 0.97);
    }

    .stats-bar [data-tooltip]:hover::before {
        transform: translateX(-50%) translateY(0);
    }

    /* Light mode tooltips */
    :global([data-theme="light"]) [data-tooltip]::before {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.98));
        color: #1e293b;
        border-color: rgba(6, 182, 212, 0.2);
        box-shadow:
            0 4px 20px rgba(0, 0, 0, 0.12),
            0 2px 8px rgba(6, 182, 212, 0.08),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }

    :global([data-theme="light"]) [data-tooltip]::after {
        border-top-color: rgba(255, 255, 255, 0.98);
    }

    :global([data-theme="light"]) .stats-bar [data-tooltip]::after {
        border-top-color: transparent;
        border-bottom-color: rgba(255, 255, 255, 0.98);
    }

    /* ============================================
       DYNAMIC TYPOGRAPHY - Enhanced Content Styling
       Highlights, emphasis, visual hierarchy
    ============================================ */

    /* Highlighted/Important text */
    .highlight {
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.15), rgba(139, 92, 246, 0.1));
        padding: 0.1rem 0.35rem;
        border-radius: 4px;
        color: #22d3ee;
        font-weight: 600;
    }

    /* Underlined emphasis */
    .underline-accent {
        text-decoration: underline;
        text-decoration-color: rgba(6, 182, 212, 0.5);
        text-decoration-thickness: 2px;
        text-underline-offset: 3px;
    }

    /* Key term styling */
    .key-term {
        color: #a78bfa;
        font-weight: 600;
        font-family: 'Space Grotesk', sans-serif;
    }

    /* Enhanced bullets for objectives */
    .objectives-list li::marker {
        color: #06b6d4;
    }

    /* Animated hover for interactive elements */
    .proposito-box:hover {
        border-left-color: rgba(6, 182, 212, 0.8);
        background: rgba(6, 182, 212, 0.08);
        transition: all 0.25s ease;
    }

    /* Enhanced section titles with subtle animation */
    .section-title {
        transition: color 0.2s ease;
    }

    .section-title:hover {
        color: #94a3b8;
    }

    .section-title:hover i {
        color: #22d3ee;
        transform: scale(1.1);
        transition: all 0.2s ease;
    }

    /* Competencia tags with pulse on hover */
    .competencia-tag:hover {
        animation: tagPulse 0.3s ease;
    }

    @keyframes tagPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.03); }
    }

    /* Tech chip glow effect */
    .tech-chip:hover {
        box-shadow: 0 0 12px rgba(6, 182, 212, 0.2);
    }

    /* Connection item hover */
    .connection-item:hover {
        background: rgba(6, 182, 212, 0.18);
        transform: translateX(2px);
        transition: all 0.2s ease;
    }

    /* Recurso link enhanced hover */
    .recurso-link:hover .recurso-icon {
        background: rgba(6, 182, 212, 0.2);
        transform: scale(1.05);
        transition: all 0.2s ease;
    }

    .recurso-link:hover .recurso-info h5 {
        color: #22d3ee;
    }

    /* Progress bar shimmer effect */
    .progress-fill {
        position: relative;
        overflow: hidden;
    }

    .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        animation: shimmer 2.5s infinite;
    }

    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    /* Light mode dynamic typography */
    :global([data-theme="light"]) .highlight {
        background: linear-gradient(90deg, rgba(6, 182, 212, 0.12), rgba(139, 92, 246, 0.08));
        color: #0891b2;
    }

    :global([data-theme="light"]) .underline-accent {
        text-decoration-color: rgba(6, 182, 212, 0.4);
    }

    :global([data-theme="light"]) .key-term {
        color: #7c3aed;
    }

    :global([data-theme="light"]) .section-title:hover {
        color: #475569;
    }

    :global([data-theme="light"]) .connection-item:hover {
        background: rgba(6, 182, 212, 0.12);
    }

    :global([data-theme="light"]) .recurso-link:hover .recurso-info h5 {
        color: #0891b2;
    }

    /* Disable tooltips on touch devices */
    @media (hover: none) {
        [data-tooltip]::before,
        [data-tooltip]::after {
            display: none;
        }
    }

    /* ============================================
       ANIMACIONES DE ENTRADA - Study-Focused
       Usando @keyframes con animation-fill-mode: forwards
       para mantener el estado visible después de la animación
    ============================================ */

    /* Keyframes para fade-in slide-up */
    @keyframes fadeSlideIn {
        from {
            opacity: 0;
            transform: translateY(12px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeScaleIn {
        from {
            opacity: 0;
            transform: scale(0.96);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    @keyframes fadeSlideX {
        from {
            opacity: 0;
            transform: translateX(-8px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Animaciones cuando el drawer está abierto */
    /* Usamos 'both' para aplicar opacity:0 durante el delay Y mantener el estado final */
    .subject-drawer.open .drawer-title-section {
        animation: fadeSlideIn 0.35s ease both;
        animation-delay: 0.08s;
    }

    .subject-drawer.open .drawer-section {
        animation: fadeSlideIn 0.35s ease both;
    }

    /* Staggered delays para cada sección */
    .subject-drawer.open .drawer-section:nth-child(1) { animation-delay: 0.12s; }
    .subject-drawer.open .drawer-section:nth-child(2) { animation-delay: 0.16s; }
    .subject-drawer.open .drawer-section:nth-child(3) { animation-delay: 0.20s; }
    .subject-drawer.open .drawer-section:nth-child(4) { animation-delay: 0.24s; }
    .subject-drawer.open .drawer-section:nth-child(5) { animation-delay: 0.28s; }
    .subject-drawer.open .drawer-section:nth-child(6) { animation-delay: 0.32s; }
    .subject-drawer.open .drawer-section:nth-child(7) { animation-delay: 0.36s; }
    .subject-drawer.open .drawer-section:nth-child(8) { animation-delay: 0.40s; }

    /* Stats bar entrada suave */
    .subject-drawer.open .stats-bar {
        animation: fadeScaleIn 0.3s ease both;
        animation-delay: 0.1s;
    }

    /* Progress bar entrada */
    .subject-drawer.open .bimestre-progress {
        animation: fadeSlideIn 0.3s ease both;
        animation-delay: 0.15s;
    }

    /* Experiencias accordion cards entrada */
    .subject-drawer.open .exp-card {
        animation: fadeSlideX 0.25s ease both;
    }

    .subject-drawer.open .exp-card:nth-child(1) { animation-delay: 0.26s; }
    .subject-drawer.open .exp-card:nth-child(2) { animation-delay: 0.30s; }
    .subject-drawer.open .exp-card:nth-child(3) { animation-delay: 0.34s; }
    .subject-drawer.open .exp-card:nth-child(4) { animation-delay: 0.38s; }

    /* Tech chips entrada */
    .subject-drawer.open .tech-chip {
        animation: fadeScaleIn 0.2s ease both;
    }

    /* Staggered tech chips */
    .subject-drawer.open .tech-chip:nth-child(1) { animation-delay: 0.30s; }
    .subject-drawer.open .tech-chip:nth-child(2) { animation-delay: 0.33s; }
    .subject-drawer.open .tech-chip:nth-child(3) { animation-delay: 0.36s; }
    .subject-drawer.open .tech-chip:nth-child(4) { animation-delay: 0.39s; }
    .subject-drawer.open .tech-chip:nth-child(5) { animation-delay: 0.42s; }
    .subject-drawer.open .tech-chip:nth-child(6) { animation-delay: 0.45s; }
    .subject-drawer.open .tech-chip:nth-child(7) { animation-delay: 0.48s; }
    .subject-drawer.open .tech-chip:nth-child(8) { animation-delay: 0.51s; }

    /* Evaluaciones entrada */
    .subject-drawer.open .eval-item {
        animation: fadeSlideX 0.2s ease both;
    }

    .subject-drawer.open .eval-item:nth-child(1) { animation-delay: 0.34s; }
    .subject-drawer.open .eval-item:nth-child(2) { animation-delay: 0.38s; }
    .subject-drawer.open .eval-item:nth-child(3) { animation-delay: 0.42s; }
    .subject-drawer.open .eval-item:nth-child(4) { animation-delay: 0.46s; }

    /* Connection boxes entrada */
    .subject-drawer.open .connection-box {
        animation: fadeSlideIn 0.25s ease both;
    }

    .subject-drawer.open .prereq-box { animation-delay: 0.38s; }
    .subject-drawer.open .next-box { animation-delay: 0.42s; }

    /* Recursos entrada */
    .subject-drawer.open .recurso-link {
        animation: fadeSlideX 0.2s ease both;
    }

    .subject-drawer.open .recurso-link:nth-child(1) { animation-delay: 0.42s; }
    .subject-drawer.open .recurso-link:nth-child(2) { animation-delay: 0.46s; }
    .subject-drawer.open .recurso-link:nth-child(3) { animation-delay: 0.50s; }

    /* Footer CTA entrada */
    .subject-drawer.open .drawer-footer .drawer-cta {
        animation: fadeSlideIn 0.3s ease both;
        animation-delay: 0.45s;
    }

    /* Reduce motion para usuarios que lo prefieren */
    @media (prefers-reduced-motion: reduce) {
        .subject-drawer.open .drawer-title-section,
        .subject-drawer.open .drawer-section,
        .subject-drawer.open .stats-bar,
        .subject-drawer.open .bimestre-progress,
        .subject-drawer.open .exp-card,
        .subject-drawer.open .tech-chip,
        .subject-drawer.open .eval-item,
        .subject-drawer.open .connection-box,
        .subject-drawer.open .recurso-link,
        .subject-drawer.open .drawer-footer .drawer-cta {
            animation: none;
            opacity: 1;
            transform: none;
        }
    }
</style>

<script define:vars={{ asignaturasData: asignaturas, nombreCortoToIdMap: nombreCortoToId }}>
    // Estado global del drawer
    window.subjectDrawerData = {
        asignaturas: asignaturasData,
        nombreCortoToId: nombreCortoToIdMap,
        currentSubject: null
    };

    // Función para abrir el drawer con una asignatura
    window.openSubjectDrawer = function(subjectId, subjectName = '') {
        const data = window.subjectDrawerData;
        // asignaturas es un objeto Record, no un array - acceder por clave directamente
        const asignatura = data.asignaturas[subjectId];

        if (!asignatura) {
            // Mostrar placeholder para asignaturas sin datos completos
            console.info('Asignatura sin datos completos:', subjectId, '- Mostrando placeholder');
            showPlaceholderContent(subjectId, subjectName);
        } else {
            data.currentSubject = asignatura;
            // Actualizar contenido del drawer
            updateDrawerContent(asignatura);
        }

        // Abrir el drawer
        const drawer = document.getElementById('subject-drawer');
        const overlay = document.getElementById('subject-drawer-overlay');

        drawer?.classList.add('open');
        drawer?.setAttribute('aria-hidden', 'false');
        overlay?.classList.add('active');

        // Prevenir scroll del body
        document.body.style.overflow = 'hidden';
    };

    // Mostrar contenido placeholder para asignaturas sin datos completos
    function showPlaceholderContent(subjectId, subjectName) {
        // Extraer bimestre del ID si es posible
        const bimestreMatch = subjectId.match(/^(\d+)/);
        const bimestre = bimestreMatch ? bimestreMatch[1].padStart(2, '0') : '??';

        // Header
        document.getElementById('drawer-bimestre').textContent = `B${bimestre}`;
        document.getElementById('drawer-codigo').textContent = 'TBD';

        // Título y stats bar placeholders
        document.getElementById('drawer-title').textContent = subjectName || subjectId.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        document.getElementById('drawer-creditos-val').textContent = '--';
        document.getElementById('drawer-horas-teoricas').textContent = '--';
        document.getElementById('drawer-horas-practicas').textContent = '--';
        document.getElementById('drawer-horas-total').textContent = '--';

        // Progress bar placeholder
        const bimestreNum = parseInt(bimestre) || 1;
        const maxBim = bimestreNum <= 10 ? 10 : 17;
        document.getElementById('drawer-progress-fill').style.width = `${(bimestreNum / maxBim) * 100}%`;
        document.getElementById('drawer-progress-text').textContent = `Bimestre ${bimestreNum} de ${maxBim}`;

        // Descripción placeholder
        document.getElementById('drawer-descripcion').textContent = 'Información detallada próximamente. Esta asignatura está siendo documentada.';
        document.getElementById('drawer-proposito').textContent = 'El contenido completo de esta asignatura estará disponible pronto.';

        // Objetivos placeholder
        document.getElementById('drawer-objetivos').innerHTML = '<li>Contenido en desarrollo</li>';

        // Competencias placeholder
        document.getElementById('drawer-competencias').innerHTML = '<span class="competencia-tag">Próximamente</span>';

        // Experiencias placeholder
        document.getElementById('drawer-experiencias').innerHTML = `
            <div class="exp-card">
                <div class="exp-header">
                    <div class="exp-header-left">
                        <span class="exp-number">?</span>
                        <div class="exp-info">
                            <h4>Contenido en desarrollo</h4>
                            <span>Próximamente</span>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Tecnologías placeholder
        document.getElementById('drawer-tecnologias').innerHTML = '<div class="tech-chip"><i class="fas fa-code"></i><span>Por definir</span></div>';

        // Evaluaciones placeholder
        document.getElementById('drawer-evaluaciones').innerHTML = `
            <div class="eval-item">
                <div class="eval-info">
                    <h4>Sistema de evaluación</h4>
                    <span>Por definir</span>
                </div>
                <span class="eval-percent">--%</span>
            </div>
        `;

        // Prerrequisitos y conexiones
        document.getElementById('drawer-prerrequisitos').innerHTML = '<span class="no-prereq">Por definir</span>';
        document.getElementById('drawer-habilita').innerHTML = '<span class="no-prereq">Por definir</span>';

        // Recursos placeholder
        document.getElementById('drawer-recursos').innerHTML = `
            <a href="#" class="recurso-link" style="pointer-events: none;">
                <div class="recurso-icon"><i class="fas fa-hourglass-half"></i></div>
                <div class="recurso-info">
                    <h5>Recursos en desarrollo</h5>
                    <span>Próximamente disponibles</span>
                </div>
            </a>
        `;

        // GitHub link placeholder
        document.getElementById('drawer-github-link').href = '#';
        document.getElementById('drawer-github-link').innerHTML = '<i class="fas fa-hourglass-half"></i> Materiales próximamente';
    }

    // Función para cerrar el drawer
    window.closeSubjectDrawer = function() {
        const drawer = document.getElementById('subject-drawer');
        const overlay = document.getElementById('subject-drawer-overlay');

        drawer?.classList.remove('open');
        drawer?.setAttribute('aria-hidden', 'true');
        overlay?.classList.remove('active');

        // Restaurar scroll del body
        document.body.style.overflow = '';
    };

    // Función para actualizar el contenido del drawer
    function updateDrawerContent(asignatura) {
        // Header
        document.getElementById('drawer-bimestre').textContent = `B${asignatura.bimestre.toString().padStart(2, '0')}`;
        document.getElementById('drawer-codigo').textContent = asignatura.codigo;

        // Título y stats bar
        document.getElementById('drawer-title').textContent = asignatura.nombre;
        document.getElementById('drawer-creditos-val').textContent = asignatura.creditos;
        document.getElementById('drawer-horas-teoricas').textContent = asignatura.horasTeoricas;
        document.getElementById('drawer-horas-practicas').textContent = asignatura.horasPracticas;
        const horasTotales = asignatura.horasTeoricas + asignatura.horasPracticas;
        document.getElementById('drawer-horas-total').textContent = horasTotales;

        // Progress bar del bimestre
        const bimestre = asignatura.bimestre;
        const maxBimestre = bimestre <= 10 ? 10 : 17;
        const progressPercent = (bimestre / maxBimestre) * 100;
        document.getElementById('drawer-progress-fill').style.width = `${progressPercent}%`;
        document.getElementById('drawer-progress-text').textContent = `Bimestre ${bimestre} de ${maxBimestre}`;

        // Descripción y propósito
        document.getElementById('drawer-descripcion').textContent = asignatura.descripcion;
        document.getElementById('drawer-proposito').textContent = asignatura.proposito;

        // Objetivos
        const objetivosHtml = asignatura.objetivos.map(obj => `<li>${obj}</li>`).join('');
        document.getElementById('drawer-objetivos').innerHTML = objetivosHtml;

        // Competencias
        const competenciasHtml = asignatura.competencias.map(comp =>
            `<span class="competencia-tag">${comp}</span>`
        ).join('');
        document.getElementById('drawer-competencias').innerHTML = competenciasHtml;

        // Experiencias - usando onclick inline para máxima compatibilidad
        const experienciasHtml = asignatura.experiencias.map((exp, index) => `
            <div class="exp-card" id="exp-card-${index}">
                <div class="exp-header" onclick="this.parentElement.classList.toggle('expanded')" style="cursor:pointer">
                    <div class="exp-header-left">
                        <span class="exp-number">${exp.numero}</span>
                        <div class="exp-info">
                            <h4>${exp.titulo}</h4>
                            <span>Experiencia ${exp.numero} · ${exp.semanas}</span>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down exp-toggle"></i>
                </div>
                <div class="exp-content">
                    <div class="exp-content-inner">
                        <p class="exp-description">${exp.descripcion}</p>
                        <div class="exp-separator"></div>
                        <div class="exp-subsection">
                            <h5><i class="fas fa-book"></i> Contenidos</h5>
                            <ul>
                                ${exp.contenidos.map(c => `<li>${c}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="exp-separator"></div>
                        <div class="exp-subsection">
                            <h5><i class="fas fa-tasks"></i> Actividades</h5>
                            <ul>
                                ${exp.actividades.map(a => `<li>${a}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
        document.getElementById('drawer-experiencias').innerHTML = experienciasHtml;

        // Tecnologías
        const techHtml = asignatura.tecnologias.map(tech => {
            let iconHtml = '';
            if (tech.iconType === 'devicon') {
                iconHtml = `<i class="devicon-${tech.icon}"></i>`;
            } else if (tech.iconType === 'fontawesome') {
                iconHtml = `<i class="${tech.icon}"></i>`;
            } else if (tech.iconType === 'simple') {
                iconHtml = `<img src="https://cdn.simpleicons.org/${tech.icon}" alt="${tech.nombre}">`;
            }
            return `<div class="tech-chip">${iconHtml}<span>${tech.nombre}</span></div>`;
        }).join('');
        document.getElementById('drawer-tecnologias').innerHTML = techHtml;

        // Evaluaciones
        const evalHtml = asignatura.evaluaciones.map(ev => {
            const tipoClass = ev.tipo.toLowerCase().includes('formativa') ? 'formativa' :
                             ev.tipo.toLowerCase().includes('sumativa') ? 'sumativa' : 'prueba';
            return `
                <div class="eval-item ${tipoClass}">
                    <div class="eval-info">
                        <h4>${ev.nombre}</h4>
                        <span>${ev.tipo}</span>
                    </div>
                    <span class="eval-percent">${ev.ponderacion}%</span>
                </div>
            `;
        }).join('');
        document.getElementById('drawer-evaluaciones').innerHTML = evalHtml;

        // Prerrequisitos
        const prereqHtml = asignatura.prerrequisitos.length > 0
            ? asignatura.prerrequisitos.map(p => `<span class="connection-item">${p}</span>`).join('')
            : '<span class="no-prereq">Sin prerrequisitos</span>';
        document.getElementById('drawer-prerrequisitos').innerHTML = prereqHtml;

        // Conexiones (habilita para)
        const conexHtml = asignatura.conexiones.length > 0
            ? asignatura.conexiones.map(c => `<span class="connection-item">${c}</span>`).join('')
            : '<span class="no-prereq">-</span>';
        document.getElementById('drawer-habilita').innerHTML = conexHtml;

        // Recursos
        const recursosHtml = asignatura.recursos.map(rec => {
            const iconClass = rec.tipo === 'GitHub' ? 'fab fa-github' :
                             rec.tipo === 'Documentación' ? 'fas fa-book' :
                             rec.tipo === 'Tutorial' ? 'fas fa-play-circle' : 'fas fa-link';
            return `
                <a href="${rec.url}" target="_blank" rel="noopener" class="recurso-link">
                    <div class="recurso-icon"><i class="${iconClass}"></i></div>
                    <div class="recurso-info">
                        <h5>${rec.nombre}</h5>
                        <span>${rec.tipo}</span>
                    </div>
                </a>
            `;
        }).join('');
        document.getElementById('drawer-recursos').innerHTML = recursosHtml;

        // ============================================
        // NUEVAS SECCIONES PREMIUM - Contenido Enriquecido
        // ============================================

        // Indicadores Premium (Dificultad y Horas de Estudio)
        const indicatorsSection = document.getElementById('drawer-indicators-section');
        const keywordsSection = document.getElementById('drawer-keywords-section');

        if (asignatura.dificultad || asignatura.horasEstudioSemanal) {
            indicatorsSection.style.display = 'block';

            // Dificultad
            if (asignatura.dificultad) {
                const diffCard = document.getElementById('drawer-difficulty-card');
                const diffLabel = {
                    'basico': 'Básico',
                    'intermedio': 'Intermedio',
                    'avanzado': 'Avanzado',
                    'experto': 'Experto'
                };
                const diffDots = {
                    'basico': 1,
                    'intermedio': 2,
                    'avanzado': 3,
                    'experto': 4
                };

                document.getElementById('drawer-dificultad').textContent = diffLabel[asignatura.dificultad] || 'N/A';
                diffCard.setAttribute('data-level', asignatura.dificultad);

                // Actualizar dots de dificultad
                const dotsHtml = Array.from({length: 4}, (_, i) =>
                    `<span class="diff-dot ${i < diffDots[asignatura.dificultad] ? 'active' : ''}"></span>`
                ).join('');
                document.getElementById('drawer-difficulty-bar').innerHTML = dotsHtml;
            }

            // Horas de estudio semanal
            if (asignatura.horasEstudioSemanal) {
                document.getElementById('drawer-horas-estudio').textContent = asignatura.horasEstudioSemanal;
            }
        } else {
            indicatorsSection.style.display = 'none';
        }

        // Palabras Clave
        if (asignatura.palabrasClave && asignatura.palabrasClave.length > 0) {
            keywordsSection.style.display = 'block';
            const keywordsHtml = asignatura.palabrasClave.map(kw =>
                `<span class="keyword-tag">${kw}</span>`
            ).join('');
            document.getElementById('drawer-palabras-clave').innerHTML = keywordsHtml;
        } else {
            keywordsSection.style.display = 'none';
        }

        // Tips de Estudio
        const tipsSection = document.getElementById('drawer-tips-section');
        if (asignatura.tips && asignatura.tips.length > 0) {
            tipsSection.style.display = 'block';
            const tipsHtml = asignatura.tips.map(tip => `
                <div class="tip-item">
                    <div class="tip-icon"><i class="fas fa-lightbulb"></i></div>
                    <span class="tip-text">${tip}</span>
                </div>
            `).join('');
            document.getElementById('drawer-tips').innerHTML = tipsHtml;
        } else {
            tipsSection.style.display = 'none';
        }

        // Proyectos Sugeridos
        const projectsSection = document.getElementById('drawer-projects-section');
        if (asignatura.proyectosSugeridos && asignatura.proyectosSugeridos.length > 0) {
            projectsSection.style.display = 'block';
            const projectsHtml = asignatura.proyectosSugeridos.map(proj => `
                <div class="project-card">
                    <div class="project-header">
                        <span class="project-name"><i class="fas fa-code-branch"></i> ${proj.nombre}</span>
                        <span class="project-level ${proj.nivel}">${proj.nivel}</span>
                    </div>
                    <p class="project-desc">${proj.descripcion}</p>
                    ${proj.duracionEstimada ? `<span class="project-duration"><i class="fas fa-clock"></i> ${proj.duracionEstimada}</span>` : ''}
                </div>
            `).join('');
            document.getElementById('drawer-proyectos').innerHTML = projectsHtml;
        } else {
            projectsSection.style.display = 'none';
        }

        // Relevancia Profesional
        const relevanceSection = document.getElementById('drawer-relevance-section');
        if (asignatura.relevanciaProfesional && asignatura.relevanciaProfesional.length > 0) {
            relevanceSection.style.display = 'block';
            const relevanceHtml = asignatura.relevanciaProfesional.map(rel => `
                <div class="relevance-item" data-importance="${rel.importancia}">
                    <div class="relevance-icon"><i class="fas fa-user-tie"></i></div>
                    <div class="relevance-info">
                        <span class="relevance-role">${rel.rol}</span>
                        ${rel.descripcion ? `<span class="relevance-desc">${rel.descripcion}</span>` : ''}
                    </div>
                    <span class="relevance-badge ${rel.importancia}">${rel.importancia}</span>
                </div>
            `).join('');
            document.getElementById('drawer-relevancia').innerHTML = relevanceHtml;
        } else {
            relevanceSection.style.display = 'none';
        }

        // Link de GitHub en footer
        const bimestreNum = asignatura.bimestre.toString().padStart(2, '0');
        document.getElementById('drawer-github-link').href =
            `https://github.com/fos-duoc/Analista-Programador-Computacional-DuocUC/tree/main/Bimestre-${bimestreNum}%20-%20`;
    }

</script>

<!-- Script inline separado para event listeners - se ejecuta en cada View Transition -->
<script is:inline>
    (function initSubjectDrawerEvents() {
        // Toggle de experiencias - Usar múltiples estrategias para máxima compatibilidad

        // Estrategia 1: Event delegation en document con capture
        if (!window._expToggleHandler) {
            window._expToggleHandler = function(e) {
                const header = e.target.closest('[data-exp-toggle]');
                if (header) {
                    e.preventDefault();
                    e.stopPropagation();
                    const card = header.closest('.exp-card');
                    if (card) {
                        card.classList.toggle('expanded');
                        console.log('[SubjectDrawer] Toggled exp-card:', card.id, 'expanded:', card.classList.contains('expanded'));
                    }
                }
            };
            document.addEventListener('click', window._expToggleHandler, true);
        }

        // Estrategia 2: Función global para toggle manual
        window.toggleExperiencia = function(index) {
            const card = document.getElementById('exp-card-' + index);
            if (card) {
                card.classList.toggle('expanded');
                console.log('[SubjectDrawer] Manual toggle exp-card-' + index, 'expanded:', card.classList.contains('expanded'));
            }
        };

        // Estrategia 3: Attach directo a los headers existentes
        function attachExpToggleHandlers() {
            const headers = document.querySelectorAll('[data-exp-toggle]');
            headers.forEach(header => {
                // Evitar duplicados usando data attribute
                if (!header.hasAttribute('data-toggle-attached')) {
                    header.setAttribute('data-toggle-attached', 'true');
                    header.style.cursor = 'pointer';
                    header.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const card = this.closest('.exp-card');
                        if (card) {
                            card.classList.toggle('expanded');
                            console.log('[SubjectDrawer] Direct handler toggled:', card.id);
                        }
                    });
                }
            });
            if (headers.length > 0) {
                console.log('[SubjectDrawer] Attached direct handlers to', headers.length, 'exp-headers');
            }
        }

        // Ejecutar attach después de un pequeño delay para asegurar que el DOM está listo
        setTimeout(attachExpToggleHandlers, 100);

        // También ejecutar cuando se actualiza el contenido del drawer
        const originalUpdateDrawerContent = window.updateDrawerContent;
        if (typeof originalUpdateDrawerContent === 'function') {
            window.updateDrawerContent = function(...args) {
                originalUpdateDrawerContent.apply(this, args);
                setTimeout(attachExpToggleHandlers, 50);
            };
        }

        function attachDrawerEvents() {
            const closeBtn = document.getElementById('drawer-close-btn');
            const overlay = document.getElementById('subject-drawer-overlay');
            const widthToggleBtn = document.getElementById('drawer-width-toggle');
            const drawer = document.getElementById('subject-drawer');

            // Usar onclick directo para evitar duplicados
            if (closeBtn) {
                closeBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (window.closeSubjectDrawer) {
                        window.closeSubjectDrawer();
                    }
                };
            }

            if (overlay) {
                overlay.onclick = function(e) {
                    e.preventDefault();
                    if (window.closeSubjectDrawer) {
                        window.closeSubjectDrawer();
                    }
                };
            }

            // Width toggle button
            if (widthToggleBtn && drawer) {
                widthToggleBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    drawer.classList.toggle('expanded-width');
                    widthToggleBtn.classList.toggle('active');
                };
            }
        }

        // Escape key - solo una vez
        if (!window._subjectDrawerEventsInitialized) {
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && window.closeSubjectDrawer) {
                    window.closeSubjectDrawer();
                }
            });
            window._subjectDrawerEventsInitialized = true;
        }

        // Ejecutar inmediatamente
        attachDrawerEvents();

        // Re-attach después de View Transitions
        document.addEventListener('astro:page-load', attachDrawerEvents);
    })();
</script>
