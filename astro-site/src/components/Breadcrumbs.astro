---
/**
 * Breadcrumbs Component - UX Navigation Pattern
 * Based on: Google Material Design, AWS Console, Microsoft Docs
 *
 * WCAG 2.2 Compliant:
 * - Uses nav element with aria-label
 * - Uses ordered list for semantic structure
 * - Current page marked with aria-current="page"
 * - Proper contrast ratios
 *
 * @see https://www.w3.org/WAI/ARIA/apg/patterns/breadcrumb/
 */

interface BreadcrumbItem {
    label: string;
    href?: string;
    icon?: string;
}

interface Props {
    items?: BreadcrumbItem[];
    showHome?: boolean;
    separator?: 'chevron' | 'slash' | 'arrow';
}

const {
    items = [],
    showHome = true,
    separator = 'chevron'
} = Astro.props;

const baseUrl = import.meta.env.BASE_URL || '/Analista-Programador-Computacional-DuocUC';

// Default breadcrumb items based on current page
const currentPath = Astro.url.pathname;
const pathSegments = currentPath.replace(baseUrl, '').split('/').filter(Boolean);

// Map path segments to readable labels
const pathLabels: Record<string, { label: string; icon: string }> = {
    'inicio': { label: 'Inicio', icon: 'fa-home' },
    'stack': { label: 'Stack Tecnológico', icon: 'fa-layer-group' },
    'arquitectura': { label: 'Arquitectura', icon: 'fa-sitemap' },
    'recursos': { label: 'Recursos', icon: 'fa-book-reader' },
    'proyectos': { label: 'Proyectos', icon: 'fa-folder-open' },
    'proyectos-estudio': { label: 'Proyectos de Estudio', icon: 'fa-graduation-cap' },
    'proyectos-trabajo': { label: 'Proyectos Profesionales', icon: 'fa-briefcase' },
};

// Auto-generate breadcrumbs if not provided
const breadcrumbs: BreadcrumbItem[] = items.length > 0 ? items : [
    ...(showHome ? [{
        label: 'Inicio',
        href: `${baseUrl}/inicio/`,
        icon: 'fa-home'
    }] : []),
    ...pathSegments.map((segment, index) => {
        const info = pathLabels[segment] || {
            label: segment.charAt(0).toUpperCase() + segment.slice(1).replace(/-/g, ' '),
            icon: 'fa-file'
        };
        const isLast = index === pathSegments.length - 1;
        return {
            label: info.label,
            href: isLast ? undefined : `${baseUrl}/${pathSegments.slice(0, index + 1).join('/')}/`,
            icon: info.icon
        };
    })
];

// Separator icons
const separators = {
    chevron: 'fa-chevron-right',
    slash: 'fa-slash',
    arrow: 'fa-arrow-right'
};
---

<nav
    class="breadcrumbs"
    aria-label="Navegación de migas de pan"
    itemscope
    itemtype="https://schema.org/BreadcrumbList"
>
    <ol class="breadcrumbs-list">
        {breadcrumbs.map((item, index) => {
            const isLast = index === breadcrumbs.length - 1;
            const position = index + 1;

            return (
                <li
                    class={`breadcrumb-item ${isLast ? 'current' : ''}`}
                    itemprop="itemListElement"
                    itemscope
                    itemtype="https://schema.org/ListItem"
                >
                    {item.href ? (
                        <a
                            href={item.href}
                            class="breadcrumb-link"
                            itemprop="item"
                        >
                            {item.icon && <i class={`fas ${item.icon} breadcrumb-icon`}></i>}
                            <span itemprop="name">{item.label}</span>
                        </a>
                    ) : (
                        <span
                            class="breadcrumb-current"
                            aria-current="page"
                            itemprop="name"
                        >
                            {item.icon && <i class={`fas ${item.icon} breadcrumb-icon`}></i>}
                            {item.label}
                        </span>
                    )}
                    <meta itemprop="position" content={String(position)} />

                    {!isLast && (
                        <span class="breadcrumb-separator" aria-hidden="true">
                            <i class={`fas ${separators[separator]}`}></i>
                        </span>
                    )}
                </li>
            );
        })}
    </ol>
</nav>

<style>
    .breadcrumbs {
        padding: 0.75rem 1.5rem;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 64px; /* Below header */
        z-index: 90;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .breadcrumbs-list {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.5rem;
        list-style: none;
        margin: 0;
        padding: 0;
        max-width: 1400px;
        margin: 0 auto;
        font-size: 0.875rem;
    }

    .breadcrumb-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .breadcrumb-link {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        color: var(--text-secondary);
        text-decoration: none;
        padding: 0.25rem 0.5rem;
        border-radius: var(--radius-sm);
        transition: all 0.2s ease;
    }

    .breadcrumb-link:hover {
        color: var(--accent-primary);
        background: var(--bg-hover);
    }

    .breadcrumb-link:focus-visible {
        outline: 2px solid var(--accent-primary);
        outline-offset: 2px;
    }

    .breadcrumb-icon {
        font-size: 0.75rem;
        opacity: 0.7;
    }

    .breadcrumb-current {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        color: var(--text-primary);
        font-weight: 600;
        padding: 0.25rem 0.5rem;
        background: var(--accent-gradient-soft);
        border-radius: var(--radius-sm);
    }

    .breadcrumb-current .breadcrumb-icon {
        color: var(--accent-primary);
        opacity: 1;
    }

    .breadcrumb-separator {
        color: var(--text-muted);
        font-size: 0.625rem;
        margin: 0 0.125rem;
    }

    /* Truncate long breadcrumbs on mobile */
    @media (max-width: 768px) {
        .breadcrumbs {
            padding: 0.5rem 1rem;
        }

        .breadcrumbs-list {
            font-size: 0.8125rem;
        }

        .breadcrumb-item:not(:last-child):not(:first-child) {
            display: none;
        }

        /* Show ellipsis when items are hidden */
        .breadcrumb-item:first-child + .breadcrumb-item:not(:last-child)::before {
            content: '...';
            color: var(--text-muted);
            margin-right: 0.5rem;
        }
    }

    /* Light mode */
    :global([data-theme="light"]) .breadcrumbs {
        background: rgba(248, 250, 252, 0.95);
        border-color: var(--border-color);
    }

    :global([data-theme="light"]) .breadcrumb-link {
        color: #475569;
    }

    :global([data-theme="light"]) .breadcrumb-link:hover {
        color: #0891b2;
        background: rgba(8, 145, 178, 0.08);
    }

    :global([data-theme="light"]) .breadcrumb-current {
        color: #0f172a;
        background: rgba(8, 145, 178, 0.1);
    }

    :global([data-theme="light"]) .breadcrumb-separator {
        color: #94a3b8;
    }
</style>
