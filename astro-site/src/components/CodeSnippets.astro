---
// CodeSnippets.astro - Sección de código estilo Notepad++/editor
// Snippets útiles organizados por lenguaje/tema

const codeCategories = [
    {
        id: "python",
        name: "Python",
        icon: "devicon-python-plain colored",
        color: "#3776AB",
        snippets: [
            {
                title: "Conexión a PostgreSQL",
                description: "Conectar a base de datos PostgreSQL con psycopg2",
                code: `import psycopg2
from psycopg2 import sql

# Conexión a la base de datos
conn = psycopg2.connect(
    host="localhost",
    database="mi_base_datos",
    user="usuario",
    password="password"
)

# Crear cursor
cursor = conn.cursor()

# Ejecutar query
cursor.execute("SELECT * FROM usuarios WHERE activo = %s", (True,))
resultados = cursor.fetchall()

# Cerrar conexión
cursor.close()
conn.close()`,
                tags: ["database", "postgresql", "psycopg2"]
            },
            {
                title: "API REST con FastAPI",
                description: "Endpoint básico con FastAPI",
                code: `from fastapi import FastAPI, HTTPException
from pydantic import BaseModel

app = FastAPI()

class Usuario(BaseModel):
    nombre: str
    email: str
    edad: int | None = None

@app.get("/usuarios/{usuario_id}")
async def obtener_usuario(usuario_id: int):
    # Lógica para buscar usuario
    return {"id": usuario_id, "nombre": "Juan"}

@app.post("/usuarios/")
async def crear_usuario(usuario: Usuario):
    # Lógica para crear usuario
    return {"mensaje": "Usuario creado", "data": usuario}`,
                tags: ["api", "fastapi", "rest"]
            }
        ]
    },
    {
        id: "java",
        name: "Java",
        icon: "devicon-java-plain colored",
        color: "#ED8B00",
        snippets: [
            {
                title: "Spring Boot Controller",
                description: "Controller REST básico con Spring Boot",
                code: `@RestController
@RequestMapping("/api/usuarios")
public class UsuarioController {

    @Autowired
    private UsuarioService usuarioService;

    @GetMapping("/{id}")
    public ResponseEntity<Usuario> obtenerUsuario(@PathVariable Long id) {
        Usuario usuario = usuarioService.buscarPorId(id);
        if (usuario == null) {
            return ResponseEntity.notFound().build();
        }
        return ResponseEntity.ok(usuario);
    }

    @PostMapping
    public ResponseEntity<Usuario> crearUsuario(@Valid @RequestBody Usuario usuario) {
        Usuario nuevo = usuarioService.guardar(usuario);
        return ResponseEntity.status(HttpStatus.CREATED).body(nuevo);
    }
}`,
                tags: ["spring", "rest", "controller"]
            },
            {
                title: "JPA Repository",
                description: "Interface de repositorio con Spring Data JPA",
                code: `@Repository
public interface UsuarioRepository extends JpaRepository<Usuario, Long> {

    // Query methods
    Optional<Usuario> findByEmail(String email);

    List<Usuario> findByActivoTrue();

    // Query personalizada
    @Query("SELECT u FROM Usuario u WHERE u.nombre LIKE %:nombre%")
    List<Usuario> buscarPorNombre(@Param("nombre") String nombre);

    // Query nativa
    @Query(value = "SELECT * FROM usuarios WHERE created_at > :fecha",
           nativeQuery = true)
    List<Usuario> findRecientes(@Param("fecha") LocalDateTime fecha);
}`,
                tags: ["jpa", "repository", "database"]
            }
        ]
    },
    {
        id: "sql",
        name: "SQL",
        icon: "devicon-postgresql-plain colored",
        color: "#336791",
        snippets: [
            {
                title: "Crear tabla con constraints",
                description: "DDL para crear tabla con claves y restricciones",
                code: `CREATE TABLE usuarios (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    fecha_nacimiento DATE,
    activo BOOLEAN DEFAULT true,
    rol_id INTEGER REFERENCES roles(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT chk_email CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')
);

-- Índices para mejorar rendimiento
CREATE INDEX idx_usuarios_email ON usuarios(email);
CREATE INDEX idx_usuarios_rol ON usuarios(rol_id);`,
                tags: ["ddl", "create", "constraints"]
            },
            {
                title: "Query con JOIN y agregación",
                description: "Consulta compleja con múltiples JOINs",
                code: `SELECT
    d.nombre AS departamento,
    COUNT(e.id) AS total_empleados,
    AVG(e.salario) AS salario_promedio,
    MAX(e.salario) AS salario_maximo,
    MIN(e.fecha_contratacion) AS primera_contratacion
FROM departamentos d
LEFT JOIN empleados e ON d.id = e.departamento_id
WHERE e.activo = true
    AND e.fecha_contratacion >= '2023-01-01'
GROUP BY d.id, d.nombre
HAVING COUNT(e.id) > 5
ORDER BY total_empleados DESC
LIMIT 10;`,
                tags: ["join", "agregación", "select"]
            }
        ]
    },
    {
        id: "javascript",
        name: "JavaScript",
        icon: "devicon-javascript-plain colored",
        color: "#F7DF1E",
        snippets: [
            {
                title: "Fetch API con async/await",
                description: "Consumir API REST con manejo de errores",
                code: `async function fetchUsuarios() {
    try {
        const response = await fetch('https://api.ejemplo.com/usuarios', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': \`Bearer \${token}\`
            }
        });

        if (!response.ok) {
            throw new Error(\`HTTP error! status: \${response.status}\`);
        }

        const data = await response.json();
        return data;

    } catch (error) {
        console.error('Error fetching usuarios:', error);
        throw error;
    }
}

// Uso con POST
async function crearUsuario(usuario) {
    const response = await fetch('https://api.ejemplo.com/usuarios', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(usuario)
    });
    return response.json();
}`,
                tags: ["fetch", "async", "api"]
            },
            {
                title: "React Hook personalizado",
                description: "Custom hook para manejo de datos",
                code: `import { useState, useEffect } from 'react';

function useFetch(url) {
    const [data, setData] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        const abortController = new AbortController();

        async function fetchData() {
            try {
                setLoading(true);
                const response = await fetch(url, {
                    signal: abortController.signal
                });
                const json = await response.json();
                setData(json);
                setError(null);
            } catch (err) {
                if (err.name !== 'AbortError') {
                    setError(err.message);
                }
            } finally {
                setLoading(false);
            }
        }

        fetchData();
        return () => abortController.abort();
    }, [url]);

    return { data, loading, error };
}`,
                tags: ["react", "hooks", "custom"]
            }
        ]
    }
];
---

<section id="code-snippets" class="snippets-section">
    <div class="snippets-container">
        <!-- Header estilo Notepad++ -->
        <div class="snippets-header" data-aos="fade-up">
            <div class="editor-titlebar">
                <div class="editor-buttons">
                    <span class="btn-close"></span>
                    <span class="btn-minimize"></span>
                    <span class="btn-maximize"></span>
                </div>
                <div class="editor-title">
                    <i class="fas fa-file-code"></i>
                    <span>Code Snippets - Biblioteca de Código</span>
                </div>
                <div class="editor-menu">
                    <span>File</span>
                    <span>Edit</span>
                    <span>Search</span>
                    <span>View</span>
                </div>
            </div>
        </div>

        <!-- Language Tabs -->
        <div class="language-tabs" data-aos="fade-up" data-aos-delay="100">
            {codeCategories.map((cat, index) => (
                <button
                    class={`lang-tab ${index === 0 ? 'active' : ''}`}
                    data-lang={cat.id}
                    style={`--lang-color: ${cat.color}`}
                >
                    <i class={cat.icon}></i>
                    <span>{cat.name}</span>
                </button>
            ))}
        </div>

        <!-- Snippets Content -->
        <div class="snippets-content">
            {codeCategories.map((cat, catIndex) => (
                <div class={`lang-content ${catIndex === 0 ? 'active' : ''}`} id={`content-${cat.id}`}>
                    <div class="snippets-grid">
                        {cat.snippets.map((snippet, snippetIndex) => (
                            <div class="snippet-card glass-card" data-aos="zoom-in" data-aos-delay={snippetIndex * 100}>
                                <div class="snippet-header">
                                    <div class="snippet-info">
                                        <h4>{snippet.title}</h4>
                                        <p>{snippet.description}</p>
                                    </div>
                                    <button class="copy-btn" data-code={snippet.code} title="Copiar código">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>

                                <div class="code-block">
                                    <div class="code-header">
                                        <span class="file-icon"><i class="fas fa-file-code"></i></span>
                                        <span class="file-name">{snippet.title.toLowerCase().replace(/\s+/g, '_')}.{cat.id === 'sql' ? 'sql' : cat.id === 'javascript' ? 'js' : cat.id}</span>
                                        <div class="line-count">{snippet.code.split('\n').length} líneas</div>
                                    </div>
                                    <div class="code-content">
                                        <div class="line-numbers">
                                            {snippet.code.split('\n').map((_, i) => (
                                                <span>{i + 1}</span>
                                            ))}
                                        </div>
                                        <pre><code class={`language-${cat.id}`}>{snippet.code}</code></pre>
                                    </div>
                                </div>

                                <div class="snippet-tags">
                                    {snippet.tags.map(tag => (
                                        <span class="tag">{tag}</span>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            ))}
        </div>

        <!-- Footer status bar -->
        <div class="editor-statusbar">
            <div class="status-left">
                <span><i class="fas fa-code-branch"></i> main</span>
                <span><i class="fas fa-check-circle"></i> UTF-8</span>
            </div>
            <div class="status-right">
                <span>Snippets: {codeCategories.reduce((acc, cat) => acc + cat.snippets.length, 0)}</span>
                <span>Languages: {codeCategories.length}</span>
            </div>
        </div>
    </div>
</section>

<style>
    .snippets-section {
        padding: 4rem 2rem;
        max-width: 1400px;
        margin: 0 auto;
    }

    .snippets-container {
        background: #1e1e1e;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    /* Editor Titlebar */
    .editor-titlebar {
        display: flex;
        align-items: center;
        background: linear-gradient(180deg, #3c3c3c, #2d2d2d);
        padding: 0.5rem 1rem;
        border-bottom: 1px solid #1a1a1a;
    }

    .editor-buttons {
        display: flex;
        gap: 8px;
    }

    .editor-buttons span {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .btn-close { background: #ff5f57; }
    .btn-minimize { background: #febc2e; }
    .btn-maximize { background: #28c840; }

    .editor-title {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        color: #ccc;
        font-size: 0.85rem;
        font-family: 'JetBrains Mono', monospace;
    }

    .editor-title i {
        color: #6d9eff;
    }

    .editor-menu {
        display: flex;
        gap: 1rem;
        font-size: 0.75rem;
        color: #888;
    }

    .editor-menu span:hover {
        color: #fff;
        cursor: pointer;
    }

    /* Language Tabs */
    .language-tabs {
        display: flex;
        background: #252526;
        border-bottom: 1px solid #3c3c3c;
        overflow-x: auto;
    }

    .lang-tab {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.25rem;
        background: transparent;
        border: none;
        color: #888;
        font-size: 0.85rem;
        font-family: 'JetBrains Mono', monospace;
        cursor: pointer;
        transition: all 0.2s ease;
        border-bottom: 2px solid transparent;
        white-space: nowrap;
    }

    .lang-tab:hover {
        background: rgba(255, 255, 255, 0.05);
        color: #ccc;
    }

    .lang-tab.active {
        background: #1e1e1e;
        color: #fff;
        border-bottom-color: var(--lang-color);
    }

    .lang-tab i {
        font-size: 1.1rem;
    }

    /* Snippets Content */
    .snippets-content {
        padding: 1.5rem;
        background: #1e1e1e;
        min-height: 500px;
    }

    .lang-content {
        display: none;
    }

    .lang-content.active {
        display: block;
    }

    .snippets-grid {
        display: grid;
        gap: 1.5rem;
    }

    /* Snippet Card */
    .snippet-card {
        background: #252526 !important;
        border: 1px solid #3c3c3c !important;
        border-radius: 8px;
        overflow: hidden;
    }

    .snippet-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 1rem 1rem 0.75rem;
        border-bottom: 1px solid #3c3c3c;
    }

    .snippet-info h4 {
        font-size: 1rem;
        font-weight: 600;
        color: #e0e0e0;
        margin-bottom: 0.25rem;
    }

    .snippet-info p {
        font-size: 0.8rem;
        color: #888;
    }

    .copy-btn {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: #888;
        padding: 0.5rem;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .copy-btn:hover {
        background: rgba(0, 212, 255, 0.2);
        color: #00d4ff;
    }

    .copy-btn.copied {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
    }

    /* Code Block */
    .code-block {
        background: #1e1e1e;
    }

    .code-header {
        display: flex;
        align-items: center;
        padding: 0.5rem 1rem;
        background: #2d2d2d;
        border-bottom: 1px solid #3c3c3c;
        font-size: 0.75rem;
        color: #888;
        gap: 0.5rem;
    }

    .file-icon i {
        color: #6d9eff;
    }

    .file-name {
        flex: 1;
        font-family: 'JetBrains Mono', monospace;
    }

    .line-count {
        font-size: 0.7rem;
        color: #666;
    }

    .code-content {
        display: flex;
        overflow-x: auto;
        max-height: 400px;
        overflow-y: auto;
    }

    .line-numbers {
        display: flex;
        flex-direction: column;
        padding: 1rem 0.75rem;
        background: #252526;
        border-right: 1px solid #3c3c3c;
        text-align: right;
        user-select: none;
        position: sticky;
        left: 0;
    }

    .line-numbers span {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.75rem;
        color: #6e7681;
        line-height: 1.5;
    }

    .code-content pre {
        margin: 0;
        padding: 1rem;
        flex: 1;
        overflow-x: auto;
    }

    .code-content code {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.8rem;
        line-height: 1.5;
        color: #d4d4d4;
        white-space: pre;
    }

    /* Syntax highlighting básico */
    .code-content code {
        color: #d4d4d4;
    }

    /* Tags */
    .snippet-tags {
        display: flex;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        flex-wrap: wrap;
    }

    .tag {
        padding: 0.2rem 0.6rem;
        background: rgba(0, 212, 255, 0.1);
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 12px;
        font-size: 0.7rem;
        color: #00d4ff;
        font-family: 'JetBrains Mono', monospace;
    }

    /* Status Bar */
    .editor-statusbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 1rem;
        background: #007acc;
        font-size: 0.75rem;
        color: white;
        font-family: 'JetBrains Mono', monospace;
    }

    .status-left, .status-right {
        display: flex;
        gap: 1rem;
    }

    .editor-statusbar i {
        margin-right: 0.3rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .editor-menu {
            display: none;
        }

        .editor-title {
            font-size: 0.75rem;
        }

        .lang-tab {
            padding: 0.5rem 1rem;
        }

        .lang-tab span {
            display: none;
        }

        .snippets-content {
            padding: 1rem;
        }
    }

    /* Scrollbar */
    .code-content::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }

    .code-content::-webkit-scrollbar-track {
        background: #1e1e1e;
    }

    .code-content::-webkit-scrollbar-thumb {
        background: #3c3c3c;
        border-radius: 5px;
    }

    .code-content::-webkit-scrollbar-thumb:hover {
        background: #4c4c4c;
    }
</style>

<script is:inline>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching
        const tabs = document.querySelectorAll('.lang-tab');
        const contents = document.querySelectorAll('.lang-content');

        tabs.forEach(function(tab) {
            tab.addEventListener('click', function() {
                const lang = this.dataset.lang;

                // Update tabs
                tabs.forEach(function(t) { t.classList.remove('active'); });
                this.classList.add('active');

                // Update content
                contents.forEach(function(c) { c.classList.remove('active'); });
                document.getElementById('content-' + lang).classList.add('active');
            });
        });

        // Copy functionality
        const copyBtns = document.querySelectorAll('.copy-btn');

        copyBtns.forEach(function(btn) {
            btn.addEventListener('click', function() {
                const code = this.dataset.code;

                navigator.clipboard.writeText(code).then(function() {
                    btn.classList.add('copied');
                    btn.innerHTML = '<i class="fas fa-check"></i>';

                    setTimeout(function() {
                        btn.classList.remove('copied');
                        btn.innerHTML = '<i class="fas fa-copy"></i>';
                    }, 2000);
                });
            });
        });
    });
</script>
