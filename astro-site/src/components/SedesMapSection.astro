---
// Sedes DuocUC con Escuela de Informática - Mapa Interactivo
const sedes = [
    {
        name: "San Joaquín",
        address: "Av. Vicuña Mackenna 4917",
        comuna: "San Joaquín",
        region: "Metropolitana",
        lat: -33.4969,
        lng: -70.6147,
        carreras: ["Analista Programador", "Ing. Informática"],
        modalidad: "Presencial & Online",
        telefono: "+56 2 2353 6000",
        horario: "Lun-Vie 8:00-22:00"
    },
    {
        name: "Padre Alonso de Ovalle",
        address: "Padre Alonso de Ovalle 1586",
        comuna: "Santiago",
        region: "Metropolitana",
        lat: -33.4567,
        lng: -70.6482,
        carreras: ["Analista Programador", "Ing. Conectividad y Redes"],
        modalidad: "Presencial",
        telefono: "+56 2 2353 6000",
        horario: "Lun-Vie 8:00-22:00"
    },
    {
        name: "Plaza Vespucio",
        address: "Av. Vicuña Mackenna Oriente 7860",
        comuna: "La Florida",
        region: "Metropolitana",
        lat: -33.5209,
        lng: -70.5982,
        carreras: ["Analista Programador"],
        modalidad: "Presencial & Online",
        telefono: "+56 2 2353 6000",
        horario: "Lun-Vie 8:00-22:00"
    },
    {
        name: "Maipú",
        address: "Av. Pajaritos 6085",
        comuna: "Maipú",
        region: "Metropolitana",
        lat: -33.5167,
        lng: -70.7500,
        carreras: ["Analista Programador"],
        modalidad: "Presencial",
        telefono: "+56 2 2353 6000",
        horario: "Lun-Vie 8:00-22:00"
    },
    {
        name: "Viña del Mar",
        address: "Av. Libertad 1390",
        comuna: "Viña del Mar",
        region: "Valparaíso",
        lat: -33.0153,
        lng: -71.5517,
        carreras: ["Analista Programador", "Ing. Informática"],
        modalidad: "Presencial",
        telefono: "+56 32 245 4500",
        horario: "Lun-Vie 8:00-22:00"
    },
    {
        name: "Concepción",
        address: "Paicaví 3280",
        comuna: "Concepción",
        region: "Biobío",
        lat: -36.8270,
        lng: -73.0503,
        carreras: ["Analista Programador", "Ing. Informática"],
        modalidad: "Presencial",
        telefono: "+56 41 266 9600",
        horario: "Lun-Vie 8:00-22:00"
    },
    {
        name: "Puerto Montt",
        address: "Ejercito 451",
        comuna: "Puerto Montt",
        region: "Los Lagos",
        lat: -41.4693,
        lng: -72.9424,
        carreras: ["Analista Programador"],
        modalidad: "Presencial",
        telefono: "+56 65 248 2800",
        horario: "Lun-Vie 8:00-22:00"
    },
    {
        name: "Online",
        address: "100% Virtual",
        comuna: "Todo Chile",
        region: "Nacional",
        lat: -33.4489,
        lng: -70.6693,
        carreras: ["Analista Programador Computacional"],
        modalidad: "Online 100%",
        telefono: "+56 2 2353 6000",
        horario: "24/7 Plataforma"
    }
];

const regiones = [...new Set(sedes.map(s => s.region))];
---

<section id="sedes-duocuc" class="sedes-section">
    <div class="sedes-header" data-aos="fade-up">
        <div class="header-icon-wrap">
            <i class="fas fa-map-marked-alt"></i>
        </div>
        <h2>Sedes <span class="gradient-text">DuocUC</span></h2>
        <p>Encuentra tu sede más cercana con Escuela de Informática</p>

        <div class="region-filters">
            <button class="region-btn active" data-region="all">
                <i class="fas fa-globe-americas"></i> Todas
            </button>
            {regiones.map(region => (
                <button class="region-btn" data-region={region}>
                    <i class="fas fa-map-pin"></i> {region}
                </button>
            ))}
        </div>
    </div>

    <div class="sedes-container" data-aos="fade-up" data-aos-delay="100">
        <!-- Mapa Leaflet -->
        <div class="map-wrapper glass-card">
            <div id="sedes-map" class="sedes-map"></div>
            <!-- Loading State -->
            <div class="map-loading">
                <div class="loading-spinner"></div>
                <span>Cargando mapa...</span>
            </div>
            <div class="map-overlay">
                <div class="map-legend">
                    <span class="legend-item"><i class="fas fa-circle" style="color: #00d4ff;"></i> Presencial</span>
                    <span class="legend-item"><i class="fas fa-circle" style="color: #10b981;"></i> Online</span>
                    <span class="legend-item"><i class="fas fa-circle" style="color: #7c3aed;"></i> Híbrido</span>
                </div>
            </div>
        </div>

        <!-- Lista de Sedes -->
        <div class="sedes-list">
            {sedes.map((sede, idx) => (
                <div
                    class={`sede-card glass-card ${sede.modalidad.includes('Online') && !sede.modalidad.includes('Presencial') ? 'online' : sede.modalidad.includes('&') ? 'hybrid' : 'presencial'}`}
                    data-region={sede.region}
                    data-lat={sede.lat}
                    data-lng={sede.lng}
                    data-aos="zoom-in"
                    data-aos-delay={50 + idx * 30}
                >
                    <div class="sede-header">
                        <div class="sede-icon">
                            {sede.modalidad.includes('Online') && !sede.modalidad.includes('Presencial') ? (
                                <i class="fas fa-laptop-house"></i>
                            ) : (
                                <i class="fas fa-building"></i>
                            )}
                        </div>
                        <div class="sede-title">
                            <h3>{sede.name}</h3>
                            <span class="sede-comuna">{sede.comuna}, {sede.region}</span>
                        </div>
                        <span class={`modalidad-badge ${sede.modalidad.includes('Online') && !sede.modalidad.includes('Presencial') ? 'online' : sede.modalidad.includes('&') ? 'hybrid' : ''}`}>
                            {sede.modalidad}
                        </span>
                    </div>

                    <div class="sede-body">
                        <div class="sede-info-row">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{sede.address}</span>
                        </div>
                        <div class="sede-info-row">
                            <i class="fas fa-clock"></i>
                            <span>{sede.horario}</span>
                        </div>
                        <div class="sede-info-row">
                            <i class="fas fa-phone"></i>
                            <span>{sede.telefono}</span>
                        </div>

                        <div class="sede-carreras">
                            <span class="carreras-label">Carreras disponibles:</span>
                            <div class="carreras-tags">
                                {sede.carreras.map(carrera => (
                                    <span class="carrera-tag">{carrera}</span>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div class="sede-footer">
                        <a href={`https://www.google.com/maps?q=${sede.lat},${sede.lng}`} target="_blank" class="sede-btn directions">
                            <i class="fas fa-directions"></i> Cómo llegar
                        </a>
                        <button class="sede-btn focus" data-lat={sede.lat} data-lng={sede.lng}>
                            <i class="fas fa-crosshairs"></i> Ver en mapa
                        </button>
                    </div>
                </div>
            ))}
        </div>
    </div>

    <!-- Stats Row -->
    <div class="sedes-stats" data-aos="fade-up" data-aos-delay="200">
        <div class="stat-box">
            <i class="fas fa-university"></i>
            <span class="stat-number">{sedes.length - 1}</span>
            <span class="stat-label">Sedes Presenciales</span>
        </div>
        <div class="stat-box">
            <i class="fas fa-laptop"></i>
            <span class="stat-number">1</span>
            <span class="stat-label">Sede Online</span>
        </div>
        <div class="stat-box">
            <i class="fas fa-map"></i>
            <span class="stat-number">{regiones.length}</span>
            <span class="stat-label">Regiones</span>
        </div>
        <div class="stat-box">
            <i class="fas fa-graduation-cap"></i>
            <span class="stat-number">2</span>
            <span class="stat-label">Carreras TI</span>
        </div>
    </div>
</section>

<!-- Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script is:inline>
const sedesData = [
    {
        name: "San Joaquín",
        lat: -33.4969,
        lng: -70.6147,
        modalidad: "hybrid",
        address: "Av. Vicuña Mackenna 4917",
        comuna: "San Joaquín",
        telefono: "+56 2 2353 6000",
        carreras: ["Analista Programador", "Ing. Informática"]
    },
    {
        name: "Padre Alonso de Ovalle",
        lat: -33.4567,
        lng: -70.6482,
        modalidad: "presencial",
        address: "Padre Alonso de Ovalle 1586",
        comuna: "Santiago",
        telefono: "+56 2 2353 6000",
        carreras: ["Analista Programador", "Ing. Conectividad"]
    },
    {
        name: "Plaza Vespucio",
        lat: -33.5209,
        lng: -70.5982,
        modalidad: "hybrid",
        address: "Av. Vicuña Mackenna Oriente 7860",
        comuna: "La Florida",
        telefono: "+56 2 2353 6000",
        carreras: ["Analista Programador"]
    },
    {
        name: "Maipú",
        lat: -33.5167,
        lng: -70.7500,
        modalidad: "presencial",
        address: "Av. Pajaritos 6085",
        comuna: "Maipú",
        telefono: "+56 2 2353 6000",
        carreras: ["Analista Programador"]
    },
    {
        name: "Viña del Mar",
        lat: -33.0153,
        lng: -71.5517,
        modalidad: "presencial",
        address: "Av. Libertad 1390",
        comuna: "Viña del Mar",
        telefono: "+56 32 245 4500",
        carreras: ["Analista Programador", "Ing. Informática"]
    },
    {
        name: "Concepción",
        lat: -36.8270,
        lng: -73.0503,
        modalidad: "presencial",
        address: "Paicaví 3280",
        comuna: "Concepción",
        telefono: "+56 41 266 9600",
        carreras: ["Analista Programador", "Ing. Informática"]
    },
    {
        name: "Puerto Montt",
        lat: -41.4693,
        lng: -72.9424,
        modalidad: "presencial",
        address: "Ejercito 451",
        comuna: "Puerto Montt",
        telefono: "+56 65 248 2800",
        carreras: ["Analista Programador"]
    },
    {
        name: "Online",
        lat: -33.4489,
        lng: -70.6693,
        modalidad: "online",
        address: "100% Virtual",
        comuna: "Todo Chile",
        telefono: "+56 2 2353 6000",
        carreras: ["Analista Programador Computacional"]
    }
];

let map = null;
let markers = [];
let tileLayer = null;
let themeObserver = null;

function cleanupMap() {
    // Cleanup observer
    if (themeObserver) {
        themeObserver.disconnect();
        themeObserver = null;
    }
    // Remove all markers
    markers.forEach(({ marker }) => {
        if (marker) marker.remove();
    });
    markers = [];
    // Remove map instance properly
    if (map) {
        map.off();
        map.remove();
        map = null;
    }
    tileLayer = null;
}

function createPopupContent(sede) {
    const modalidadLabel = sede.modalidad === 'online' ? 'Online 100%' :
                           sede.modalidad === 'hybrid' ? 'Presencial & Online' : 'Presencial';
    const modalidadColor = sede.modalidad === 'online' ? '#10b981' :
                           sede.modalidad === 'hybrid' ? '#7c3aed' : '#00d4ff';

    return `
        <div style="min-width: 220px; font-family: system-ui, -apple-system, sans-serif;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <div style="width: 32px; height: 32px; background: ${modalidadColor}15; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                    <svg width="16" height="16" fill="${modalidadColor}" viewBox="0 0 24 24">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                </div>
                <div>
                    <strong style="font-size: 14px; color: #0f172a; display: block;">${sede.name}</strong>
                    <span style="font-size: 11px; color: #64748b;">${sede.comuna}</span>
                </div>
            </div>
            <div style="font-size: 12px; color: #475569; margin-bottom: 6px;">
                <svg width="12" height="12" fill="#64748b" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 4px;">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
                </svg>
                ${sede.address}
            </div>
            <div style="font-size: 12px; color: #475569; margin-bottom: 8px;">
                <svg width="12" height="12" fill="#64748b" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 4px;">
                    <path d="M6.62 10.79c1.44 2.83 3.76 5.15 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                </svg>
                ${sede.telefono}
            </div>
            <div style="display: inline-block; padding: 3px 8px; background: ${modalidadColor}15; border-radius: 12px; font-size: 11px; font-weight: 600; color: ${modalidadColor};">
                ${modalidadLabel}
            </div>
            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e2e8f0;">
                <div style="font-size: 10px; color: #94a3b8; margin-bottom: 4px;">Carreras TI:</div>
                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    ${sede.carreras.map(c => `<span style="font-size: 10px; padding: 2px 6px; background: #f1f5f9; border-radius: 4px; color: #475569;">${c}</span>`).join('')}
                </div>
            </div>
        </div>
    `;
}

function initMap() {
    const mapContainer = document.getElementById('sedes-map');
    if (!mapContainer) return;

    // Cleanup any existing map first
    cleanupMap();

    // Show loading state
    const loadingEl = document.querySelector('.map-loading');
    if (loadingEl) loadingEl.style.display = 'flex';

    try {
        // Initialize map with better defaults
        map = L.map('sedes-map', {
            zoomControl: true,
            scrollWheelZoom: true,
            attributionControl: true
        }).setView([-33.45, -70.65], 5);

        // Choose tiles based on current theme
        const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
        const tileUrl = isDark
            ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
            : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';

        tileLayer = L.tileLayer(tileUrl, {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
            maxZoom: 19,
            subdomains: 'abcd'
        }).addTo(map);

        // Listen for theme changes and update tiles
        themeObserver = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'data-theme' && tileLayer) {
                    const newIsDark = document.documentElement.getAttribute('data-theme') !== 'light';
                    const newTileUrl = newIsDark
                        ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
                        : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
                    tileLayer.setUrl(newTileUrl);
                }
            });
        });
        themeObserver.observe(document.documentElement, { attributes: true });

        // Add markers with enhanced popups
        sedesData.forEach(sede => {
            const color = sede.modalidad === 'online' ? '#10b981' :
                          sede.modalidad === 'hybrid' ? '#7c3aed' : '#00d4ff';

            const icon = L.divIcon({
                className: 'custom-marker',
                html: `
                    <div class="marker-pin" style="
                        background: ${color};
                        width: 28px;
                        height: 28px;
                        border-radius: 50%;
                        border: 3px solid white;
                        box-shadow: 0 3px 10px rgba(0,0,0,0.35);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: transform 0.2s ease;
                    ">
                        <svg width="14" height="14" fill="white" viewBox="0 0 24 24">
                            ${sede.modalidad === 'online'
                                ? '<path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/>'
                                : '<path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>'
                            }
                        </svg>
                    </div>
                `,
                iconSize: [28, 28],
                iconAnchor: [14, 14],
                popupAnchor: [0, -14]
            });

            const marker = L.marker([sede.lat, sede.lng], { icon })
                .addTo(map)
                .bindPopup(createPopupContent(sede), {
                    maxWidth: 280,
                    className: 'custom-popup'
                });

            markers.push({ marker, sede });
        });

        // Region filters
        document.querySelectorAll('.region-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.region-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const region = btn.dataset.region;
                document.querySelectorAll('.sede-card').forEach(card => {
                    if (region === 'all' || card.dataset.region === region) {
                        card.style.display = 'block';
                        card.style.opacity = '1';
                    } else {
                        card.style.display = 'none';
                    }
                });

                // Also filter markers on map
                markers.forEach(({ marker, sede }) => {
                    if (region === 'all') {
                        marker.setOpacity(1);
                    } else {
                        const sedeRegion = sedesData.find(s => s.lat === sede.lat)?.region || '';
                        // Match by comuna for simplicity
                        const matchingRegions = {
                            'Metropolitana': ['San Joaquín', 'Santiago', 'La Florida', 'Maipú', 'Todo Chile'],
                            'Valparaíso': ['Viña del Mar'],
                            'Biobío': ['Concepción'],
                            'Los Lagos': ['Puerto Montt'],
                            'Nacional': ['Todo Chile']
                        };
                        const isMatch = matchingRegions[region]?.includes(sede.comuna) ||
                                       (region === 'Nacional' && sede.modalidad === 'online');
                        marker.setOpacity(isMatch ? 1 : 0.3);
                    }
                });
            };
        });

        // Focus buttons - zoom to sede
        document.querySelectorAll('.sede-btn.focus').forEach(btn => {
            btn.onclick = () => {
                const lat = parseFloat(btn.dataset.lat);
                const lng = parseFloat(btn.dataset.lng);
                map.flyTo([lat, lng], 14, {
                    duration: 1.5,
                    easeLinearity: 0.25
                });

                // Open the popup for this marker
                markers.forEach(({ marker, sede }) => {
                    if (sede.lat === lat && sede.lng === lng) {
                        marker.openPopup();
                    }
                });
            };
        });

        // Hide loading state
        if (loadingEl) loadingEl.style.display = 'none';

        // Force map to recalculate size after a short delay
        setTimeout(() => {
            if (map) map.invalidateSize();
        }, 100);

    } catch (error) {
        console.error('Error initializing map:', error);
        if (loadingEl) {
            loadingEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Error al cargar el mapa</span>';
        }
    }
}

// Initialize on DOM ready
document.addEventListener('DOMContentLoaded', initMap);

// Re-initialize on Astro page transitions
document.addEventListener('astro:page-load', () => {
    // Small delay to ensure DOM is ready
    setTimeout(initMap, 50);
});

// Cleanup on page leave (View Transitions)
document.addEventListener('astro:before-swap', cleanupMap);
</script>

<style>
    .sedes-section {
        padding: 4rem 2rem;
        max-width: 1400px;
        margin: 0 auto;
    }

    .sedes-header {
        text-align: center;
        margin-bottom: 2.5rem;
    }

    .header-icon-wrap {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(124, 58, 237, 0.2));
        border-radius: 20px;
        font-size: 2rem;
        color: #00d4ff;
    }

    .sedes-header h2 {
        font-size: 2.5rem;
        font-weight: 800;
        margin: 0 0 0.5rem;
    }

    .gradient-text {
        background: linear-gradient(135deg, #00d4ff, #7c3aed);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .sedes-header p {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }

    .region-filters {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1.5rem;
    }

    .region-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        color: var(--text-secondary);
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .region-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
    }

    .region-btn.active {
        background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(124, 58, 237, 0.2));
        border-color: rgba(0, 212, 255, 0.5);
        color: #00d4ff;
    }

    .sedes-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .map-wrapper {
        position: relative;
        border-radius: 16px;
        overflow: hidden;
        min-height: 500px;
    }

    .sedes-map {
        width: 100%;
        height: 100%;
        min-height: 500px;
        border-radius: 16px;
        z-index: 1;
    }

    /* Loading State */
    .map-loading {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(10, 10, 15, 0.9);
        backdrop-filter: blur(8px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        z-index: 100;
        border-radius: 16px;
    }

    .map-loading span {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(0, 212, 255, 0.2);
        border-top-color: #00d4ff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Custom Leaflet Popup Styles */
    :global(.custom-popup .leaflet-popup-content-wrapper) {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        padding: 0;
    }

    :global(.custom-popup .leaflet-popup-content) {
        margin: 12px;
    }

    :global(.custom-popup .leaflet-popup-tip) {
        background: rgba(255, 255, 255, 0.98);
    }

    :global(.leaflet-container a.leaflet-popup-close-button) {
        color: #64748b;
        font-size: 20px;
        padding: 6px 8px;
    }

    :global(.leaflet-container a.leaflet-popup-close-button:hover) {
        color: #0f172a;
    }

    /* Custom Marker Hover */
    :global(.custom-marker:hover .marker-pin) {
        transform: scale(1.15);
    }

    .map-overlay {
        position: absolute;
        bottom: 1rem;
        left: 1rem;
        right: 1rem;
        z-index: 1000;
    }

    .map-legend {
        display: flex;
        gap: 1rem;
        padding: 0.75rem 1rem;
        background: rgba(10, 10, 15, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        font-size: 0.8rem;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        color: var(--text-secondary);
    }

    .legend-item i {
        font-size: 0.6rem;
    }

    .sedes-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        max-height: 600px;
        overflow-y: auto;
        padding-right: 0.5rem;
    }

    .sede-card {
        padding: 1.25rem;
        border-radius: 16px;
        transition: all 0.3s ease;
    }

    .sede-card:hover {
        transform: translateX(8px);
    }

    .sede-card.online {
        border-left: 4px solid #10b981;
    }

    .sede-card.hybrid {
        border-left: 4px solid #7c3aed;
    }

    .sede-card.presencial {
        border-left: 4px solid #00d4ff;
    }

    .sede-header {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .sede-icon {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 212, 255, 0.1);
        border-radius: 12px;
        color: #00d4ff;
        font-size: 1.25rem;
    }

    .sede-card.online .sede-icon {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    .sede-title {
        flex: 1;
    }

    .sede-title h3 {
        font-size: 1.1rem;
        font-weight: 700;
        margin: 0 0 0.25rem;
    }

    .sede-comuna {
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    .modalidad-badge {
        padding: 0.35rem 0.75rem;
        background: rgba(0, 212, 255, 0.1);
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 600;
        color: #00d4ff;
    }

    .modalidad-badge.online {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    .modalidad-badge.hybrid {
        background: rgba(124, 58, 237, 0.1);
        color: #7c3aed;
    }

    .sede-body {
        margin-bottom: 1rem;
    }

    .sede-info-row {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
    }

    .sede-info-row i {
        width: 16px;
        color: var(--text-muted);
    }

    .sede-carreras {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
    }

    .carreras-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
        display: block;
    }

    .carreras-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
    }

    .carrera-tag {
        padding: 0.25rem 0.6rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        font-size: 0.75rem;
        color: var(--text-secondary);
    }

    .sede-footer {
        display: flex;
        gap: 0.75rem;
    }

    .sede-btn {
        flex: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.625rem 1rem;
        border-radius: 10px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .sede-btn.directions {
        background: rgba(0, 212, 255, 0.1);
        border: 1px solid rgba(0, 212, 255, 0.3);
        color: #00d4ff;
    }

    .sede-btn.directions:hover {
        background: rgba(0, 212, 255, 0.2);
    }

    .sede-btn.focus {
        background: rgba(124, 58, 237, 0.1);
        border: 1px solid rgba(124, 58, 237, 0.3);
        color: #7c3aed;
    }

    .sede-btn.focus:hover {
        background: rgba(124, 58, 237, 0.2);
    }

    .sedes-stats {
        display: flex;
        justify-content: center;
        gap: 3rem;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 16px;
        flex-wrap: wrap;
    }

    .stat-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
    }

    .stat-box i {
        font-size: 1.5rem;
        color: #00d4ff;
    }

    .stat-number {
        font-size: 2rem;
        font-weight: 800;
        color: var(--text-primary);
    }

    .stat-label {
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .sedes-container {
            grid-template-columns: 1fr;
        }

        .map-wrapper {
            min-height: 350px;
        }

        .sedes-map {
            min-height: 350px;
        }

        .sedes-list {
            max-height: none;
        }
    }

    @media (max-width: 600px) {
        .sedes-header h2 {
            font-size: 1.75rem;
        }

        .region-filters {
            justify-content: flex-start;
            overflow-x: auto;
            flex-wrap: nowrap;
            padding-bottom: 0.5rem;
        }

        .sedes-stats {
            gap: 1.5rem;
        }

        .stat-number {
            font-size: 1.5rem;
        }
    }

    /* ============================================
       LIGHT MODE - Enterprise Grade Styles
       Typography: System fonts, proper weights
       Contrast: WCAG AA compliant
       ============================================ */

    :global([data-theme="light"]) .sedes-section {
        background: linear-gradient(180deg, rgba(248, 250, 252, 0.5) 0%, rgba(241, 245, 249, 0.3) 100%);
    }

    /* Header Styles */
    :global([data-theme="light"]) .header-icon-wrap {
        background: linear-gradient(135deg, rgba(8, 145, 178, 0.1), rgba(124, 58, 237, 0.1));
        box-shadow: 0 4px 12px rgba(8, 145, 178, 0.12);
    }

    :global([data-theme="light"]) .header-icon-wrap i {
        color: #0891b2;
    }

    :global([data-theme="light"]) .sedes-header h2 {
        color: #0f172a;
        letter-spacing: -0.02em;
    }

    :global([data-theme="light"]) .gradient-text {
        background: linear-gradient(135deg, #0891b2, #7c3aed);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    :global([data-theme="light"]) .sedes-header p {
        color: #475569;
    }

    /* Region Filters */
    :global([data-theme="light"]) .region-btn {
        background: rgba(255, 255, 255, 0.8);
        border-color: rgba(0, 0, 0, 0.08);
        color: #475569;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03);
    }

    :global([data-theme="light"]) .region-btn:hover {
        background: rgba(255, 255, 255, 0.95);
        color: #0f172a;
        border-color: rgba(0, 0, 0, 0.12);
    }

    :global([data-theme="light"]) .region-btn.active {
        background: linear-gradient(135deg, rgba(8, 145, 178, 0.1), rgba(124, 58, 237, 0.1));
        border-color: rgba(8, 145, 178, 0.3);
        color: #0891b2;
        box-shadow: 0 2px 8px rgba(8, 145, 178, 0.1);
    }

    /* Map Wrapper */
    :global([data-theme="light"]) .map-wrapper {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        border: 1px solid rgba(0, 0, 0, 0.06);
    }

    :global([data-theme="light"]) .map-legend {
        background: rgba(255, 255, 255, 0.98);
        border: 1px solid rgba(0, 0, 0, 0.06);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    :global([data-theme="light"]) .legend-item {
        color: #475569;
    }

    /* Sede Cards */
    :global([data-theme="light"]) .sede-card {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(0, 0, 0, 0.06);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
    }

    :global([data-theme="light"]) .sede-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: rgba(0, 0, 0, 0.1);
    }

    :global([data-theme="light"]) .sede-card.online {
        border-left: 4px solid #059669;
    }

    :global([data-theme="light"]) .sede-card.hybrid {
        border-left: 4px solid #7c3aed;
    }

    :global([data-theme="light"]) .sede-card.presencial {
        border-left: 4px solid #0891b2;
    }

    :global([data-theme="light"]) .sede-icon {
        background: rgba(8, 145, 178, 0.08);
        color: #0891b2;
    }

    :global([data-theme="light"]) .sede-card.online .sede-icon {
        background: rgba(5, 150, 105, 0.08);
        color: #059669;
    }

    :global([data-theme="light"]) .sede-title h3 {
        color: #0f172a;
    }

    :global([data-theme="light"]) .sede-comuna {
        color: #64748b;
    }

    /* Modalidad Badges */
    :global([data-theme="light"]) .modalidad-badge {
        background: rgba(8, 145, 178, 0.08);
        color: #0891b2;
        border: 1px solid rgba(8, 145, 178, 0.15);
    }

    :global([data-theme="light"]) .modalidad-badge.online {
        background: rgba(5, 150, 105, 0.08);
        color: #059669;
        border-color: rgba(5, 150, 105, 0.15);
    }

    :global([data-theme="light"]) .modalidad-badge.hybrid {
        background: rgba(124, 58, 237, 0.08);
        color: #7c3aed;
        border-color: rgba(124, 58, 237, 0.15);
    }

    /* Sede Info */
    :global([data-theme="light"]) .sede-info-row {
        color: #475569;
    }

    :global([data-theme="light"]) .sede-info-row i {
        color: #64748b;
    }

    :global([data-theme="light"]) .sede-carreras {
        border-top-color: rgba(0, 0, 0, 0.06);
    }

    :global([data-theme="light"]) .carreras-label {
        color: #64748b;
    }

    :global([data-theme="light"]) .carrera-tag {
        background: rgba(0, 0, 0, 0.04);
        color: #475569;
        border: 1px solid rgba(0, 0, 0, 0.06);
    }

    /* Sede Buttons */
    :global([data-theme="light"]) .sede-btn.directions {
        background: rgba(8, 145, 178, 0.08);
        border-color: rgba(8, 145, 178, 0.2);
        color: #0891b2;
    }

    :global([data-theme="light"]) .sede-btn.directions:hover {
        background: rgba(8, 145, 178, 0.12);
        box-shadow: 0 2px 8px rgba(8, 145, 178, 0.15);
    }

    :global([data-theme="light"]) .sede-btn.focus {
        background: rgba(124, 58, 237, 0.08);
        border-color: rgba(124, 58, 237, 0.2);
        color: #7c3aed;
    }

    :global([data-theme="light"]) .sede-btn.focus:hover {
        background: rgba(124, 58, 237, 0.12);
        box-shadow: 0 2px 8px rgba(124, 58, 237, 0.15);
    }

    /* Stats Section */
    :global([data-theme="light"]) .sedes-stats {
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(0, 0, 0, 0.06);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03);
    }

    :global([data-theme="light"]) .stat-box i {
        color: #0891b2;
    }

    :global([data-theme="light"]) .stat-number {
        color: #0f172a;
    }

    :global([data-theme="light"]) .stat-label {
        color: #64748b;
    }

    /* Scrollbar for Sedes List */
    :global([data-theme="light"]) .sedes-list::-webkit-scrollbar {
        width: 6px;
    }

    :global([data-theme="light"]) .sedes-list::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.03);
        border-radius: 3px;
    }

    :global([data-theme="light"]) .sedes-list::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.15);
        border-radius: 3px;
    }

    :global([data-theme="light"]) .sedes-list::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.25);
    }

    /* Loading State Light Mode */
    :global([data-theme="light"]) .map-loading {
        background: rgba(248, 250, 252, 0.95);
    }

    :global([data-theme="light"]) .map-loading span {
        color: #475569;
    }

    :global([data-theme="light"]) .loading-spinner {
        border-color: rgba(8, 145, 178, 0.2);
        border-top-color: #0891b2;
    }
</style>
